{"version":3,"sources":["mod-callbacks.js"],"names":["$","MyAMS","_initialized","callbacks","init","initElement","element","Promise","resolve","reject","deferred","each","idx","elt","data","amsCallback","JSON","parse","e","split","isArray","callback","callname","callable","source","options","core","getFunctionByName","amsCallbackOptions","unserialize","push","getScript","then","console","warn","call","document","when","apply","window","env","bundle","config","modules","debug"],"mappings":"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","sourcesContent":["/* global MyAMS */\n/**\n * MyAMS callbacks management\n */\n\nconst $ = MyAMS.$;\n\nlet _initialized = false;\n\n\nexport const callbacks = {\n\n\tinit: () => {\n\t\tif (_initialized) {\n\t\t\treturn;\n\t\t}\n\t\t_initialized = true;\n\t},\n\n\tinitElement: (element) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst deferred = [];\n\t\t\t$('[data-ams-callback]', element).each((idx, elt) => {\n\t\t\t\tconst data = $(elt).data();\n\t\t\t\tlet callbacks = data.amsCallback;\n\t\t\t\tif (typeof callbacks === 'string') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tcallbacks = JSON.parse(data.amsCallback);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tcallbacks = data.amsCallback.split(/[\\s,;]+/);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!$.isArray(callbacks)) {\n\t\t\t\t\tcallbacks = [callbacks];\n\t\t\t\t}\n\t\t\t\tfor (const callback of callbacks) {\n\t\t\t\t\tlet callname, callable, source, options;\n\t\t\t\t\tif (typeof callback === 'string') {\n\t\t\t\t\t\tcallname = callback;\n\t\t\t\t\t\tcallable = MyAMS.core.getFunctionByName(callname);\n\t\t\t\t\t\tsource = data.amsCallbackOptions;\n\t\t\t\t\t\toptions = data.amsCallbackOptions;\n\t\t\t\t\t\tif (typeof options === 'string') {\n\t\t\t\t\t\t\toptions = options.unserialize();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {  // JSON object\n\t\t\t\t\t\tcallname = callback.callback;\n\t\t\t\t\t\tcallable = MyAMS.core.getFunctionByName(callname);\n\t\t\t\t\t\tsource = callback.source;\n\t\t\t\t\t\toptions = callback.options;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof callable === 'undefined') {\n\t\t\t\t\t\tif (source) {\n\t\t\t\t\t\t\tdeferred.push(MyAMS.core.getScript(source).then(() => {\n\t\t\t\t\t\t\t\tcallable = MyAMS.core.getFunctionByName(callname);\n\t\t\t\t\t\t\t\tif (typeof callable === 'undefined') {\n\t\t\t\t\t\t\t\t\tconsole.warn(`Missing callback ${callname}!`);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcallable.call(document, elt, options);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.warn(`Missing source for undefined callback ${callback}!`)\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeferred.push(Promise.resolve(callable.call(document, elt, options)));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t$.when.apply($, deferred).then(resolve, reject);\n\t\t});\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('callbacks');\n\t} else {\n\t\tMyAMS.callbacks = callbacks;\n\t\tconsole.debug(\"MyAMS: callbacks module loaded...\");\n\t}\n}\n"],"file":"mod-callbacks-dev.js"}