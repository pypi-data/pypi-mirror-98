{"version":3,"sources":["mod-notifications.js"],"names":["$","MyAMS","templates","jsrender","require","ITEM_TEMPLATE_STRING","ITEM_TEMPLATE","markup","allowCode","LIST_TEMPLATE_STRING","LIST_TEMPLATE","NotificationsList","values","options","parent","html","render","itemTemplate","timestamp","localTimestamp","Date","useLocalTime","notifications","getNotifications","evt","data","extend","target","current","currentTarget","remote","parents","Promise","resolve","reject","then","ajax","get","result","tab","attr","env","bundle","config","modules","push","console","debug"],"mappings":"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","sourcesContent":["/* global MyAMS */\n/**\n * MyAMS notifications handlers\n */\n\nconst $ = MyAMS.$;\n\nif (!$.templates) {\n\tconst jsrender = require('jsrender');\n\t$.templates = jsrender.templates;\n}\n\n\n/**\n * Notifications list template string\n */\n\nconst ITEM_TEMPLATE_STRING = `\n\t<li class=\"p-1\">\n\t\t<a class=\"d-flex flex-row\"{{if url}} href=\"{{:url}}\"{{/if}}>\n\t\t\t{{if source.avatar}}\n\t\t\t<img class=\"avatar mx-1 mt-1\" src=\"{{:source.avatar}}\" />\n\t\t\t{{else}}\n\t\t\t<i class=\"avatar fa fa-fw fa-2x fa-user mx-1 mt-1\"></i>\n\t\t\t{{/if}}\n\t\t\t<div class=\"flex-grow-1 ml-2\">\n\t\t\t\t<small class=\"timestamp float-right text-muted\">\n\t\t\t\t\t{{*: new Date(data.timestamp).toLocaleString()}}\n\t\t\t\t</small>\n\t\t\t\t<strong class=\"title d-block\">\n\t\t\t\t\t{{:source.title}}\n\t\t\t\t</strong>\n\t\t\t\t<p class=\"text-muted mb-2\">{{:message}}</p>\n\t\t\t</div>\n\t\t</a>\n\t</li>`;\n\nconst ITEM_TEMPLATE = $.templates({\n\tmarkup: ITEM_TEMPLATE_STRING,\n\tallowCode: true\n});\n\n\nconst LIST_TEMPLATE_STRING = `\n\t<ul class=\"list-style-none flex-grow-1 overflow-auto m-0 p-0\">\n\t\t{{for notifications tmpl=~itemTemplate /}}\n\t</ul>\n\t{{if !~options.hideTimestamp}}\n\t<div class=\"timestamp border-top pt-1\">\n\t\t<span>{{*: MyAMS.i18n.LAST_UPDATE }}{{: ~timestamp.toLocaleString() }}</span>\n\t\t<i class=\"fa fa-fw fa-sync float-right\"\n\t\t   data-ams-click-handler=\"MyAMS.notifications.getNotifications\"\n\t\t   data-ams-click-handler-options='{\"localTimestamp\": \"{{: ~useLocalTime }}\"}'></i>\n\t</div>\n\t{{/if}}`;\n\nconst LIST_TEMPLATE = $.templates({\n\tmarkup: LIST_TEMPLATE_STRING,\n\tallowCode: true\n});\n\n\nclass NotificationsList {\n\n\t/**\n\t * List constructor\n\t *\n\t * @param values: notifications data (may be loaded from JSON)\n\t * @param options: list rendering options\n\t */\n\tconstructor(values, options={}) {\n\t\tthis.values = values;\n\t\tthis.options = options;\n\t}\n\n\t/**\n\t * Render list into given parent\n\t *\n\t * @param parent: JQUery parent object into which the list must be rendered\n\t */\n\trender(parent) {\n\t\t$(parent).html(LIST_TEMPLATE.render(this.values, {\n\t\t\titemTemplate: ITEM_TEMPLATE,\n\t\t\ttimestamp: this.options.localTimestamp ?\n\t\t\t\tnew Date() : new Date(this.values.timestamp),\n\t\t\tuseLocalTime: this.options.localTimestamp ? 'true' : 'false',\n\t\t\toptions: this.options\n\t\t}));\n\t}\n}\n\n\nexport const notifications = {\n\n\t/**\n\t * Load user notifications\n\t *\n\t * @param evt: source event\n\t * @param options: notifications options (which can also be extracted from event data)\n\t */\n\tgetNotifications: (evt, options) => {\n\t\tconst\n\t\t\tdata = $.extend({}, options, evt.data),\n\t\t\ttarget = $(evt.target),\n\t\t\tcurrent = $(evt.currentTarget),\n\t\t\tremote = current.data('ams-notifications-source') ||\n\t\t\t\tcurrent.parents('[data-ams-notifications-source]').data('ams-notifications-source');\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tMyAMS.require('ajax').then(() => {\n\t\t\t\tMyAMS.ajax.get(remote, current.data('ams-notifications-params') || '',\n\t\t\t\t\tcurrent.data('ams-notifications-options') || {}).then((result) => {\n\t\t\t\t\tconst\n\t\t\t\t\t\ttab = $(target.data('ams-notifications-target') ||\n\t\t\t\t\t\ttarget.parents('[data-ams-notifications-target]').data('ams-notifications-target') ||\n\t\t\t\t\t\tcurrent.attr('href'));\n\t\t\t\t\tnew NotificationsList(result, data).render(tab);\n\t\t\t\t\tresolve();\n\t\t\t\t}, reject);\n\t\t\t}, reject);\n\t\t});\n\t}\n}\n\n\n/**\n * Global module initialization\n */\nif (MyAMS.env.bundle) {\n\tMyAMS.config.modules.push('notifications');\n} else {\n\tMyAMS.notifications = notifications;\n\tconsole.debug(\"MyAMS: notifications module loaded...\");\n}\n"],"file":"mod-notifications-dev.js"}