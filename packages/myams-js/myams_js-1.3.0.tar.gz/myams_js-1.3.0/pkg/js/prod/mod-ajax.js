!function(e,t){"function"==typeof define&&define.amd?define(["exports"],t):"undefined"!=typeof exports?t(exports):(t(t={}),e.modAjax=t)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e){"use strict";function m(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,t=function(){};return{s:t,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return r=e.done,e},e:function(e){s=!0,a=e},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(e,"__esModule",{value:!0}),e.ajax=void 0;var g=MyAMS.$;function s(e){var t;!window.Cookies||(t=Cookies.get(MyAMS.config.csrfCookieName))&&e.setRequestHeader(MyAMS.config.csrfHeaderName,t)}var n={check:function(s,i){return new Promise(function(e,t){var n=[];if(void 0===s){i instanceof Array||(i=[i]);var o=m(i);try{for(o.s();!(a=o.n()).done;){var a=a.value;n.push(MyAMS.core.getScript(a))}}catch(e){o.e(e)}finally{o.f()}}else{s instanceof Array||(s=[s]);for(var r=0;r<s.length;r++)void 0===s[r]&&n.push(MyAMS.core.getScript(i[r]))}g.when.apply(g,n).then(function(){e(0<n.length)},t)})},getAddr:function(e){e=e||g("html head base").attr("href")||window.location.href;return e.substr(0,e.lastIndexOf("/")+1)},start:function(){g("#ajax-gear").show()},stop:function(){g("#ajax-gear").hide()},progress:function(e){e.lengthComputable&&(e.loaded>=e.total||console&&console.debug&&console.debug("".concat(Math.round(e.loaded/e.total*100),"%")))},get:function(t,n,r){return new Promise(function(o,a){var e=t.startsWith(window.location.protocol)?t:MyAMS.ajax.getAddr()+t,e={url:e,type:"get",cache:!1,data:g.param(n||null),dataType:"json",beforeSend:s},e=g.extend({},e,r);g.ajax(e).then(function(e,t,n){o(e,t,n)},function(e,t,n){a(n)})})},post:function(t,n,r){return new Promise(function(o,a){var e=t.startsWith(window.location.protocol)?t:MyAMS.ajax.getAddr()+t,e={url:e,type:"post",cache:!1,data:g.param(n||null),dataType:"json",beforeSend:s},e=g.extend({},e,r);g.ajax(e).then(function(e,t,n){o(e,t,n)},function(e,t,n){a(n)})})},getJSON:function(){return function(e,t){var n=t.url;return delete t.url,MyAMS.ajax.post(n,t).then(MyAMS.ajax.handleJSON)}},getResponse:function(t){var n,o="unknown";if(t){var a=t.getResponseHeader("content-type");if(!a)try{a=t.responseXML.contentType}catch(e){a=null}if(a)if(a.startsWith("application/javascript"))n=t.responseText,o="script";else if(a.startsWith("text/html"))n=t.responseText,o="html";else if(a.startsWith("text/xml"))n=t.responseText,o="xml";else if(n=t.responseJSON)o="json";else try{n=JSON.parse(t.responseText),o="json"}catch(e){n=t.responseText,o="binary"}else n={status:"alert",alert:{title:MyAMS.i18n.ERROR_OCCURED,content:MyAMS.i18n.NO_SERVER_RESPONSE}},o="json"}return{contentType:o,data:n}},handleJSON:function(n,o,e){function t(){return new Promise(function(e,t){void 0!==o?MyAMS.require("form").then(function(){MyAMS.form.resetChanged(o)}).then(function(){!1!==n.closeForm?MyAMS.require("modal").then(function(){MyAMS.modal.close(o)}).then(e,t):e()}):e()})}var a,r,s,i,c=null,l=n.status,u=[];switch(e instanceof jQuery&&!e.length&&(e=null),l){case"alert":window.alert&&(r=n.alert,window.alert("".concat(r.title,"\n\n").concat(r.content)));break;case"error":u.push(MyAMS.require("error").then(function(){MyAMS.error.showErrors(o,n)}));break;case"message":case"messagebox":case"smallbox":break;case"info":case"success":case"notify":case"callback":case"callbacks":u.push(t());break;case"modal":u.push(MyAMS.require("modal").then(function(){MyAMS.modal.open(n.location)}));break;case"reload":t(),(c=n.location||window.location.hash).startsWith("#")&&(c=c.substr(1)),a=g(n.target||e||"#content"),u.push(MyAMS.require("skin").then(function(){MyAMS.skin.loadURL(c,a,{preLoadCallback:MyAMS.core.getFunctionByName(n.preReload||function(){g("[data-ams-pre-reload]",a).each(function(e,t){MyAMS.core.executeFunctionByName(g(t).data("ams-pre-reload"))})}),preLoadCallbackOptions:n.preReloadOptions,afterLoadCallback:MyAMS.core.getFunctionByName(n.postReload||function(){g("[data-ams-post-reload]",a).each(function(e,t){MyAMS.core.executeFunctionByName(g(t).data("ams-post-reload"))})}),afterLoadCallbackOptions:n.postReloadOptions})}));break;case"redirect":t(),(c=n.location||window.location.href).endsWith("##")&&(c=c.replace(/##/,window.location.hash)),n.window?window.open(c,n.window,n.options):window.location.href===c?window.location.reload():window.location.href=c;break;default:n.code?u.push(MyAMS.require("error").then(function(){MyAMS.error.showHTTPError(n)})):window.console&&console.warn&&console.warn("Unhandled JSON response status: ".concat(l))}if(n.content&&(s=n.content,i=g(s.target||e||"#content"),"string"==typeof s?i.html(s):(s.text?i.text(s.text):i.html(s.html),u.push(MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,i).then(function(){s.keepHidden||i.removeClass("hidden")})))),n.contents){var f,d=m(n.contents);try{for(d.s();!(f=d.n()).done;)!function(){var e=f.value,t=g(e.target);e.text?t.text(e.text):t.html(e.html),u.push(MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,t).then(function(){e.keepHidden||t.removeClass("hidden")}))}()}catch(e){d.e(e)}finally{d.f()}}if(n.message&&!n.code&&u.push(MyAMS.require("alert").then(function(){var e;"string"==typeof n.message?MyAMS.alert.smallBox({status:l,message:n.message,icon:"fa-info-circle",timeout:3e3}):(e=n.message,MyAMS.alert.alert({parent:o,status:e.status||l,header:e.header,subtitle:e.subtitle,message:e.message}))})),n.messagebox&&u.push(MyAMS.require("alert").then(function(){var e;"string"==typeof n.messagebox?MyAMS.alert.messageBox({status:l,title:MyAMS.i18n.ERROR_OCCURED,icon:"fa-info-circle",message:n.messagebox,timeout:1e4}):(e=n.messagebox,MyAMS.alert.messageBox({status:e.status||l,title:e.title||MyAMS.i18n.ERROR_OCCURED,icon:e.icon||"fa-info-circle",message:e.message,content:e.content,timeout:0===e.timeout?0:e.timeout||1e4}))})),n.smallbox&&u.push(MyAMS.require("alert").then(function(){var e;"string"==typeof n.smallbox?MyAMS.alert.smallBox({status:l,message:n.smallbox,icon:"fa-info-circle",timeout:3e3}):(e=n.smallbox,MyAMS.alert.smallBox({status:e.status||l,message:e.message,content:e.content,icon:e.icon||"fa-info-circle",timeout:e.timeout}))})),n.event&&o.trigger(n.event,n.eventOptions),n.events){var M=m(n.events);try{for(M.s();!(p=M.n()).done;){var p=p.value;"string"==typeof p?o.trigger(p,n.eventOptions):o.trigger(p.event,p.options)}}catch(e){M.e(e)}finally{M.f()}}if(n.callback&&u.push(MyAMS.core.executeFunctionByName(n.callback,document,o,n.options)),n.callbacks){var y,h=m(n.callbacks);try{for(h.s();!(y=h.n()).done;)!function(){var e=y.value;"string"==typeof e?u.push(MyAMS.core.executeFunctionByName(e,document,o,n.options)):u.push(MyAMS.require(e.module||[]).then(function(){MyAMS.core.executeFunctionByName(e.callback,document,o,e.options)}))}()}catch(e){h.e(e)}finally{h.f()}}return Promise.all(u)},error:function(n,e,t,o){var a;"abort"!==o&&(e&&e.statusText&&"OK"===e.statusText.toUpperCase()||((a=MyAMS.ajax.getResponse(e))?"json"===a.contentType?MyAMS.ajax.handleJSON(a.data):MyAMS.require("i18n","alert").then(function(){var e=o||n.statusText||n.type,t=a.responseText;MyAMS.alert.messageBox({status:"error",title:MyAMS.i18n.ERROR_OCCURED,content:"<h4>".concat(e,"</h4><p>").concat(t||"","</p>"),icon:"fa-exclamation-triangle",timeout:5e3})},function(){window.console&&(console.error&&console.error(n),console.debug&&console.debug(a))}):window.console&&(console.error&&console.error("ERROR: Can't parse response!"),console.debug&&console.debug(e))))}};e.ajax=n,"undefined"==typeof jest&&n.check(window.Cookies,"".concat(MyAMS.env.baseURL,"../ext/js-cookie").concat(MyAMS.env.extext,".js")).then(function(){var t=g.ajaxSettings.xhr;g.ajaxSetup({beforeSend:function(e,t){MyAMS.config.safeMethods.indexOf(t.type)<0&&(void 0===window.Cookies||(t=Cookies.get(MyAMS.config.csrfCookieName))&&e.setRequestHeader(MyAMS.config.csrfHeaderName,t))},progress:n.progress,progressUpload:n.progress,xhr:function(){var e=t();return e&&"function"==typeof e.addEventListener&&n.progress&&e.addEventListener("progress",function(e){MyAMS.ajax.progress(e)},!1),e}})}),g(document).ajaxStart(n.start),g(document).ajaxStop(n.stop),g(document).ajaxError(n.error),MyAMS.env.bundle?MyAMS.config.modules.push("ajax"):(MyAMS.ajax=n,console.debug("MyAMS: AJAX module loaded..."))});