{"version":3,"sources":["mod-menu.js"],"names":["$","MyAMS","_contextMenuHandler","menu","get","tagName","parents","first","menuData","data","toggle","require","then","modal","open","href","attr","amsUrl","startsWith","hrefGetter","core","getFunctionByName","replace","target","form","confirmChangedForm","status","skin","loadURL","location","hash","dom","root","hasClass","removeClass","setTimeout","window","_initialized","init","fn","extend","contextMenu","settings","getMenuPosition","mouse","direction","win","menuSelector","position","each","idx","elt","source","on","evt","ctrlKey","dropdown","css","left","clientX","top","clientY","off","clickEvt","stopPropagation","preventDefault","document","click","currentTarget","ul","children","menuRect","getBoundingClientRect","buttonHeight","height","menuHeight","outerHeight","addClass","focus","clickEvent","env","bundle","config","modules","push","console","debug"],"mappings":"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","sourcesContent":["/* global MyAMS */\n/**\n * MyAMS menus management\n */\n\nconst $ = MyAMS.$;\n\n\n/**\n * Context menu handler\n */\nfunction _contextMenuHandler(menu) {\n\tif (menu.get(0).tagName !== 'A') {\n\t\tmenu = menu.parents('a').first();\n\t}\n\tconst menuData = menu.data();\n\tif (menuData.toggle === 'modal') {\n\t\tMyAMS.require('modal').then(() => {\n\t\t\tMyAMS.modal.open(menu);\n\t\t});\n\t} else {\n\t\tlet href = menu.attr('href') || menuData.amsUrl;\n\t\tif (!href || href.startsWith('javascript:') || menu.attr('target')) {\n\t\t\treturn;\n\t\t}\n\t\tconst hrefGetter = MyAMS.core.getFunctionByName(href);\n\t\tif (typeof hrefGetter === 'function') {\n\t\t\thref = hrefGetter(menu);\n\t\t}\n\t\tif (typeof href === 'undefined') {\n\t\t\treturn;\n\t\t}\n\t\tif (typeof href === 'function') {\n\t\t\thref(menu);\n\t\t} else {\n\t\t\tMyAMS.require('form', 'skin').then(() => {\n\t\t\t\thref = href.replace(/%23/, '#');\n\t\t\t\tconst target = menu.data('ams-target');\n\t\t\t\tif (target) {\n\t\t\t\t\tMyAMS.form.confirmChangedForm(target).then((status) => {\n\t\t\t\t\t\tif (status !== 'success') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tMyAMS.skin.loadURL(href, target,\n\t\t\t\t\t\t\tmenu.data('ams-link-options'), menu.data('ams-link-callback'));\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tMyAMS.form.confirmChangedForm().then((status) => {\n\t\t\t\t\t\tif (status !== 'success') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (href.startsWith('#')) {\n\t\t\t\t\t\t\tif (href !== location.hash) {\n\t\t\t\t\t\t\t\tif (MyAMS.dom.root.hasClass('mobile-view-activated')) {\n\t\t\t\t\t\t\t\t\tMyAMS.dom.root.removeClass('hidden-menu');\n\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\twindow.location.hash = href;\n\t\t\t\t\t\t\t\t\t}, 50);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\twindow.location.hash = href;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.location = href;\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\n\nlet _initialized = false;\n\n\n/**\n * MyAMS \"menu\" module\n */\nexport const menu = {\n\n\t/**\n\t * Global module initialization.\n\t * This function extends jQuery with a \"contextMenu()\" function, which\n\t * allows to create a new context menu.\n\t */\n\tinit: () => {\n\n\t\tif (_initialized) {\n\t\t\treturn;\n\t\t}\n\t\t_initialized = true;\n\n\t\t$.fn.extend({\n\n\t\t\t/**\n\t\t\t * JQuery context menu constructor\n\t\t\t */\n\t\t\tcontextMenu: function(settings) {\n\n\t\t\t\tfunction getMenuPosition(mouse, direction) {\n\t\t\t\t\tconst\n\t\t\t\t\t\twin = $(window)[direction](),\n\t\t\t\t\t\tmenu = $(settings.menuSelector)[direction]();\n\t\t\t\t\tlet position = mouse;\n\t\t\t\t\t// opening menu would pass the side of the page\n\t\t\t\t\tif (mouse + menu > win && menu < mouse) {\n\t\t\t\t\t\tposition -= menu;\n\t\t\t\t\t}\n\t\t\t\t\treturn position;\n\t\t\t\t}\n\n\t\t\t\treturn this.each((idx, elt) => {\n\n\t\t\t\t\tconst\n\t\t\t\t\t\tsource = $(elt),\n\t\t\t\t\t\tmenu = $(settings.menuSelector);\n\n\t\t\t\t\t// Set flag on menu items\n\t\t\t\t\t$('a', menu).each((idx, elt) => {\n\t\t\t\t\t\t$(elt).data('ams-context-menu', true);\n\t\t\t\t\t});\n\t\t\t\t\tsource.on(\"contextmenu\", function (evt) {\n\t\t\t\t\t\t// return native menu if pressing CTRL key\n\t\t\t\t\t\tif (evt.ctrlKey) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// open menu\n\t\t\t\t\t\tmenu.dropdown('show')\n\t\t\t\t\t\t\t.css({\n\t\t\t\t\t\t\t\tposition: 'fixed',\n\t\t\t\t\t\t\t\tleft: getMenuPosition(evt.clientX, 'width') - 10,\n\t\t\t\t\t\t\t\ttop: getMenuPosition(evt.clientY, 'height') - 10\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.off('click')\n\t\t\t\t\t\t\t.on('click', (clickEvt) => {\n\t\t\t\t\t\t\t\tclickEvt.stopPropagation();\n\t\t\t\t\t\t\t\tclickEvt.preventDefault();\n\t\t\t\t\t\t\t\tmenu.dropdown('hide');\n\t\t\t\t\t\t\t\t_contextMenuHandler($(clickEvt.target));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t});\n\n\t\t\t\t\t// make sure menu closes on any click\n\t\t\t\t\t$(document).click(() => {\n\t\t\t\t\t\tmenu.dropdown('hide');\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// Automatically set orientation of dropdown menus\n\t\t$(document).on('show.bs.dropdown', '.btn-group', (evt) => {\n\t\t\t// check menu height\n\t\t\tconst\n\t\t\t\tmenu = $(evt.currentTarget),\n\t\t\t\tul = menu.children('.dropdown-menu'),\n\t\t\t\tmenuRect = menu.get(0).getBoundingClientRect(),\n\t\t\t\tposition = menuRect.top,\n\t\t\t\tbuttonHeight = menuRect.height,\n\t\t\t\tmenuHeight = ul.outerHeight();\n\t\t\tif (position > menuHeight && $(window).height() - position < buttonHeight + menuHeight) {\n\t\t\t\tmenu.addClass(\"dropup\");\n\t\t\t}\n\t\t\t// activate first input\n\t\t\t$('input, select, textarea', ul).first().focus();\n\t\t}).on('hidden.bs.dropdown', '.btn-group', (evt) => {\n\t\t\t// always reset after close\n\t\t\t$(evt.currentTarget).removeClass('dropup');\n\t\t});\n\n\t\t$(document).on('hide.bs.dropdown', (evt) => {\n\t\t\tif (evt.clickEvent) {\n\t\t\t\tconst dropdown = $(evt.clickEvent.target).parents('.dropdown-menu');\n\t\t\t\tif (dropdown.data('ams-click-dismiss') === false) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('menu');\n\t} else {\n\t\tMyAMS.menu = menu;\n\t\tconsole.debug(\"MyAMS: menu module loaded...\");\n\t}\n}\n"],"file":"mod-menu-dev.js"}