!function(e,t){"function"==typeof define&&define.amd?define(["exports"],t):"undefined"!=typeof exports?t(exports):(t(t={}),e.modForm=t)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e){"use strict";function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw o}}return r}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=s(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw a}}}}function s(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.showFormSubmitWarning=i,e.getFormValidators=c,e.checkFormValidators=u,e.initFormSubmitButton=l,e.resetFormSubmitButton=g,e.getFormData=y,e.initFormData=M,e.getFormTarget=p,e.initFormTarget=S,e.getFormAction=h,e.getFormAjaxSettings=v,e.getFormProgressSettings=A,e.getFormProgressState=x,e.submitForm=C,e.formSubmitCallback=T,e.resetFormAfterSubmit=w,e.resetFormAfterError=k,e.getFormDownloadTarget=F,e.initFormDownloadTarget=D,e.resetFormDownloadTarget=R,e.form=void 0;var r,d=MyAMS.$;d.templates||(r=require("jsrender"),d.templates=r.templates);var a=!1,o={init:function(){a||(a=!0,d(document).on("click",'[type="submit"], .submit',function(e){e=d(e.currentTarget);e.exists()&&d(e).closest("form").data("ams-submit-button",e)}),d(document).on("click",'input[type="checkbox"][readonly]',function(){return!1}),d(document).on("reset",MyAMS.form.resetHandler),d(document).on("reset","[data-ams-reset-handler]",MyAMS.form.customResetHandler),d(window).on("beforeunload",MyAMS.form.checkBeforeUnload))},initElement:function(e){"string"==typeof e&&(e=d(e)),e.on("keydown","textarea",function(e){10!==e.keyCode&&13!==e.keyCode||!e.ctrlKey&&!e.metaKey||d(e.currentTarget).closest("form").submit()}),e.on("focus","input[readonly]",function(e){d(e.currentTarget).blur()}),e.on("focusin",function(e){0<=d(e.target).closest(".mce-window").length&&e.stopImmediatePropagation()}),(MyAMS.config.warnOnFormChange?d('form[data-ams-warn-on-change!="false"]',e):d('form[data-ams-warn-on-change="true"]',e)).each(function(e,t){var a=d(t),o=a.data().amsChangedCallback||MyAMS.config.formChangeCallback;d("input, select, textarea, [data-ams-changed-event]",a).each(function(e,t){var r=d(t),n=r.data();!0!==n.amsIgnoreChange&&(t=n.amsChangedEvent||"change",r.on(t,function(){MyAMS.form.setChanged(a),MyAMS.core.executeFunctionByName(n.amsChangedCallback||o,document,a,r)}))})}),MyAMS.form.setFocus(e)},setFocus:function(e){var t=d("[data-ams-focus-target]",e).first();t.exists()||(t=d("input, select, textarea",e).first()),t.exists()&&t.focus()},checkBeforeUnload:function(){if(MyAMS.i18n&&d('form[data-ams-form-changed="true"]').exists())return MyAMS.i18n.FORM_CHANGED_WARNING},confirmChangedForm:function(n){return new Promise(function(t,e){var r=d('form[data-ams-form-changed="true"]',n);r.exists()?MyAMS.require("alert").then(function(){MyAMS.alert.bigBox({status:"danger",title:MyAMS.i18n.WARNING,icon:"text-danger fa-bell",message:MyAMS.i18n.FORM_CHANGED_WARNING}).then(function(e){"success"===e&&MyAMS.form.resetChanged(r),t(e)})},function(){e("Missing 'alert' module!")}):(o.resetChanged(r),t("success"))})},setChanged:function(e){e.attr("data-ams-form-changed",!0)},resetHandler:function(e){e=d(e.target);MyAMS.form.clearAlerts(e),MyAMS.form.handleDefaultReset(e)},clearAlerts:function(e){d(".alert-danger, SPAN.state-error",e).not(".persistent").remove(),d(".state-error",e).removeClassPrefix("state-"),d(".invalid-feedback",e).remove(),d(".is-invalid",e).removeClass("is-invalid")},handleDefaultReset:function(a){setTimeout(function(){a.find(".select2").trigger("change"),d("[data-ams-reset-callback]",a).each(function(e,t){var r=d(t),n=r.data(),t=MyAMS.core.getFunctionByName(n.amsResetCallback);void 0!==t&&t.call(document,a,r,n.amsResetCallbackOptions)}),MyAMS.form.resetChanged(a)},10)},resetChanged:function(e){void 0!==e&&d(e).removeAttr("data-ams-form-changed")},customResetHandler:function(e){var t,r=d(e.target),n=r.data();n.amsResetHandler&&(!0!==n.amsKeepDefault&&!0!==n.amsResetKeepDefault&&e.preventDefault(),void 0!==(t=MyAMS.core.getFunctionByName(n.amsResetHandler))&&t.call(document,e,r,n.amsResetHandlerOptions))},setInvalid:function(e,t,r){"string"==typeof t&&(t=d('[name="'.concat(t,'"]'),e)),t.exists()&&(e=t.closest(".form-widget"),d(".invalid-feedback",e).remove(),d("<span>").text(r).addClass("is-invalid invalid-feedback").appendTo(e),t.removeClass("valid").addClass("is-invalid"))},getSettings:function(e,t,r,n,a){e={submitWarning:i,getValidators:c,checkValidators:u,clearAlerts:MyAMS.form.clearAlerts,initSubmitButton:l,resetSubmitButton:g,getData:y,initData:M,initDataCallback:null,getTarget:p,initTarget:S,getAction:h,getAjaxSettings:v,getProgressSettings:A,getProgressState:x,submit:C,datatype:null,submitOptions:null,submitHandler:(e.attr("action")||"").replace(/#/,""),submitTarget:e.attr("target")||null,submitMessage:null,submitCallback:T,progressHandler:null,progressFieldName:"progressId",progressInterval:1e3,progressTarget:null,progressCallback:null,progressEndCallback:null,resetBeforeSubmit:!1,keepModalOpen:!1,resetAfterSubmit:w,resetTimeout:1e3,resetAfterError:k,downloadTarget:null,getDownloadTarget:F,initDownloadTarget:D,resetDownloadTarget:R},e=d.extend({},e);return d.extendPrefix(e,"amsForm",function(e){return MyAMS.core.getFunctionByName(e)||e},t,n),d.extendOnly(e,function(e){return MyAMS.core.getFunctionByName(e)||e},a),e},submit:function(a,o,e){var i=2<arguments.length&&void 0!==e?e:{};if(!(a=d(a)).exists())return!1;"object"===t(o)&&(i=o,o=void 0);var s=a.data(),c=d(s.amsSubmitButton),u=c.data()||{},l=MyAMS.form.getSettings(a,s,c,u,i);return s.submitted?l.submitWarning(a,l):l.checkValidators(a,l).then(function(e){"success"===e&&MyAMS.require("ajax","i18n").then(function(){MyAMS.ajax.check(d.fn.ajaxSubmit,"".concat(MyAMS.env.baseURL,"../ext/jquery-form").concat(MyAMS.env.extext,".js")).then(function(){l.clearAlerts(a,l),l.initSubmitButton(a,l,c);var e,t,r=l.getData(a,l,s,c,u,i),n={veto:!1};l.initData(a,l,c,r,i,n),n.veto?l.resetSubmitButton(a,l,c):((e=l.getTarget(a,l,s,u))&&e.exists()&&l.initTarget(a,l,e),t=l.getAction(a,l,o),n=l.getAjaxSettings(a,l,c,r,t,e),(t=l.getDownloadTarget(a,l))&&l.initDownloadTarget(a,l,t,n),n.progress=l.getProgressSettings(a,l,c,r),l.submit(a,l,c,r,n,e),t&&l.resetDownloadTarget(a,l,c,t,n))})})}),!1}};function i(r){return new Promise(function(e,t){r.data("ams-form-hide-submitted")?e():MyAMS.require("i18n","alert").then(function(){MyAMS.alert.messageBox({status:"warning",title:MyAMS.i18n.WAIT,message:MyAMS.i18n.FORM_SUBMITTED,icon:"fa-save",timeout:r.data("ams-form-alert-timeout")||5e3})}).then(e,t)})}function c(e){var n=new Map,t=(e.data("ams-form-validator")||"").trim().split(/[\s,;]+/),a=[];return d(t).each(function(e,t){t&&a.push(t)}),0<a.length&&n.set(e,a),d("[data-ams-form-validator]",e).each(function(e,t){var r=d(t),t=(r.data("ams-form-validator")||"").trim().split(/[\s,;]+/);a=[],d(t).each(function(e,t){t&&a.push(t)}),0<a.length&&n.set(r,a)}),n}function u(u,l){return new Promise(function(c,e){var t=l.getValidators(u,l);if(t.size){var r=[],n=f(t.entries());try{for(n.s();!(a=n.n()).done;){var a=m(a.value,2),o=a[0],i=f(a[1]);try{for(i.s();!(s=i.n()).done;){var s=s.value;r.push(MyAMS.core.executeFunctionByName(s,document,u,o))}}catch(e){i.e(e)}finally{i.f()}}}catch(e){n.e(e)}finally{n.f()}d.when.apply(d,r).then(function(){for(var t="success",r=[],e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];for(var o=0,i=n;o<i.length;o++){var s=i[o];!0!==s&&(t="error","string"==typeof s?r.push(s):d.isArray(s)&&0<s.length&&(r=r.concat(s)))}0<r.length?MyAMS.require("i18n","alert").then(function(){var e=1===r.length?MyAMS.i18n.ERROR_OCCURED:MyAMS.i18n.ERRORS_OCCURED;MyAMS.alert.alert({parent:u,status:"danger",header:e,message:r}),c(t)}):c(t)},function(){e("error")})}else c("success")})}function l(e,t,r){var n=r.data("ams-loading-text")||r.text().trim();n?(r.data("original-text",r.text()).prop("disabled",!0).text("".concat(n,"...")),d("<div>").addClass("progress").appendTo(r)):r.data("original-html",r.html()).prop("disabled",!0).html('<i class="fa fa-cog fa-spin"></i>')}function g(e,t,r){d(".progress",r).remove();var n=r.data("original-text");n?r.text(n):(n=r.data("original-html"))&&r.html(n),r.prop("disabled",!1)}function y(e,t,r,n,a,o){a=d.extend({},r.amsFormData,a.amsFormData,o.data),o=n.attr("name");return o&&(a[o]=n.val()),a}function M(e,t,r,n,a,o){var i=t.initDataCallback;i&&d.extend(n,i(e,t,r,n,a,o)),e.trigger("init-data.ams.form",[n,o])}function p(e,t){return d(t.submitTarget)}e.form=o;var b=d.templates({markup:'\n\t<div class="row m-3">\n\t\t<div class="text-center w-100">\n\t\t\t<i class="fa fa-3x fa-cog fa-spin"></i>\n\t\t\t{{if message}}\n\t\t\t<strong>{{:message}}</strong>\n\t\t\t{{/if}}\n\t\t</div>\n\t</div>'});function S(e,t,r){r.html(b.render({message:t.submitMessage})),r.parents(".hidden").removeClass("hidden")}function h(e,t,r){var t=r||t.submitHandler,t=t.startsWith(window.location.protocol)?t:MyAMS.ajax.getAddr()+t;return t}function v(t,o,i,e,r,s){e={url:r,type:"post",cache:!1,data:e,dataType:o.datatype,beforeSerialize:function(e){var t={veto:!1};if(e.trigger("before-serialize.ams.form",[t]),t.veto)return!1;void 0!==window.tinyMCE&&tinyMCE.triggerSave()},beforeSubmit:function(e,t){var r={veto:!1};if(t.trigger("before-submit.ams.form",[e,r]),r.veto)return!1;t.data("submitted",!0),o.resetBeforeSubmit&&setTimeout(function(){o.resetSubmitButton(t,o,i)},250)},uploadProgress:function(e,t,r,n){d(".progress",i).css("background-image","linear-gradient(to right, white -45%, green ".concat(n,"%, red ").concat(n,"%, red)"))},complete:function(e){t.trigger("complete.ams.form",[e])},success:function(e,t,r,n){var a={veto:!1};if(n.trigger("submit-success.ams.form",[e,t,r,a]),!a.veto){!e||"error"===e.status||!1===e.closeForm||(a=n.closest(".modal-dialog")).exists()&&!o.keepModalOpen&&MyAMS.modal&&MyAMS.modal.close(a);try{o.submitCallback(n,o,s,e,t,r)}finally{o.resetAfterSubmit(n,o,i),MyAMS.form.resetChanged(n)}}},error:function(e,t,r,n){n.trigger("submit-error.ams.form",[e,t,r,s]),s&&o.resetAfterError(n,o,i,s),o.resetAfterSubmit(n,o,i)},iframe:!1};return d.extend({},e,o.submitOptions)}function A(e,t,r,n){var a=t.progressHandler;if(a){var o=t.progressFieldName;n[o]=MyAMS.core.generateUUID();r=r;return t.progressTarget&&(r=d(t.progressTarget)),{handler:a,interval:t.progressInterval,fieldname:o,target:r,callback:t.progressCallback,endCallback:t.progressEndCallback}}}function x(e,t,n,a,o){var i=setTimeout(function r(){var e={};e[a.fieldname]=n[a.fieldname];MyAMS.ajax.post(a.handler,e).then(MyAMS.core.getFunctionByName(a.callback||function(e,t){d.isArray(e)&&(t=e[1],e=e[0]),"success"===t?"running"===e.status?(e.message?o.text(e.message):(t=e.progress||o.data("ams-progress-text")||MyAMS.i18n.PROGRESS,e.current?t+=": ".concat(e.current," / ").concat(e.length||100):t+="...",o.text(t)),i=setTimeout(r,a.interval)):"finished"===e.status&&s():s()}),s)},a.interval);function s(){clearTimeout(i),t.resetSubmitButton(e,t,o),MyAMS.core.executeFunctionByName(a.endCallback,document,e,t,o),MyAMS.form.resetChanged(e)}}function C(e,t,r,n,a,o){a.progress&&t.getProgressState(e,t,n,a.progress,o),e.ajaxSubmit(a)}function T(e,t,r,n,a,o){var i=t.datatype;switch(i||(s=MyAMS.ajax.getResponse(o))&&(i=s.contentType,n=s.data),i){case"binary":case"script":case"xml":break;case"json":MyAMS.ajax.handleJSON(n,e,r);break;default:MyAMS.form.resetChanged(e),r.css({opacity:"0.0"}),r.removeClass("hidden").parents(".hidden").removeClass(".hidden"),r.html(n).delay(50).animate({opacity:"1.0"},250),MyAMS.core.executeFunctionByName(MyAMS.config.initContent,document,r).then(function(){MyAMS.require("ajax").then(function(){MyAMS.ajax.check(d.fn.scrollTo,"".concat(MyAMS.env.baseURL,"../ext/jquery-scrollto").concat(MyAMS.env.extext,".js")).then(function(){d("#main").scrollTo(r,{offset:-15})})})})}var s=o.getResponseHeader("X-AMS-Callback");s&&(i=o.getResponseHeader("X-AMS-Callback-Options")||"{}",MyAMS.core.executeFunctionByName(s,document,e,t,i,n,a,o)),e.trigger("after-submit.ams.form",[n])}function w(e,t,r){e.data("submitted")&&(t.resetSubmitButton(e,t,r),e.data("submitted",!1),e.removeData("ams-submit-button"),e.trigger("after-reset.ams.form"))}function k(e,t,r){d("i",r).removeClass("fa-spin").removeClass("fa-cog").addClass("fa-ambulance")}function F(e,t){return t.downloadTarget}function D(e,t,r,n){var a=d('iframe[name="'.concat(r,'"]'));a.exists()||(a=d("<iframe>").attr("name",r).hide().appendTo(MyAMS.dom.root)),d.extend(n,{iframe:!0,iframeTarget:a})}function R(e,t,r,n,a){var o=e.closest(".modal-dialog"),i=t.keepModalOpen;o.exists()&&!0!==i&&MyAMS.require("modal").then(function(){MyAMS.modal.close(o)}),a.progress||setTimeout(function(){t.resetAfterSubmit(e,t,r),MyAMS.ajax&&MyAMS.ajax.stop(),MyAMS.form.resetChanged(e)},t.resetTimeout)}window.MyAMS&&(MyAMS.env.bundle?MyAMS.config.modules.push("form"):(MyAMS.form=o,console.debug("MyAMS: form module loaded...")))});