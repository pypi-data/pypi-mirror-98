{"version":3,"sources":["mod-ajax.js"],"names":["$","MyAMS","checkCsrfHeader","request","window","Cookies","token","get","config","csrfCookieName","setRequestHeader","csrfHeaderName","ajax","check","checker","source","Promise","resolve","reject","deferred","undefined","Array","src","push","core","getScript","index","length","when","apply","then","getAddr","addr","href","attr","location","substr","lastIndexOf","start","show","stop","hide","progress","event","lengthComputable","loaded","total","console","debug","Math","round","url","params","options","startsWith","protocol","defaults","type","cache","data","param","dataType","beforeSend","settings","extend","result","status","xhr","error","post","getJSON","handleJSON","getResponse","contentType","getResponseHeader","responseXML","e","responseText","responseJSON","JSON","parse","alert","title","i18n","ERROR_OCCURED","content","NO_SERVER_RESPONSE","form","target","closeForm","require","resetChanged","modal","close","loadTarget","promises","jQuery","showErrors","open","hash","skin","loadURL","preLoadCallback","getFunctionByName","preReload","each","element","executeFunctionByName","preLoadCallbackOptions","preReloadOptions","afterLoadCallback","postReload","afterLoadCallbackOptions","postReloadOptions","endsWith","replace","reload","code","showHTTPError","warn","container","html","text","initContent","document","keepHidden","removeClass","contents","message","smallBox","icon","timeout","parent","header","subtitle","messagebox","messageBox","smallbox","trigger","eventOptions","events","callback","callbacks","module","all","response","statusText","toUpperCase","parsedResponse","jest","env","baseURL","extext","ajaxSettings","ajaxSetup","safeMethods","indexOf","progressUpload","addEventListener","evt","ajaxStart","ajaxStop","ajaxError","bundle","modules"],"mappings":"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","sourcesContent":["/* global jQuery, MyAMS, Cookies */\n/**\n * MyAMS AJAX features\n */\n\nconst $ = MyAMS.$;\n\n\n/**\n * CSRF cookie checker\n *\n * Automatically set CSRF request header when CSRF cookie was specified.\n *\n * @param request: outgoing request\n */\nfunction checkCsrfHeader(request /*, options */) {\n\tif (window.Cookies) {\n\t\tconst token = Cookies.get(MyAMS.config.csrfCookieName);\n\t\tif (token) {\n\t\t\trequest.setRequestHeader(MyAMS.config.csrfHeaderName, token);\n\t\t}\n\t}\n}\n\n\nexport const ajax = {\n\n\t/**\n\t * Check for a given feature, and download script if necessary\n\t *\n\t * @param checker: pointer to a resource which will be downloaded if undefined\n\t * @param source: URL of a javascript file containing requested resource\n\t * @param callback: pointer to a function which will be called after the script is\n\t * \t\tdownloaded; first argument of this callback is a boolean value indicating if the\n\t * \t    script was downloaded for the first time or not\n\t * @param options: additional callback options argument\n\t */\n\tcheck: (checker, source) => {\n\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tconst deferred = [];\n\n\t\t\tif (checker === undefined) {\n\t\t\t\tif (!(source instanceof Array)) {\n\t\t\t\t\tsource = [source];\n\t\t\t\t}\n\t\t\t\tfor (const src of source) {\n\t\t\t\t\tdeferred.push(MyAMS.core.getScript(src));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!(checker instanceof Array)) {\n\t\t\t\t\tchecker = [checker];\n\t\t\t\t}\n\t\t\t\tfor (let index = 0; index < checker.length; index++) {\n\t\t\t\t\tif (checker[index] === undefined) {\n\t\t\t\t\t\tdeferred.push(MyAMS.core.getScript(source[index]));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t$.when.apply($, deferred).then(() => {\n\t\t\t\tresolve(deferred.length > 0);\n\t\t\t}, reject);\n\t\t});\n\t},\n\n\t/**\n\t * Get AJAX URL relative to current page\n\t *\n\t * @param addr\n\t */\n\tgetAddr: function(addr) {\n\t\tconst href = addr || $('html head base').attr('href') || window.location.href;\n\t\treturn href.substr(0, href.lastIndexOf('/') + 1);\n\t},\n\n\t/**\n\t * JQuery AJAX start callback\n\t */\n\tstart: function() {\n\t\t$('#ajax-gear').show();\n\t},\n\n\t/**\n\t * JQuery AJAX stop callback\n\t */\n\tstop: function() {\n\t\t$('#ajax-gear').hide();\n\t},\n\n\t/**\n\t * Hnadle AJAX upload or download progress event\n\t *\n\t * @param event: source event\n\t */\n\tprogress: function(event) {\n\t\tif (!event.lengthComputable) {\n\t\t\treturn;\n\t\t}\n\t\tif (event.loaded >= event.total) {\n\t\t\treturn;\n\t\t}\n\t\tif (console) {\n\t\t\tconsole.debug && console.debug(`${Math.round(event.loaded / event.total * 100)}%`);\n\t\t}\n\t},\n\n\t/**\n\t * Get data from given URL.\n\t * This is a simple wrapper around JQuery AJAX api to keep MyAMS API consistent\n\t *\n\t * @param url: target URL\n\t * @param params: url params\n\t * @param options: AJAX call options\n\t */\n\tget: function(url, params, options) {\n\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tlet addr;\n\t\t\tif (url.startsWith(window.location.protocol)) {\n\t\t\t\taddr = url;\n\t\t\t} else {\n\t\t\t\taddr = MyAMS.ajax.getAddr() + url;\n\t\t\t}\n\n\t\t\tconst defaults = {\n\t\t\t\turl: addr,\n\t\t\t\ttype: 'get',\n\t\t\t\tcache: false,\n\t\t\t\tdata: $.param(params || null),\n\t\t\t\tdataType: 'json',\n\t\t\t\tbeforeSend: checkCsrfHeader\n\t\t\t};\n\t\t\tconst settings = $.extend({}, defaults, options);\n\t\t\t$.ajax(settings).then((result, status, xhr) => {\n\t\t\t\tresolve(result, status, xhr);\n\t\t\t}, (xhr, status, error) => {\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Post data to given URL\n\t *\n\t * @param url: target URL\n\t * @param data: submit data\n\t * @param options: AJAX call options\n\t */\n\tpost: function(url, data, options) {\n\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tlet addr;\n\t\t\tif (url.startsWith(window.location.protocol)) {\n\t\t\t\taddr = url;\n\t\t\t} else {\n\t\t\t\taddr = MyAMS.ajax.getAddr() + url;\n\t\t\t}\n\n\t\t\tconst defaults = {\n\t\t\t\turl: addr,\n\t\t\t\ttype: 'post',\n\t\t\t\tcache: false,\n\t\t\t\tdata: $.param(data || null),\n\t\t\t\tdataType: 'json',\n\t\t\t\tbeforeSend: checkCsrfHeader\n\t\t\t};\n\t\t\tconst settings = $.extend({}, defaults, options);\n\t\t\t$.ajax(settings).then((result, status, xhr) => {\n\t\t\t\tresolve(result, status, xhr);\n\t\t\t}, (xhr, status, error) => {\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Post data to given URL and handle result as JSON\n\t *\n\t * This form of function can be used in MyAMS \"href\" or \"data-ams-url\" attributes, like in\n\t * <a href=\"MyAMS.ajax.getJSON?url=...\">Click me!</a>.\n\t */\n\tgetJSON: function() {\n\t\treturn (source, options) => {\n\t\t\tconst url = options.url;\n\t\t\tdelete options.url;\n\t\t\treturn MyAMS.ajax.post(url, options).then(MyAMS.ajax.handleJSON);\n\t\t}\n\t},\n\n\t/**\n\t * Extract datatype and result from response object\n\t */\n\tgetResponse: function(request) {\n\t\tlet dataType = 'unknown',\n\t\t\tresult;\n\t\tif (request) {\n\t\t\tlet contentType = request.getResponseHeader('content-type');\n\t\t\tif (!contentType) {\n\t\t\t\ttry {\n\t\t\t\t\tcontentType = request.responseXML.contentType;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tcontentType = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (contentType) {\n\t\t\t\t// Get server response\n\t\t\t\tif (contentType.startsWith('application/javascript')) {\n\t\t\t\t\tresult = request.responseText;\n\t\t\t\t\tdataType = 'script';\n\t\t\t\t} else if (contentType.startsWith('text/html')) {\n\t\t\t\t\tresult = request.responseText;\n\t\t\t\t\tdataType = 'html';\n\t\t\t\t} else if (contentType.startsWith('text/xml')) {\n\t\t\t\t\tresult = request.responseText;\n\t\t\t\t\tdataType = 'xml';\n\t\t\t\t} else {\n\t\t\t\t\t// Supposed to be JSON...\n\t\t\t\t\tresult = request.responseJSON;\n\t\t\t\t\tif (result) {\n\t\t\t\t\t\tdataType = 'json';\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresult = JSON.parse(request.responseText);\n\t\t\t\t\t\t\tdataType = 'json';\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tresult = request.responseText;\n\t\t\t\t\t\t\tdataType = 'binary';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Probably no response from server...\n\t\t\t\tresult = {\n\t\t\t\t\tstatus: 'alert',\n\t\t\t\t\talert: {\n\t\t\t\t\t\ttitle: MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\t\tcontent: MyAMS.i18n.NO_SERVER_RESPONSE\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdataType = 'json';\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tcontentType: dataType,\n\t\t\tdata: result\n\t\t}\n\t},\n\n\t/**\n\t * Handle a server response in JSON format\n\t *\n\t * Result can be an object with several attributes:\n\t *  - main response status: alert, error, info, success, callback, callbacks, reload or\n\t *    redirect\n\t *  - close_form: boolean indicating if current modal should be closed\n\t *  - location: target URL for reload or redirect status\n\t *  - target: target container selector for loaded content ('#content' by default)\n\t *  - content: available for any status producing output; can be raw HTML, or an object\n\t *    with attributes:\n\t *      - target: target container selector (source form by default)\n\t *      - text or html: raw text or HTML result\n\t *  - message: available for any status producing an output message; an object with\n\t *    attributes:\n\t *      - status: message status\n\t *      -\n\t * @param result: response content\n\t * @param form: source form\n\t * @param target\n\t */\n\thandleJSON: function(result, form, target) {\n\n\t\tfunction closeForm() {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tif (form !== undefined) {\n\t\t\t\t\tMyAMS.require('form').then(() => {\n\t\t\t\t\t\tMyAMS.form.resetChanged(form);\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tif (result.closeForm !== false) {\n\t\t\t\t\t\t\tMyAMS.require('modal').then(() => {\n\t\t\t\t\t\t\t\tMyAMS.modal.close(form);\n\t\t\t\t\t\t\t}).then(resolve, reject);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tlet url = null,\n\t\t\tloadTarget = null;\n\t\tconst\n\t\t\tstatus = result.status,\n\t\t\tpromises = [];\n\n\t\tif ((target instanceof jQuery) && !target.length) {\n\t\t\ttarget = null;\n\t\t}\n\n\t\tswitch (status) {\n\n\t\t\tcase 'alert':\n\t\t\t\tif (window.alert) {\n\t\t\t\t\tconst alert = result.alert;\n\t\t\t\t\twindow.alert(`${alert.title}\\n\\n${alert.content}`);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'error':\n\t\t\t\tpromises.push(MyAMS.require('error').then(() => {\n\t\t\t\t\tMyAMS.error.showErrors(form, result);\n\t\t\t\t}));\n\t\t\t\tbreak;\n\n\t\t\tcase 'message':\n\t\t\tcase 'messagebox':\n\t\t\tcase 'smallbox':\n\t\t\t\tbreak;\n\n\t\t\tcase 'info':\n\t\t\tcase 'success':\n\t\t\tcase 'notify':\n\t\t\tcase 'callback':\n\t\t\tcase 'callbacks':\n\t\t\t\tpromises.push(closeForm());\n\t\t\t\tbreak;\n\n\t\t\tcase 'modal':\n\t\t\t\tpromises.push(MyAMS.require('modal').then(() => {\n\t\t\t\t\tMyAMS.modal.open(result.location);\n\t\t\t\t}));\n\t\t\t\tbreak;\n\n\t\t\tcase 'reload':\n\t\t\t\tcloseForm();\n\t\t\t\turl = result.location || window.location.hash;\n\t\t\t\tif (url.startsWith('#')) {\n\t\t\t\t\turl = url.substr(1);\n\t\t\t\t}\n\t\t\t\tloadTarget = $(result.target || target || '#content');\n\t\t\t\tpromises.push(MyAMS.require('skin').then(() => {\n\t\t\t\t\tMyAMS.skin.loadURL(url, loadTarget, {\n\t\t\t\t\t\tpreLoadCallback: MyAMS.core.getFunctionByName(result.preReload || function() {\n\t\t\t\t\t\t\t$('[data-ams-pre-reload]', loadTarget).each((index, element) => {\n\t\t\t\t\t\t\t\tMyAMS.core.executeFunctionByName($(element).data('ams-pre-reload'));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tpreLoadCallbackOptions: result.preReloadOptions,\n\t\t\t\t\t\tafterLoadCallback: MyAMS.core.getFunctionByName(result.postReload || function() {\n\t\t\t\t\t\t\t$('[data-ams-post-reload]', loadTarget).each((index, element) => {\n\t\t\t\t\t\t\t\tMyAMS.core.executeFunctionByName($(element).data('ams-post-reload'));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tafterLoadCallbackOptions: result.postReloadOptions\n\t\t\t\t\t});\n\t\t\t\t}));\n\t\t\t\tbreak;\n\n\t\t\tcase 'redirect':\n\t\t\t\tcloseForm();\n\t\t\t\turl = result.location || window.location.href;\n\t\t\t\tif (url.endsWith('##')) {\n\t\t\t\t\turl = url.replace(/##/, window.location.hash);\n\t\t\t\t}\n\t\t\t\tif (result.window) {\n\t\t\t\t\twindow.open(url, result.window, result.options);\n\t\t\t\t} else {\n\t\t\t\t\tif (window.location.href === url) {\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t} else {\n\t\t\t\t\t\twindow.location.href = url;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tif (result.code) {  // Standard HTTP error?\n\t\t\t\t\tpromises.push(MyAMS.require('error').then(() => {\n\t\t\t\t\t\tMyAMS.error.showHTTPError(result);\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\tif (window.console) {\n\t\t\t\t\t\tconsole.warn && console.warn(`Unhandled JSON response status: ${status}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n\n\t\t// Single content response\n\t\tif (result.content) {\n\t\t\tconst\n\t\t\t\tcontent = result.content,\n\t\t\t\tcontainer = $(content.target || target || '#content');\n\t\t\tif (typeof content === 'string') {\n\t\t\t\tcontainer.html(content);\n\t\t\t} else {\n\t\t\t\tif (content.text) {\n\t\t\t\t\tcontainer.text(content.text);\n\t\t\t\t} else {\n\t\t\t\t\tcontainer.html(content.html);\n\t\t\t\t}\n\t\t\t\tpromises.push(MyAMS.core.executeFunctionByName(MyAMS.config.initContent,\n\t\t\t\t\tdocument, container).then(() => {\n\t\t\t\t\tif (!content.keepHidden) {\n\t\t\t\t\t\tcontainer.removeClass('hidden');\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\t// Multiple contents response\n\t\tif (result.contents) {\n\t\t\tfor (const content of result.contents) {\n\t\t\t\tconst container = $(content.target);\n\t\t\t\tif (content.text) {\n\t\t\t\t\tcontainer.text(content.text)\n\t\t\t\t} else {\n\t\t\t\t\tcontainer.html(content.html);\n\t\t\t\t}\n\t\t\t\tpromises.push(MyAMS.core.executeFunctionByName(MyAMS.config.initContent,\n\t\t\t\t\tdocument, container).then(() => {\n\t\t\t\t\tif (!content.keepHidden) {\n\t\t\t\t\t\tcontainer.removeClass('hidden');\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\t// Response with message\n\t\tif (result.message && !result.code) {\n\t\t\tpromises.push(MyAMS.require('alert').then(() => {\n\t\t\t\tif (typeof result.message === 'string') {\n\t\t\t\t\tMyAMS.alert.smallBox({\n\t\t\t\t\t\tstatus: status,\n\t\t\t\t\t\tmessage: result.message,\n\t\t\t\t\t\ticon: 'fa-info-circle',\n\t\t\t\t\t\ttimeout: 3000\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst message = result.message;\n\t\t\t\t\tMyAMS.alert.alert({\n\t\t\t\t\t\tparent: form,\n\t\t\t\t\t\tstatus: message.status || status,\n\t\t\t\t\t\theader: message.header,\n\t\t\t\t\t\tsubtitle: message.subtitle,\n\t\t\t\t\t\tmessage: message.message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\t// Response with message box\n\t\tif (result.messagebox) {\n\t\t\tpromises.push(MyAMS.require('alert').then(() => {\n\t\t\t\tif (typeof result.messagebox === 'string') {\n\t\t\t\t\tMyAMS.alert.messageBox({\n\t\t\t\t\t\tstatus: status,\n\t\t\t\t\t\ttitle: MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\t\ticon: 'fa-info-circle',\n\t\t\t\t\t\tmessage: result.messagebox,\n\t\t\t\t\t\ttimeout: 10000\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst message = result.messagebox;\n\t\t\t\t\tMyAMS.alert.messageBox({\n\t\t\t\t\t\tstatus: message.status || status,\n\t\t\t\t\t\ttitle: message.title || MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\t\ticon: message.icon || 'fa-info-circle',\n\t\t\t\t\t\tmessage: message.message,\n\t\t\t\t\t\tcontent: message.content,\n\t\t\t\t\t\ttimeout: message.timeout === 0 ? 0 : (message.timeout || 10000)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\t// Response with small box\n\t\tif (result.smallbox) {\n\t\t\tpromises.push(MyAMS.require('alert').then(() => {\n\t\t\t\tif (typeof result.smallbox === 'string') {\n\t\t\t\t\tMyAMS.alert.smallBox({\n\t\t\t\t\t\tstatus: status,\n\t\t\t\t\t\tmessage: result.smallbox,\n\t\t\t\t\t\ticon: 'fa-info-circle',\n\t\t\t\t\t\ttimeout: 3000\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst message = result.smallbox;\n\t\t\t\t\tMyAMS.alert.smallBox({\n\t\t\t\t\t\tstatus: message.status || status,\n\t\t\t\t\t\tmessage: message.message,\n\t\t\t\t\t\tcontent: message.content,\n\t\t\t\t\t\ticon: message.icon || 'fa-info-circle',\n\t\t\t\t\t\ttimeout: message.timeout\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\t// Response with single event\n\t\tif (result.event) {\n\t\t\tform.trigger(result.event, result.eventOptions);\n\t\t}\n\n\t\t// Response with multiple events\n\t\tif (result.events) {\n\t\t\tfor (const event of result.events) {\n\t\t\t\tif (typeof event === 'string') {\n\t\t\t\t\tform.trigger(event, result.eventOptions);\n\t\t\t\t} else {\n\t\t\t\t\tform.trigger(event.event, event.options);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Response with single callback\n\t\tif (result.callback) {\n\t\t\tpromises.push(MyAMS.core.executeFunctionByName(result.callback, document, form,\n\t\t\t\tresult.options));\n\t\t}\n\n\t\t// Response with multiple callbacks\n\t\tif (result.callbacks) {\n\t\t\tfor (const callback of result.callbacks) {\n\t\t\t\tif (typeof callback === 'string') {\n\t\t\t\t\tpromises.push(MyAMS.core.executeFunctionByName(callback, document, form,\n\t\t\t\t\t\tresult.options));\n\t\t\t\t} else {\n\t\t\t\t\tpromises.push(MyAMS.require(callback.module || []).then(() => {\n\t\t\t\t\t\tMyAMS.core.executeFunctionByName(callback.callback, document,\n\t\t\t\t\t\t\tform, callback.options)\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.all(promises);\n\t},\n\n\t/**\n\t * JQuery AJAX error handler\n\t */\n\terror: function(event, response, request, error) {\n\t\t// user shouldn't be notified of aborted requests\n\t\tif (error === 'abort') {\n\t\t\treturn;\n\t\t}\n\t\tif (response && response.statusText && response.statusText.toUpperCase() === 'OK') {\n\t\t\treturn;\n\t\t}\n\t\tconst parsedResponse = MyAMS.ajax.getResponse(response);\n\t\tif (parsedResponse) {\n\t\t\tif (parsedResponse.contentType === 'json') {\n\t\t\t\tMyAMS.ajax.handleJSON(parsedResponse.data);\n\t\t\t} else {\n\t\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\t\tconst\n\t\t\t\t\t\ttitle = error || event.statusText || event.type,\n\t\t\t\t\t\tmessage = parsedResponse.responseText;\n\t\t\t\t\tMyAMS.alert.messageBox({\n\t\t\t\t\t\tstatus: 'error',\n\t\t\t\t\t\ttitle: MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\t\tcontent: `<h4>${title}</h4><p>${message || ''}</p>`,\n\t\t\t\t\t\ticon: 'fa-exclamation-triangle',\n\t\t\t\t\t\ttimeout: 5000\n\t\t\t\t\t});\n\t\t\t\t}, () => {\n\t\t\t\t\tif (window.console) {\n\t\t\t\t\t\tconsole.error && console.error(event);\n\t\t\t\t\t\tconsole.debug && console.debug(parsedResponse);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tif (window.console) {\n\t\t\t\tconsole.error && console.error(\"ERROR: Can't parse response!\");\n\t\t\t\tconsole.debug && console.debug(response);\n\t\t\t}\n\t\t}\n\t}\n};\n\n\n/**\n * AJAX events callbacks\n */\nif (typeof jest === 'undefined') {\n\t// don't check cookies extension in test mode!\n\tajax.check(window.Cookies, `${MyAMS.env.baseURL}../ext/js-cookie${MyAMS.env.extext}.js`)\n\t\t.then(() => {\n\t\t\tconst xhr = $.ajaxSettings.xhr;\n\t\t\t$.ajaxSetup({\n\t\t\t\tbeforeSend: (request, options) => {\n\t\t\t\t\tif (MyAMS.config.safeMethods.indexOf(options.type) < 0) {\n\t\t\t\t\t\tif (window.Cookies !== undefined) {\n\t\t\t\t\t\t\tconst token = Cookies.get(MyAMS.config.csrfCookieName);\n\t\t\t\t\t\t\tif (token) {\n\t\t\t\t\t\t\t\trequest.setRequestHeader(MyAMS.config.csrfHeaderName, token);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tprogress: ajax.progress,\n\t\t\t\tprogressUpload: ajax.progress,\n\t\t\t\txhr: function() {\n\t\t\t\t\tconst request = xhr();\n\t\t\t\t\tif (request && (typeof request.addEventListener === 'function')) {\n\t\t\t\t\t\tif (ajax.progress) {\n\t\t\t\t\t\t\trequest.addEventListener('progress', (evt) => {\n\t\t\t\t\t\t\t\tMyAMS.ajax.progress(evt);\n\t\t\t\t\t\t\t}, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn request;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n}\n\n$(document).ajaxStart(ajax.start);\n$(document).ajaxStop(ajax.stop);\n$(document).ajaxError(ajax.error);\n\n\n/**\n * Global module initialization\n */\nif (MyAMS.env.bundle) {\n\tMyAMS.config.modules.push('ajax');\n} else {\n\tMyAMS.ajax = ajax;\n\tconsole.debug(\"MyAMS: AJAX module loaded...\");\n}\n"],"file":"mod-ajax-dev.js"}