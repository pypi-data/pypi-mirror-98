{"version":3,"sources":["mod-dialog.js"],"names":["window","jQuery","$","require","shownCallbacks","hideCallbacks","dialog","registerShownCallback","callback","element","registerHideCallback","open","source","options","callbacks","sourceData","url","data","attr","amsUrl","urlGetter","call","startsWith","modal","ajax","type","cache","amsAllowCache","undefined","done","status","request","MyAMS","response","getResponse","dataType","contentType","result","handleJSON","content","wrap","parent","modalData","modalOptions","backdrop","settings","extend","amsModalOptions","amsModalinitCallback","shown","config","hide","addClass","append","on","hidden","stats","amsLogEvent","logPageview","evt","target","close","parents","remove","zIndexModal","document","e","visibleModalsCount","length","zIndex","css","setTimeout","not","first","fn","Constructor","prototype","_checkScrollbar","_setScrollbar","env","bundle","modules","push","console","debug"],"mappings":"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","sourcesContent":["/**\n * MyAMS modal dialogs support\n */\n\nif (!window.jQuery) {\n\twindow.$ = window.jQuery = require('jquery');\n}\n\nimport MyAMS, {clearContent, executeFunctionByName, initContent} from \"./ext-base\";\nimport {getFunctionByName} from \"./ext-base\";\n\n\nconst shownCallbacks = [],\n\t  hideCallbacks = [];\n\n\nexport const dialog = {\n\n\tregisterShownCallback: function(callback, element) {\n\n\t},\n\n\tregisterHideCallback: function(callback, element) {\n\n\t},\n\n\topen: function(source, options, callbacks) {\n\t\tlet sourceData = {},\n\t\t\turl = source;\n\t\tif (typeof source !== 'string') {\n\t\t\tsourceData = source.data();\n\t\t\turl = source.attr('href') || sourceData.amsUrl;\n\t\t\tconst urlGetter = getFunctionByName(url);\n\t\t\tif (typeof urlGetter === 'function') {\n\t\t\t\turl = urlGetter.call(source);\n\t\t\t}\n\t\t}\n\t\tif (!url) {\n\t\t\treturn;\n\t\t}\n\t\tif (url.startsWith('#')) {  // Open inner modal\n\t\t\t$(url).modal('show');\n\t\t} else {\n\t\t\treturn $.ajax({\n\t\t\t\ttype: 'get',\n\t\t\t\turl: url,\n\t\t\t\tcache: sourceData.amsAllowCache === undefined ? false: sourceData.amsAllowCache,\n\t\t\t\tdata: options\n\t\t\t}).done((data, status, request) => {\n\t\t\t\tMyAMS.require(['ajax'], () => {\n\t\t\t\t\tconst response = MyAMS.ajax.getResponse(request),\n\t\t\t\t\t\t  dataType = response.contentType,\n\t\t\t\t\t\t  result = response.data;\n\t\t\t\t\tswitch (dataType) {\n\t\t\t\t\t\tcase 'json':\n\t\t\t\t\t\t\tMyAMS.ajax.handleJSON(result,\n\t\t\t\t\t\t\t\t                  $($(source).data('ams-json-target') || '#content'));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'script':\n\t\t\t\t\t\tcase 'xml':\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'html':\n\t\t\t\t\t\tcase 'text':\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tconst content = $(result),\n\t\t\t\t\t\t\t\t  modal = $('.modal-dialog', content.wrap('<div></div>').parent()),\n\t\t\t\t\t\t\t\t  modalData = modal.data() || {},\n\t\t\t\t\t\t\t\t  modalOptions = {\n\t\t\t\t\t\t\t\t  \t  backdrop: modalData.backdrop === undefined ? 'static' : modalData.backdrop\n\t\t\t\t\t\t\t\t  };\n\t\t\t\t\t\t\tlet settings = $.extend({}, modalOptions, modalData.amsModalOptions);\n\t\t\t\t\t\t\tsettings = executeFunctionByName(modalData.amsModalinitCallback, modal, settings) || settings;\n\t\t\t\t\t\t\tif (callbacks) {\n\t\t\t\t\t\t\t\tif (callbacks.shown) {\n\t\t\t\t\t\t\t\t\tconfig.registerShownCallback(callbacks.shown, content);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (callbacks.hide) {\n\t\t\t\t\t\t\t\t\tconfig.registerHideCallback(callbacks.hide, content);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$('<div>').addClass('modal fade')\n\t\t\t\t\t\t\t\t\t  .data('dynamic', true)\n\t\t\t\t\t\t\t\t\t  .append(content)\n\t\t\t\t\t\t\t\t\t  .on('shown.bs.modal', dialog.shown)\n\t\t\t\t\t\t\t\t\t  .on('hidden.bs.modal', dialog.hidden)\n\t\t\t\t\t\t\t\t\t  .modal(settings);\n\t\t\t\t\t\t\tif (MyAMS.stats && !((sourceData.amsLogEvent === false) ||\n\t\t\t\t\t\t\t\t\t\t\t\t (modalData.amsLogEvent === false))) {\n\t\t\t\t\t\t\t\tMyAMS.stats.logPageview(url);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\t/**\n\t * Dynamic modal 'shown' callback\n\t * This callback is used to initialize modal's viewport size\n\t *\n\t * @param evt: source event\n\t */\n\tshown: function(evt) {\n\t\tconst modal = evt.target;\n\t\tinitContent(modal);\n\t},\n\n\t/**\n\t * Close modal associated with given element\n\t *\n\t * @param element: the element contained into closed modal\n\t */\n\tclose: function(element) {\n\t\tif (typeof element === 'string') {\n\t\t\telement = $(element);\n\t\t}\n\t\tconst modal = element.parents('.modal').data('bs.modal');\n\t\tif (modal) {\n\t\t\tmodal.hide();\n\t\t}\n\t},\n\n\t/**\n\t * Dynamic modal 'hidden' callback\n\t * This callback is used to remove dynamic modals\n\t *\n\t * @param evt: source event\n\t */\n\thidden: function(evt) {\n\t\tconst modal = $(evt.target);\n\t\tclearContent(modal);\n\t\tif (modal.data('dynamic') === true) {\n\t\t\tmodal.remove();\n\t\t}\n\t}\n};\n\n\n/**\n * Handle modal events to allow\n */\nlet zIndexModal = 1100;\n\n$(document).on('shown.bs.modal', '.modal', (e) => {\n\tconst visibleModalsCount = $('.modal:visible').length,\n\t\t  zIndex = zIndexModal + (100 * visibleModalsCount);\n\t$(e.target).css('z-index', zIndex);\n\tsetTimeout(() => {\n\t\t$('.modal-backdrop').not('.modal-stack')\n\t\t\t\t\t\t\t.first()\n\t\t\t\t\t\t\t.css('z-index', zIndex - 10)\n\t\t\t\t\t\t\t.addClass('modal-stack');\n\t}, 0);\n});\n\n$(document).on('hidden.bs.modal', '.modal', () => {\n\tif ($('.modal:visible').length) {\n\t\t$.fn.modal.Constructor.prototype._checkScrollbar();\n\t\t$.fn.modal.Constructor.prototype._setScrollbar();\n\t\t$('body').addClass('modal-open');\n\t}\n});\n\n\n/**\n * Global module initialization\n */\nif (window.MyAMS) {\n\tif (MyAMS.env.bundle) {\n\t\tMyAMS.config.modules.push('dialog');\n\t} else {\n\t\tMyAMS.dialog = dialog;\n\t\tconsole.debug(\"MyAMS: dialog module loaded...\");\n\t}\n}\n"],"file":"mod-dialog-dev.js"}