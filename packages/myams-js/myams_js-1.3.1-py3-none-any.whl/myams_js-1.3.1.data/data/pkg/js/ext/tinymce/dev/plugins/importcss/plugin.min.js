!function(){"use strict";var t,n=tinymce.util.Tools.resolve("tinymce.PluginManager"),e=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),r=tinymce.util.Tools.resolve("tinymce.EditorManager"),i=tinymce.util.Tools.resolve("tinymce.Env"),o=tinymce.util.Tools.resolve("tinymce.util.Tools"),c=function(t){return t.getParam("importcss_selector_converter")},u=function(t){return t.getParam("importcss_append")},s=(t="array",function(n){return r=typeof(e=n),(null===e?"null":"object"===r&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"===r&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":r)===t;var e,r}),a=Array.prototype.push,l=function(t,n){return function(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!s(t[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+t);a.apply(n,t[e])}return n}(function(t,n){for(var e=t.length,r=new Array(e),i=0;i<e;i++){var o=t[i];r[i]=n(o,i)}return r}(t,n))},f=function(t){var n=i.cacheSuffix;return"string"==typeof t&&(t=t.replace("?"+n,"").replace("&"+n,"")),t},m=function(t,n){var e=function(t){var n=t.getParam("skin");return!1!==n&&(n||"oxide")}(t);if(e){var i=function(t){return t.getParam("skin_url")}(t),o=i?t.documentBaseURI.toAbsolute(i):r.baseURL+"/skins/ui/"+e,c=r.baseURL+"/skins/content/";return n===o+"/content"+(t.inline?".inline":"")+".min.css"||-1!==n.indexOf(c)}return!1},p=function(t){return"string"==typeof t?function(n){return-1!==n.indexOf(t)}:t instanceof RegExp?function(n){return t.test(n)}:t},v=function(t){return t.styleSheet},g=function(t){return t.selectorText},y=function(t,n,e){var r=[],i={};o.each(t.contentCSS,(function(t){i[t]=!0})),e||(e=function(t,n){return n||i[t]});try{o.each(n.styleSheets,(function(n){!function n(i,c){var u,s=i.href;if((s=f(s))&&e(s,c)&&!m(t,s)){o.each(i.imports,(function(t){n(t,!0)}));try{u=i.cssRules||i.rules}catch(t){}o.each(u,(function(t){v(t)?n(t.styleSheet,!0):g(t)&&o.each(t.selectorText.split(","),(function(t){r.push(o.trim(t))}))}))}}(n)}))}catch(t){}return r},h=function(t,n){var e,r=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(n);if(r){var i=r[1],c=r[2].substr(1).split(".").join(" "),u=o.makeMap("a,img");return r[1]?(e={title:n},t.schema.getTextBlockElements()[i]?e.block=i:t.schema.getBlockElements()[i]||u[i.toLowerCase()]?e.selector=i:e.inline=i):r[2]&&(e={inline:"span",title:n.substr(1),classes:c}),!1!==function(t){return t.getParam("importcss_merge_classes")}(t)?e.classes=c:e.attributes={class:c},e}},d=function(t,n){return null===n||!1!==function(t){return t.getParam("importcss_exclusive")}(t)},_=function(t){t.on("init",(function(n){var r=function(){var t=[],n=[],e={};return{addItemToGroup:function(t,r){e[t]?e[t].push(r):(n.push(t),e[t]=[r])},addItem:function(n){t.push(n)},toFormats:function(){return l(n,(function(t){var n=e[t];return 0===n.length?[]:[{title:t,items:n}]})).concat(t)}}}(),i={},s=p(function(t){return t.getParam("importcss_selector_filter")}(t)),a=function(t){return o.map(t,(function(t){return o.extend({},t,{original:t,selectors:{},filter:p(t.filter),item:{text:t.title,menu:[]}})}))}(function(t){return t.getParam("importcss_groups")}(t)),f=function(n,r){if(function(t,n,e,r){return!(d(t,e)?n in r:n in e.selectors)}(t,n,r,i)){!function(t,n,e,r){d(t,e)?r[n]=!0:e.selectors[n]=!0}(t,n,r,i);var u=function(t,n,e,r){return(r&&r.selector_converter?r.selector_converter:c(t)?c(t):function(){return h(t,e)}).call(n,e,r)}(t,t.plugins.importcss,n,r);if(u){var s=u.name||e.DOM.uniqueId();return t.formatter.register(s,u),o.extend({},{title:u.title,format:s})}}return null};o.each(y(t,t.getDoc(),p(function(t){return t.getParam("importcss_file_filter")}(t))),(function(t){if(-1===t.indexOf(".mce-")&&(!s||s(t))){var n=function(t,n){return o.grep(t,(function(t){return!t.filter||t.filter(n)}))}(a,t);if(n.length>0)o.each(n,(function(n){var e=f(t,n);e&&r.addItemToGroup(n.title,e)}));else{var e=f(t,null);e&&r.addItem(e)}}}));var m=r.toFormats();t.fire("addStyleModifications",{items:m,replace:!u(t)})}))},x=function(t){return{convertSelectorToFormat:function(n){return h(t,n)}}};n.add("importcss",(function(t){return _(t),x(t)}))}();
