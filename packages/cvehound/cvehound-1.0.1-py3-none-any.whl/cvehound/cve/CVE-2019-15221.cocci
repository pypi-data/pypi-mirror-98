/// Files: sound/usb/line6/pcm.c drivers/staging/line6/pcm.c
/// Fix: 3450121997ce872eb7f1248417225827ea249710
/// Fixes: 705ececd1c60d0f5d6ef2a719008847883516970

virtual detect

@err exists@
identifier line6pcm;
position p;
@@

line6_init_pcm(...)
{
	...
(
*	line6pcm->max_packet_size_in = usb_maxpacket(...);
	...
*	line6pcm->max_packet_size_out =@p usb_maxpacket(...);
|
*	line6pcm->max_packet_size =@p usb_maxpacket(...);
)
	... when != if (!line6pcm->max_packet_size_in || !line6pcm->max_packet_size_out) { ... return -EINVAL; }
	    when != if (!line6pcm->max_packet_size) { ... return -EINVAL; }

	\(line6_create_audio_out_urbs\|create_audio_out_urbs\)(line6pcm)
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2019-15221')
