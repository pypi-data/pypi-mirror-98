/// Files: net/bluetooth/sco.c
/// Fix: f6b8c6b5543983e9de29dc14716bfa4eb3f157c4
/// Fixes: 0fc1a726f897acfa774b17eeb62b38480d1c9ea0

virtual detect

@err exists@
identifier sk, optname;
position p;
@@

sco_sock_getsockopt(..., int optname, ...)
{
	... when any
(
	switch (optname) {
	case BT_SNDMTU:
		... when != if (sk->sk_state != BT_CONNECTED) { ... break; }
*		put_user(...)@p
		...
		break;
	}
|
	switch (optname) {
	case BT_RCVMTU:
		... when != if (sk->sk_state != BT_CONNECTED) { ... break; }
*		put_user(...)@p
		...
		break;
	}
)
	... when any
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2020-35499')
