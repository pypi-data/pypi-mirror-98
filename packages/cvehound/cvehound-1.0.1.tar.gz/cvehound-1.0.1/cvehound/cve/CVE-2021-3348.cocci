/// Files: drivers/block/nbd.c
/// Fix: b98e762e3d71e893b221f871825dc64694cfb258
/// Detect-To: 9561a7ade0c205bc2ee035a2ac880478dcc1a024

virtual detect

@err exists@
identifier nbd, config;
position p;
@@

nbd_add_socket(struct nbd_device *nbd, ...)
{
	... when != blk_mq_freeze_queue(nbd->disk->queue)
*	krealloc@p(config->socks, ...)
	... when != blk_mq_unfreeze_queue(nbd->disk->queue)
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-3348')
