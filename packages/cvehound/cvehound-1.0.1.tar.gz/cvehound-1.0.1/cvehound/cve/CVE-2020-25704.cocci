/// Files: kernel/events/core.c
/// Fix: 7bdb157cdebbf95a1cd94ed2e01b338714075d00
/// Fixes: 375637bc524952f1122ea22caf5a8f1fecad8228

virtual detect

@err@
identifier ret, filename, event;
position p;
@@

perf_event_parse_addr_filter(struct perf_event *event, ...)
{
	...
	// Doesn't match if * is not placed.
	// Coccinelle bug?
*	ret = kern_path(filename, LOOKUP_FOLLOW, ...);@p
	if (ret)
		goto fail_free_name;
	... when any
fail_free_name:
	...
*	kfree(filename);
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], "ERROR: CVE-2020-25704")
