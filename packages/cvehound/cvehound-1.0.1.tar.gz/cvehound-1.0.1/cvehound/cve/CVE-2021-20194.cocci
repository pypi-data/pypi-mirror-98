/// Files: kernel/bpf/cgroup.c
/// Fix: bb8b81e396f7afbe7c50d789e2107512274d2a35
/// Fixes: 0d01da6afc5402f60325c5da31b22f7d56689b49

virtual detect

@err exists@
identifier ctx;
position p;
@@

__cgroup_bpf_run_filter_getsockopt(...)
{
	...
	get_user(ctx.optlen, ...)
	... when != if (ctx.optlen < 0) { ... }
*	copy_from_user@p(ctx.optval, optval, \(ctx.optlen\|min(ctx.optlen, ...)\))
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-20194')
