/// Files: drivers/net/wireless/rsi/rsi_91x_usb.c drivers/net/wireless/rsi/rsi_91x_main.c
/// Fix: 8b51dc7291473093c821195c4b6af85fadedbc2f
/// Detect-To: a1854fae1414dd8edfff4857fd26c3e355d43e19

virtual detect

@deinit@
identifier adapter;
@@

rsi_91x_deinit(struct rsi_hw *adapter)
{
	...
	kfree(adapter->rsi_dev);
	...
}

@err depends on deinit exists@
identifier adapter, rsi_dev;
position p;
@@

rsi_init_usb_interface(struct rsi_hw *adapter, ...)
{
	...
	adapter->rsi_dev = rsi_dev;
	...
*	kfree(rsi_dev);@p
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2019-15504')
