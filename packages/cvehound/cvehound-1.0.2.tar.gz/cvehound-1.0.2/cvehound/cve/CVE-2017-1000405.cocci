/// Files: mm/huge_memory.c
/// Fix: a8f97366452ed491d13cf1e44241bc0b5740b1f0
/// Fixes: 8310d48b125d19fcd9521d83b8293e63eb1646aa

virtual detect

@can_follow_write_pmd@
@@

can_follow_write_pmd(...)
{
	...
}

@err_touch_pmd depends on can_follow_write_pmd exists@
identifier _pmd, pmd;
position p;
statement S;
@@

touch_pmd(...)
{
	...
*	_pmd = pmd_mkyoung@p(pmd_mkdirty(*pmd));
 	if (pmdp_set_access_flags(...))
		S
	...
}

@err_touch_pud depends on can_follow_write_pmd exists@
identifier _pud, pud;
position p;
statement S;
@@

touch_pud(...)
{
	...
*	_pud = pud_mkyoung@p(pud_mkdirty(*pud));
 	if (pmdp_set_access_flags(...))
		S
	...
}


@script:python depends on detect@
p << err_touch_pmd.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2017-1000405')

@script:python depends on detect@
p << err_touch_pud.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2017-1000405')
