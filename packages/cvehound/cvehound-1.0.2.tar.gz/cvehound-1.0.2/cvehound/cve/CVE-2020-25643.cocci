/// Files: drivers/net/wan/hdlc_ppp.c
/// Fix: 66d42ed8b25b64eb63111a2b8582c5afc8bf1105
/// Fixes: e022c2f07ae52bfbd92faa273db0db2f34eb28e8

virtual detect

@fix_for exists@
identifier opt, len;
statement S;
@@

ppp_cp_parse_cr(...)
{
	...
*	for (...;...;...) {
		...
		if (... || opt[1] < 2 || ...) S
		...
		memcpy(..., opt, opt[1]);
		...
	}
	...
}

@err_for depends on !fix_for exists@
identifier opt, len;
statement S;
position p;
@@

ppp_cp_parse_cr(...)
{
	...
*	for (...;...;...)@p {
		...
	}
	...
}

@err_switch_1 exists@
statement S;
position p;
@@

ppp_cp_parse_cr(...)
{
	... when any
	switch (...) {
*		case LCP_OPTION_ACCM:
			... when != if (opt[1] < sizeof(valid_accm)) S
*			nak_len@p
			... when any
	}
	... when any
}

@err_switch_2 exists@
statement S;
position p;
@@

ppp_cp_parse_cr(...)
{
	... when any
	switch (...) {
*		case LCP_OPTION_MAGIC:@p
			... when != if (len < 6) S
			opt[5]
			...
	}
	... when any
}

@script:python depends on detect@
p << err_for.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2020-25643')

@script:python depends on detect@
p << err_switch_1.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2020-25643')

@script:python depends on detect@
p << err_switch_2.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2020-25643')
