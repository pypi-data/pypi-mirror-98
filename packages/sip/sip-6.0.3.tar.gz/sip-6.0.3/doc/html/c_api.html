
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>C API for Handwritten Code &#8212; SIP v6.0.3 Reference Guide</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/riverbank.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="shortcut icon" href="_static/logo_tn.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ABI v13 for Handwritten Code" href="abi_13.html" />
    <link rel="prev" title="Other Topics" href="other_topics.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="abi_13.html" title="ABI v13 for Handwritten Code"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="other_topics.html" title="Other Topics"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SIP v6.0.3 Reference Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">C API for Handwritten Code</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="c-api-for-handwritten-code">
<span id="ref-c-api"></span><h1>C API for Handwritten Code<a class="headerlink" href="#c-api-for-handwritten-code" title="Permalink to this headline">¶</a></h1>
<p>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">sip</span></code> module provides an API that can be used by handwritten code in
specification files.  The API has a number of versions each of which is
implemented by an ABI.  ABIs use semantic versionion so that, for example,
v12.1 is compatible with v12.0 but is incompatible with v11.0, v12.2 and v13.0.</p>
<p>The API is declared in the <code class="file docutils literal notranslate"><span class="pre">sip.h</span></code> header file.  SIP will ensure this
file is installed in a location such that the compiler will automatically find
it.</p>
<p>The details of each currently supported ABI are described in subsequent
sections.  The remainder of this section covers topics that are common to all
ABI versions.</p>
<div class="section" id="generated-type-structures">
<span id="ref-type-structures"></span><h2>Generated Type Structures<a class="headerlink" href="#generated-type-structures" title="Permalink to this headline">¶</a></h2>
<p>SIP generates an opaque type structure for each C structure, C++ class, C++
namespace, traditional named enum or mapped type being wrapped.  These are
<code class="xref c c-type docutils literal notranslate"><span class="pre">sipTypeDef</span></code> structures and are used extensively by the API.</p>
<p>The names of these structure are prefixed by <code class="docutils literal notranslate"><span class="pre">sipType_</span></code>.</p>
<p>For those structures that correspond to C structures, C++ classes, C++
namespaces or traditional named enums the remaining part of the name is the
fully qualified name of the structure, class, namespace or enum name.  Any
<code class="docutils literal notranslate"><span class="pre">::</span></code> scope separators are replaced by an underscore.  For example, the type
object for class <code class="docutils literal notranslate"><span class="pre">Klass</span></code> is <code class="docutils literal notranslate"><span class="pre">sipType_Klass</span></code>.</p>
<p>For those structure that correspond to mapped types the remaining part of the
name is generated by SIP.  The only way for handwritten code to obtain a
pointer to a structure for a mapped type is to use <a class="reference internal" href="abi_12.html#c.sipFindType" title="sipFindType"><code class="xref c c-func docutils literal notranslate"><span class="pre">sipFindType()</span></code></a>.</p>
<p>The type structures of all imported types explicitly used by a module are
available to handwritten code.</p>
</div>
<div class="section" id="generated-derived-classes">
<span id="ref-derived-classes"></span><h2>Generated Derived Classes<a class="headerlink" href="#generated-derived-classes" title="Permalink to this headline">¶</a></h2>
<p>For most C++ classes being wrapped SIP generates a derived class with the same
name prefixed by <code class="docutils literal notranslate"><span class="pre">sip</span></code>.  For example, the derived class for class <code class="docutils literal notranslate"><span class="pre">Klass</span></code>
is <code class="docutils literal notranslate"><span class="pre">sipKlass</span></code>.</p>
<p>If a C++ class doesn’t have any virtual or protected methods in it or any of
it’s super-class hierarchy then a derived class is not generated.</p>
<p>Most of the time handwritten code should ignore the derived classes.  The only
exception is that handwritten constructor code specified using the
<a class="reference internal" href="directives.html#std-directive-MethodCode"><code class="xref std std-directive docutils literal notranslate"><span class="pre">%MethodCode</span></code></a> directive should call the derived class’s constructor
(which has the same C++ signature) rather then the wrapped class’s constructor.</p>
</div>
<div class="section" id="generated-exception-objects">
<span id="ref-exception-objects"></span><h2>Generated Exception Objects<a class="headerlink" href="#generated-exception-objects" title="Permalink to this headline">¶</a></h2>
<p>SIP generates a Python object for each exception defined with the
<a class="reference internal" href="directives.html#std-directive-Exception"><code class="xref std std-directive docutils literal notranslate"><span class="pre">%Exception</span></code></a> directive.</p>
<p>These objects are named with the fully qualified exception name (i.e. including
any enclosing scope) prefixed by <code class="docutils literal notranslate"><span class="pre">sipException_</span></code>.  For example, the type
object for enum <code class="docutils literal notranslate"><span class="pre">Except</span></code> defined in class <code class="docutils literal notranslate"><span class="pre">Klass</span></code> is
<code class="docutils literal notranslate"><span class="pre">sipException_Klass_Except</span></code>.</p>
<p>The objects of all imported exceptions are available to handwritten code.</p>
</div>
<div class="section" id="event-handlers">
<h2>Event Handlers<a class="headerlink" href="#event-handlers" title="Permalink to this headline">¶</a></h2>
<p>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">sip</span></code> module will trigger a number of events.  Handwritten code can
supply handlers for these events to allow it to perform additional actions.
Each event has a type, described by the <a class="reference internal" href="abi_12.html#_CPPv412sipEventType" title="sipEventType"><code class="xref cpp cpp-enum docutils literal notranslate"><span class="pre">sipEventType</span></code></a> enum.  An
event handler is registered using <a class="reference internal" href="abi_12.html#c.sipRegisterEventHandler" title="sipRegisterEventHandler"><code class="xref c c-func docutils literal notranslate"><span class="pre">sipRegisterEventHandler()</span></code></a>.  The
signature of an event handler is specific to the event type.</p>
</div>
<div class="section" id="using-the-c-api-when-embedding">
<h2>Using the C API when Embedding<a class="headerlink" href="#using-the-c-api-when-embedding" title="Permalink to this headline">¶</a></h2>
<p>The C API is intended to be called from handwritten code in SIP generated
modules.  However it is also often necessary to call it from C/C++ applications
that embed the Python interpreter and need to pass C/C++ instances between the
application and the interpreter.</p>
<p>The API is exported by the <code class="xref py py-mod docutils literal notranslate"><span class="pre">sip</span></code> module as a <code class="docutils literal notranslate"><span class="pre">sipAPIDef</span></code> data structure
(defined in the <code class="file docutils literal notranslate"><span class="pre">sip.h</span></code> header file) containing a set of function
pointers.  The data structure is wrapped as a Python <code class="docutils literal notranslate"><span class="pre">PyCapsule</span></code> object.  It
is referenced by the name <code class="docutils literal notranslate"><span class="pre">_C_API</span></code> in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">sip</span></code> module’s dictionary.</p>
<p>Each member of the data structure is a pointer to one of the functions of the
C API.  The name of the member can be derived from the function name by
replacing the <code class="docutils literal notranslate"><span class="pre">sip</span></code> prefix with <code class="docutils literal notranslate"><span class="pre">api</span></code> and converting each word in the
name to lower case and preceding it with an underscore.  For example:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sipExportSymbol</span></code> becomes <code class="docutils literal notranslate"><span class="pre">api_export_symbol</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sipWrapperCheck</span></code> becomes <code class="docutils literal notranslate"><span class="pre">api_wrapper_check</span></code></p>
</div></blockquote>
<p>Note that the type objects that SIP generates for a wrapped module (see
<a class="reference internal" href="#ref-type-structures"><span class="std std-ref">Generated Type Structures</span></a> and <a class="reference internal" href="#ref-exception-objects"><span class="std std-ref">Generated Exception Objects</span></a>) cannot be refered
to directly and must be obtained using the <a class="reference internal" href="abi_12.html#c.sipFindType" title="sipFindType"><code class="xref c c-func docutils literal notranslate"><span class="pre">sipFindType()</span></code></a> function.
Of course, the corresponding modules must already have been imported into the
interpreter.</p>
<p>The following code fragment shows how to get a pointer to the <code class="docutils literal notranslate"><span class="pre">sipAPIDef</span></code>
data structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;sip.h&quot;</span>

<span class="n">const</span> <span class="n">sipAPIDef</span> <span class="o">*</span><span class="n">get_sip_api</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">const</span> <span class="n">sipAPIDef</span> <span class="o">*</span><span class="p">)</span><span class="n">PyCapsule_Import</span><span class="p">(</span><span class="s2">&quot;sip._C_API&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&quot;sip._C_API&quot;</span></code> should be replaced by the fully qualified name of the
<code class="xref py py-mod docutils literal notranslate"><span class="pre">sip</span></code> module.</p>
<p>If you need to install a local copy of the <code class="file docutils literal notranslate"><span class="pre">sip.h</span></code> header file then you
can do so with <strong class="program">sip-module</strong>.</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">C API for Handwritten Code</a><ul>
<li><a class="reference internal" href="#generated-type-structures">Generated Type Structures</a></li>
<li><a class="reference internal" href="#generated-derived-classes">Generated Derived Classes</a></li>
<li><a class="reference internal" href="#generated-exception-objects">Generated Exception Objects</a></li>
<li><a class="reference internal" href="#event-handlers">Event Handlers</a></li>
<li><a class="reference internal" href="#using-the-c-api-when-embedding">Using the C API when Embedding</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="other_topics.html"
                        title="previous chapter">Other Topics</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="abi_13.html"
                        title="next chapter">ABI v13 for Handwritten Code</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="abi_13.html" title="ABI v13 for Handwritten Code"
             >next</a> |</li>
        <li class="right" >
          <a href="other_topics.html" title="Other Topics"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SIP v6.0.3 Reference Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">C API for Handwritten Code</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021 Riverbank Computing Limited.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.1.
    </div>
  </body>
</html>