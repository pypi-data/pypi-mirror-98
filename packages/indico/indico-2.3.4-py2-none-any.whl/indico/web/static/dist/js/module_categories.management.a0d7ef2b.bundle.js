!function(e){function t(t){for(var a,i,c=t[0],s=t[1],l=t[2],u=0,g=[];u<c.length;u++)i=c[u],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&g.push(o[i][0]),o[i]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a]);for(d&&d(t);g.length;)g.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],a=!0,c=1;c<n.length;c++){var s=n[c];0!==o[s]&&(a=!1)}a&&(r.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},o={148:0},r=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.e=function(){return Promise.resolve()},i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/dist/";var c=window.coreJsonp=window.coreJsonp||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var d=s;r.push([1913,0]),n()}({1913:function(e,t,n){e.exports=n(1914)},1914:function(e,t,n){(function(e){!function(t){"use strict";var n={};function a(e){void 0===n[e]&&(n[e]=e,$.ajax({url:build_url(Indico.Urls.Categories.info,{category_id:e}),dataType:"json",error:function(e){e.status&&403!==e.status&&handleAjaxError(e)},success:function(t){n[e]=t}}))}function o(t,n,a){var o=e.isObject(n)?n.category.id:n,r={category_id:t};$("<div>").categorynavigator({category:n,confirmation:!0,openInDialog:!0,actionButtonText:$T.gettext("Move here"),dialogTitle:$T.ngettext("Move category","Move categories",t.length),dialogSubtitle:$T.ngettext("Select new category parent for the category","Select new category parent for {0} selected categories",t.length).format(t.length),actionOn:{categoriesWithEvents:{disabled:!0},categoriesDescendingFrom:{disabled:!0,ids:t},categories:{disabled:!0,groups:[{ids:[o],message:$T.ngettext("The category is already here","The selected categories are already here",t.length)},{ids:t,message:$T.ngettext("This is the category you are trying to move","This is one of the categories you are trying to move",t.length)}]}},onAction:function(e){$.ajax({url:a,type:"POST",data:$.extend({target_category_id:e.id},r),error:handleAjaxError,success:function(e){e.success&&location.reload()}})}})}function r(t,n,a){var o=e.isObject(t)?t.category.id:t,r=a?a.all_selected?$("#event-management").data("total"):a.event_id.length:1;$("<div>").categorynavigator({category:t,confirmation:!0,openInDialog:!0,actionButtonText:$T.gettext("Move here"),dialogTitle:$T.ngettext("Move event","Move events",r),dialogSubtitle:$T.ngettext("Select category destination for the event","Select category destination for {0} selected events".format(r),r),actionOn:{categoriesWithSubcategories:{disabled:!0},categoriesWithoutEventCreationRights:{disabled:!0},categories:{disabled:!0,ids:[o],message:$T.ngettext("The event is already here","The selected events are already here",r)}},onAction:function(e){$.ajax({url:n,type:"POST",data:$.extend({target_category_id:e.id},a||{}),error:handleAjaxError,success:function(e){e.success&&location.reload()}})}})}t.setupCategoryMoveButton=function(e){e&&a(e),$(".js-move-category").on("click",(function(){var t=$(this);o([t.data("categoryId")],n[e],t.data("href"))}))},t.setupCategoryTable=function(e){a(e);var t=$("table.category-management"),r=t.find("tbody"),i=$(".js-bulk-delete-category"),c=$(".js-bulk-move-category"),s="tr[data-category-id]",l="input[name=category_id]";function d(){return r.find(s).map((function(){return $(this).data("category-id")})).toArray()}function u(e){return $.ajax({url:t.data("sort-url"),method:"POST",data:JSON.stringify({categories:e}),dataType:"json",contentType:"application/json",error:handleAjaxError})}function g(e){e?$(".banner .js-delete-category").removeClass("disabled").attr("title",$T.gettext("Delete category")):$(".banner .js-delete-category").addClass("disabled").attr("title",$T.gettext("This category cannot be deleted because it is not empty."))}function f(){return t.find(s).find(l+":checked").map((function(){return this.value})).toArray()}function h(){return t.find(s).has(l+":checked")}$(".js-sort-categories").on("click",(function(){var e=$(this).data("sort-order"),t=d();!function(e){r.find(s).sort((function(t,n){return e*strnatcmp($(t).data("category-title").toLowerCase(),$(n).data("category-title").toLowerCase())})).detach().appendTo(r)}(e),u(d()),cornerMessage({actionLabel:$T.gettext("Undo"),actionCallback:function(){var e;return e=t,$.each(e,(function(e,t){r.find("[data-category-id="+t+"]").not(".js-move-category").detach().appendTo(r)})),u(t)},feedbackMessage:$T.gettext("The category order has been restored."),duration:1e4,message:$T.gettext("The category list has been sorted.")})})),c.on("click",(function(t){var a=$(this);t.preventDefault(),a.hasClass("disabled")||o(f(),n[e],a.data("href"))})),t.find(".js-move-category").on("click",(function(){var t=$(this);o([t.data("categoryId")],n[e],t.data("href"))})),t.find(".js-delete-category").on("indico:confirmed",(function(e){e.preventDefault();var t=$(this);$.ajax({url:t.data("href"),method:"POST",error:handleAjaxError,success:function(e){t.closest(s).remove(),g(e.is_parent_empty)}})})),enableIfChecked(r,l,i,(function(e){return 0===e.filter(":not([data-is-empty=true])").length})),i.on("click",(function(){var e=h();ajaxDialog({url:t.data("bulk-delete-url"),method:"POST",title:$T.gettext("Delete categories"),data:{category_id:f()},onClose:function(t){t&&t.success&&(e.find("input[type=checkbox]").prop("checked",!1),e.remove(),g(t.is_empty))}})})).qtip({suppress:!1,content:{text:function(){var e=h();return e.length?i.hasClass("disabled")?$T.gettext("At least one selected category cannot be deleted because it is not empty."):$T.ngettext("Delete the selected category","Delete {0} selected categories",e.length).format(e.length):$T.gettext("Select the categories to delete first.")}}}),enableIfChecked(r,l,c),c.qtip({suppress:!1,content:{text:function(){var e=h();return e.length?$T.ngettext("Move the selected category","Move the {0} selected categories",e.length).format(e.length):$T.gettext("Select the categories to move first.")}}}),r.sortable({axis:"y",containment:"parent",cursor:"move",handle:".js-handle",items:"> tr",tolerance:"pointer",update:function(){u(d())}})},t.setupCategoryEventList=function(t){a(t),enableIfChecked("#event-management","input[name=event_id]",".js-enabled-if-checked"),$(".event-management .js-move-event-to-subcategory").on("click",(function(e){e.preventDefault(),r(n[t],$(this).data("href"))})),$(".js-event-management-toolbar .js-move-events-to-subcategory").on("click",(function(a){if(a.preventDefault(),!$(this).hasClass("disabled")){var i={};o()?i.all_selected=1:i.event_id=e.map($("#event-management input[name=event_id]:checkbox:checked"),(function(e){return e.value})),r(n[t],$(this).data("href"),i)}}));var o=paginatedSelectAll({containerSelector:"#event-management",checkboxSelector:"input:checkbox[name=event_id]",allSelectedSelector:"input:checkbox[name=all_selected]",selectionMessageSelector:"#selection-message",totalRows:$("#event-management").data("total"),messages:{allSelected:function(e){return $T.ngettext("*","All {0} events in this category are currently selected.").format(e)},pageSelected:function(e,t){return $T.ngettext("Only {0} out of {1} events is currently selected.","Only {0} out of {1} events are currently selected.",e).format(e,t)}}}).isEverythingSelected},t.setupCategoryRolesList=function(){var e;(e=$("#event-roles")).on("click",".toggle-members",(function(){var e=$(this).closest("tr").next("tr").find(".slide");e.css("max-height",e[0].scrollHeight+"px"),e.toggleClass("open close")})),e.on("indico:htmlUpdated",(function(){$(this).find(".slide").each((function(){$(this).css("max-height",this.scrollHeight+"px")}))})),$("#event-roles").on("click",".js-add-members",(function(e){e.stopPropagation();var t=$(this);$("<div>").principalfield({multiChoice:!0,onAdd:function(e){$.ajax({url:t.data("href"),method:t.data("method"),data:JSON.stringify({users:e}),dataType:"json",contentType:"application/json",error:handleAjaxError,complete:IndicoUI.Dialogs.Util.progress(),success:function(e){updateHtml(t.data("update"),e)}})}}).principalfield("choose")}))}}(window)}).call(this,n(267).default)}});
//# sourceMappingURL=module_categories.management.a0d7ef2b.bundle.js.map