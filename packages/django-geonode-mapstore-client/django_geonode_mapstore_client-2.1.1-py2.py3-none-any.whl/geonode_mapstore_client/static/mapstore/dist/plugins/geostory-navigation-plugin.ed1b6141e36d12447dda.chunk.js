(window.webpackJsonp=window.webpackJsonp||[]).push([["plugins/geostory-navigation-plugin"],{"./MapStore2/web/client/plugins/GeoStoryNavigation.jsx":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/react/index.js"),o=n.n(r),i=n("./node_modules/react-redux/es/index.js"),a=n("./node_modules/reselect/es/index.js"),c=n("./MapStore2/web/client/utils/PluginsUtils.js"),s=n("./MapStore2/web/client/utils/GeoStoryUtils.js"),l=n("./MapStore2/web/client/selectors/geostory.js"),u=n("./MapStore2/web/client/selectors/router.js"),d=n("./MapStore2/web/client/reducers/geostory.js"),f=n("./MapStore2/web/client/components/misc/toolbar/Toolbar.jsx"),p=n("./node_modules/react-bootstrap/es/index.js"),m=n("./node_modules/lodash/debounce.js"),b=n.n(m),v=n("./node_modules/react-swipeable/es/index.js"),g=n("./node_modules/react-resize-detector/lib/esm/hoc/withResizeDetector.js");function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var S=function(e){var t=e.tabindex,n=e.text,r=e.selected,i=e.style;return o.a.createElement(p.Button,{tabindex:t,className:"".concat(r?"active":"btn-tray"," btn-xs btn-default"),style:i},n)},C=Object(g.a)((function(e){var t=e.currentPage,n=e.items,i=e.scrollTo,a=void 0===i?function(){}:i,c=e.width,s=e.height,l=e.deltaSwipeSize,u=void 0===l?200:l,d=e.transition,f=void 0===d?300:d,m=e.updateTimeDebounceTime,g=void 0===m?500:m,y=e.getItemStyle,E=void 0===y?function(){return{}}:y,C=function(e){var t=e.direction,n=void 0===t?"horizontal":t,o=e.deltaScroll,i=e.width,a=e.height,c=e.transition,s=w(Object(r.useState)(0),2),l=s[0],u=s[1],d=w(Object(r.useState)(0),2),f=d[0],p=d[1],m=Object(r.useRef)({x:0,y:0}),b=w(Object(r.useState)(!1),2),g=b[0],h=b[1],y=w(Object(r.useState)("start"),2),E=y[0],S=y[1],C=w(Object(r.useState)(),2),P=C[0],x=C[1],I=Object(r.useRef)(),k=Object(r.useRef)({});function M(e,t){x("move:start");var r=I.current,o=r.parentNode,i=r.getBoundingClientRect(),a=o.getBoundingClientRect();if("horizontal"===n){var s=e+i.width;e<0&&s>a.width?(u(e),m.current.x=e,S("center")):e>=0?(u(0),m.current.x=0,S("start")):s<=a.width&&(u(a.width-i.width),m.current.x=a.width-i.width,S("end"))}if("vertical"===n){var l=t+i.height;t<0&&l>a.height?(p(t),m.current.y=t,S("center")):t>=0?(p(0),m.current.y=0,S("start")):l<=a.height&&(p(a.height-i.height),m.current.y=a.height-i.height,S("end"))}setTimeout((function(){x("move:end")}),c)}function N(){var e=I.current,t=e.parentNode,r=e.getBoundingClientRect(),o=t.getBoundingClientRect();return!("horizontal"===n&&o.width>=r.width||"vertical"===n&&o.height>=r.height)}Object(r.useEffect)((function(){function e(e){var t=N();return h(N()),t?M(m.current.x-(e.deltaY>0?o:-o),m.current.y-(e.deltaY>0?o:-o)):null}var t=N();h(t);var n=I.current.parentNode;return t&&M(m.current.x,m.current.y),t&&n&&n.addEventListener&&n.addEventListener("wheel",e),function(){t&&n&&n.removeEventListener&&n.removeEventListener("wheel",e)}}),[i,a]);var D=Object(v.a)({onSwiping:function(e){e.event.stopPropagation();var t=N();return h(N()),t?M(l-e.deltaX*e.velocity,f-e.deltaY*e.velocity):null},trackTouch:!0,trackMouse:!0});function R(e,t){k.current=j(j({},k.current),{},O({},e,t))}function T(e){var t=k.current[e];if(t){var r=I.current,o=(r&&r.parentNode).getBoundingClientRect(),i=t.getBoundingClientRect();if("horizontal"===n){var a=o.width,c=o.left,s=i.width,l=i.left,u=c+a,d=l+s;return c<=l&&u>=l||c<=d&&u>=d}}return!1}return{status:P,canSwipe:g,isStartControlActive:g&&("end"===E||"center"===E),isEndControlActive:g&&("start"===E||"center"===E),positionLabel:E,coordinates:{x:l,y:f},containerPropsHandlers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.style,n=void 0===t?{}:t;return j(j({},D),{},{style:j({position:"relative",overflow:"hidden",width:"100%",height:"100%"},n)})},contentPropsHandlers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.style,r=void 0===t?{}:t;return{ref:I,style:j(j(j(j({position:"absolute",display:"flex"},c&&{transition:"transform ".concat(c,"ms ease 0s")}),{},{flexDirection:"horizontal"===n?"row":"column"},g&&"horizontal"===n&&{transform:"translateX(".concat(l,"px)")}),g&&"vertical"===n&&{transform:"translateY(".concat(f,"px)")}),r)}},itemPropsHandlers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id,n=e.onClick;return j({key:t,ref:function(e){return e&&R(t,e)}},n?{onClick:n,tabindex:T(t)?0:-1,onKeyDown:function(e){"Enter"===e.key&&n()}}:{tabindex:-1})},updateCoordinates:M,moveItemInViewById:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.margin,o=void 0===r?0:r,i=k.current[e];if(i){var a=I.current,c=a&&a.parentNode,s=c.getBoundingClientRect(),l=i.getBoundingClientRect();if("horizontal"===n){var u=s.width,d=s.left,f=l.width,p=l.left,m=d+u,b=p+f,v=d<=p&&m>=b;if(!v){var g=a.getBoundingClientRect(),h=g.left;M(-(p-h)+o,void 0)}}}},moveToDeltaSize:function(e){M(l+e,f+e)}}}({direction:"horizontal",width:c,height:s,transition:f,deltaScroll:u}),P=C.isStartControlActive,x=C.isEndControlActive,I=C.containerPropsHandlers,k=C.contentPropsHandlers,M=C.itemPropsHandlers,N=C.moveToDeltaSize,D=C.moveItemInViewById,R=t&&t.columns&&t.sectionId&&t.columns[t.sectionId]||t&&t.sectionId,T=Object(r.useRef)(null);return Object(r.useEffect)((function(){return T.current=b()((function(e){D(e,{margin:32})}),g),function(){T.current&&(T.current.cancel(),T.current=null)}}),[]),Object(r.useEffect)((function(){T.current&&(T.current.cancel(),T.current(R))}),[R]),o.a.createElement("div",h({},I(),{className:"ms-horizontal-menu"}),o.a.createElement("div",k(),n.map((function(e){var n=e.title,r=e.id,i=M({id:r,onClick:function(){t&&t.sectionId!==r&&a(r)}});return o.a.createElement("div",h({},i,{className:"ms-menu-item"}),o.a.createElement(S,{tabindex:"-1",id:r,text:n||"title",selected:r===R,style:E(r===R)}))}))),P&&o.a.createElement(p.Button,{className:"square-button-md no-border",style:{position:"absolute"},onClick:function(){return N(u)}},o.a.createElement(p.Glyphicon,{glyph:"chevron-left"})),x&&o.a.createElement(p.Button,{className:"square-button-md no-border",style:{position:"absolute",right:0},onClick:function(){return N(-u)}},o.a.createElement(p.Glyphicon,{glyph:"chevron-right"})))})),P=n("./node_modules/prop-types/index.js"),x=n.n(P),I=n("./MapStore2/web/client/components/misc/OverlayTrigger.jsx"),k=n("./MapStore2/web/client/components/I18N/Message.jsx"),M=n("./MapStore2/web/client/components/misc/ResizableModal.jsx");function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(){return(D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function R(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H(e);if(t){var o=H(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return B(this,n)}}function B(e,t){return!t||"object"!==N(t)&&"function"!=typeof t?z(e):t}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function H(e){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}(a,e);var t,n,r,i=A(a);function a(){var e;T(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return q(z(e=i.call.apply(i,[this].concat(n))),"checkUnsavedChanges",(function(){e.props.renderUnsavedMapChangesDialog?e.props.onCheckMapChanges(e.goHome):(e.props.onCloseUnsavedDialog(),e.goHome())})),q(z(e),"goHome",(function(){e.context.router.history.push("/")})),e}return t=a,(n=[{key:"render",value:function(){var e=this.props,t=e.tooltipPosition,n=R(e,["tooltipPosition"]),r=o.a.createElement(p.Tooltip,{id:"toolbar-home-button"},o.a.createElement(k.default,{msgId:"gohome"}));return o.a.createElement(o.a.Fragment,null,o.a.createElement(I.a,{overlay:r,placement:t},o.a.createElement(p.Button,D({id:"home-button",className:"square-button",bsStyle:"primary",onClick:this.checkUnsavedChanges,tooltip:r},n),this.props.icon)),o.a.createElement(M.a,{ref:"unsavedMapModal",show:this.props.displayUnsavedDialog||!1,onClose:this.props.onCloseUnsavedDialog,title:o.a.createElement(k.default,{msgId:"resources.maps.unsavedMapConfirmTitle"}),buttons:[{bsStyle:"primary",text:o.a.createElement(k.default,{msgId:"resources.maps.unsavedMapConfirmButtonText"}),onClick:this.goHome},{text:o.a.createElement(k.default,{msgId:"resources.maps.unsavedMapCancelButtonText"}),onClick:this.props.onCloseUnsavedDialog}],fitContent:!0},o.a.createElement("div",{className:"ms-detail-body"},o.a.createElement(k.default,{msgId:"resources.maps.unsavedMapConfirmMessage"}))))}}])&&_(t.prototype,n),r&&_(t,r),a}(o.a.Component);q(L,"propTypes",{icon:x.a.node,onCheckMapChanges:x.a.func,onCloseUnsavedDialog:x.a.func,displayUnsavedDialog:x.a.bool,renderUnsavedMapChangesDialog:x.a.bool,tooltipPosition:x.a.string}),q(L,"contextTypes",{router:x.a.object,messages:x.a.object}),q(L,"defaultProps",{icon:o.a.createElement(p.Glyphicon,{glyph:"home"}),onCheckMapChanges:function(){},onCloseUnsavedDialog:function(){},renderUnsavedMapChangesDialog:!0,tooltipPosition:"left"});var G=L,$=n("./MapStore2/web/client/utils/URLUtils.js"),F=n("./node_modules/lodash/isObject.js"),V=n.n(F);function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach((function(t){W(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var X=function(e){var t,n=e.settings,r=e.scrollTo,i=void 0===r?function(){}:r,a=e.navigableItems,c=void 0===a?[]:a,s=e.currentPage,l=void 0===s?{}:s,u=e.totalItems,d=void 0===u?1:u,p=e.currentPosition,m=void 0===p?0:p,b=e.router,v=e.buttons,g=void 0===v?[]:v,h=null==n||null===(t=n.theme)||void 0===t?void 0:t.general,y=V()(h)&&h||{},j=y.fontFamily,O=y.borderColor,w=y.color,E=y.backgroundColor,S=n||{},P=S.isTitleEnabled,x=S.isLogoEnabled,I=S.isNavbarEnabled,k=g.length>0,M=b&&b.pathname&&b.search&&"true"===Object($.a)(b.search).showHome&&b.pathname.includes("/geostory/shared"),N=I&&(null==c?void 0:c.length)>0,D=P||x||N||k||M;return o.a.createElement("div",{className:"ms-geostory-navigation-bar",style:J(J({color:w,backgroundColor:E},O&&{borderBottom:"1px solid ".concat(O)}),{},{fontFamily:j})},o.a.createElement("div",{className:"progress-bar",key:"progress-bar",style:{backgroundColor:O}},o.a.createElement("div",{className:"progress-percent",style:{width:"".concat((m+1)/d*100,"%"),backgroundColor:w}})),D&&o.a.createElement("div",{className:"ms-geostory-navigation-tools"},o.a.createElement("div",{className:"ms-geostory-navigation-toolbar"},o.a.createElement(f.a,{buttons:g}),M&&o.a.createElement(G,{bsStyle:"default",className:"square-button-md no-border",tooltipPosition:"right",renderUnsavedMapChangesDialog:!1})),o.a.createElement("div",{className:"ms-geostory-navigation-elements"},N?o.a.createElement("div",{className:"ms-geostory-navigation-navigable-items"},o.a.createElement(C,{items:c,currentPage:l,scrollTo:i,getItemStyle:function(e){return e?{color:E,backgroundColor:w}:{outlineColor:w,borderColor:w}}})):null,o.a.createElement("div",{className:"ms-geostory-navigation-metadata"},P&&o.a.createElement("div",{className:"ms-geostory-navigation-title",style:{fontSize:n.storyTitleFontSize||"14px"}},n.storyTitle),x&&o.a.createElement("div",{className:"ms-geostory-navigation-logo"},o.a.createElement("img",{src:n.thumbnail&&(n.thumbnail.data||n.thumbnail.url)||"",height:32}))))))};t.default=Object(c.d)("GeoStoryNavigation",{component:Object(i.connect)(Object(a.c)({mode:l.p,settings:l.x,currentPage:l.b,currentPosition:l.c,totalItems:l.y,navigableItems:Object(l.q)({includeAlways:!1}),pathname:u.a,search:u.b}))((function(e){var t=e.mode,n=void 0===t?s.f.VIEW:t,r=e.currentPage,i=e.currentPosition,a=e.totalItems,c=e.settings,l=e.navigableItems,u=void 0===l?[]:l,d=e.pathname,f=e.search,p=e.items,m=(void 0===p?[]:p).filter((function(e){return e.tool})).map((function(e){return{Element:e.tool}}));return n===s.f.VIEW?o.a.createElement("div",{key:"geostory-navigation",className:"ms-geostory-navigation",style:{width:"100%",position:"relative"}},o.a.createElement(X,{settings:c,currentPage:r,currentPosition:i,totalItems:a,scrollTo:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{behavior:"smooth"};Object(s.z)(e,t)},navigableItems:u,router:{pathname:d,search:f},buttons:m})):null})),reducers:{geostory:d.a}})},"./MapStore2/web/client/utils/URLUtils.js":function(e,t,n){"use strict";n.d(t,"e",(function(){return u})),n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return f})),n.d(t,"c",(function(){return p})),n.d(t,"d",(function(){return m}));var r=n("./node_modules/url/url.js"),o=n.n(r),i=n("./node_modules/lodash/lodash.js"),a=n("./node_modules/query-string/index.js"),c=n.n(a);function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=function(e){if(!e)return{};var t=!(0===e.indexOf("http")),n=t?[]:e.match(/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/);if(t){var r=window.location;n[1]=r.protocol,n[3]=r.hostname,n[4]=r.port,n[5]=e}n[4]=""!==n[4]&&n[4]?n[4]:"https:"===n[1]?"443":"80",n[5]=n[5]?n[5]:e.slice(n[0].length);var o=s(n,6),i=o[1],a=o[3],c=o[4],l=o[5],u=0===l.indexOf("/")?l.split("/")[1]:"";return{protocol:i,domain:a,port:c,rootPath:l,applicationRootPath:u}},d=function(e,t){var n=Object(i.isArray)(e)?e[0]:e,r=Object(i.isArray)(t)?t[0]:t;if(n===r)return!0;if(!n||!r)return!1;if(!Object(i.isString)(n)||!Object(i.isString)(r))return!1;var a=o.a.parse(n),c=o.a.parse(r),s=u(n),l=u(r),d=s.protocol===l.protocol,f=s.domain===l.domain,p=s.port===l.port,m=a.pathname===c.pathname,b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e===t)return!0;if(!e&&!t)return!0;var n=e?e.split("&").filter((function(e){return!!e})):[],r=t?t.split("&").filter((function(e){return!!e})):[];return Object(i.isEqual)(Object(i.sortBy)(n),Object(i.sortBy)(r))}(a.query,c.query);return d&&p&&f&&m&&b},f=function(e){return c.a.parse(e)},p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:/^(http(s{0,1}):\/\/)+?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/,n=new RegExp(t);return n.test(e)},m=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/^(http(s{0,1}):\/\/)+?[\w.\-{}]+(?:\.[\w\.-]+)+[\w\-\._~\/\;\.\%\:\&\=\?{}]+$/,r=new RegExp(n),o=r.test(e);if(!o)return!1;if(o&&!t)return!0;if(o&&t){var a=/\{(.*?)\}/.test(e);return 0===t.filter((function(e){return Object(i.find)(a,e)})).length}return!1}}}]);