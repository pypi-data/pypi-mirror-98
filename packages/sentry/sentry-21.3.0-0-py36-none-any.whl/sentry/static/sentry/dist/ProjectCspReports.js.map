{"version":3,"sources":["webpack:///./app/views/asyncView.tsx","webpack:///./app/views/settings/components/settingsPageHeader.tsx","webpack:///./app/utils/routeTitle.tsx","webpack:///./app/views/settings/projectSecurityHeaders/reportUri.tsx","webpack:///./app/components/previewFeature.tsx","webpack:///./app/data/forms/cspReports.tsx","webpack:///./app/views/settings/projectSecurityHeaders/csp.tsx"],"names":["AsyncView","title","this","getTitle","renderComponent","AsyncComponent","UnstyledSettingsPageHeader","props","icon","subtitle","action","tabs","noTitleStyles","body","isNarrow","TitleAndActions","TitleWrapper","Icon","Title","styled","Subtitle","Action","BodyWrapper","TabsWrapper","React","Component","defaultProps","p","space","theme","gray400","fontSizeLarge","SettingsPageHeader","routeTitleGen","routeName","orgSlug","withSentry","projectSlug","tmplBase","tmpl","getSecurityDsn","keyList","endpoint","length","dsn","security","getDynamicText","value","fixed","ReportUri","orgId","projectId","t","type","tct","link","to","inline","flexibleControlStateSize","PreviewFeature","size","route","formGroups","fields","name","label","help","getData","data","options","multiline","autosize","rows","placeholder","extraHelp","ProjectCspReports","params","state","project","saveOnBlur","apiMethod","initialData","apiEndpoint","access","hasAccess","disabled","forms","withPadding","href","csp","getInstructions","getReportOnlyInstructions"],"mappings":"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","file":"ProjectCspReports.js","sourcesContent":["import React from 'react';\nimport DocumentTitle from 'react-document-title';\n\nimport AsyncComponent from 'app/components/asyncComponent';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    const title = this.getTitle();\n    return (\n      <DocumentTitle title={`${title ? `${title} - ` : ''}Sentry`}>\n        {this.renderComponent()}\n      </DocumentTitle>\n    );\n  }\n}\n","import React from 'react';\nimport styled from '@emotion/styled';\n\nimport {HeaderTitle} from 'app/styles/organization';\nimport space from 'app/styles/space';\n\ntype Props = {\n  // Icon left of title\n  icon?: React.ReactNode;\n\n  // The title\n  title: React.ReactNode;\n  subtitle?: React.ReactNode;\n\n  // Disables font styles in the title. Allows for more custom titles.\n  noTitleStyles?: boolean;\n  className?: string;\n\n  // CTA button\n  action?: React.ReactNode;\n\n  body?: React.ReactNode;\n\n  tabs?: React.ReactNode;\n};\n\nclass UnstyledSettingsPageHeader extends React.Component<Props> {\n  static defaultProps = {\n    noTitleStyles: false,\n  };\n\n  render() {\n    const {\n      icon,\n      title,\n      subtitle,\n      action,\n      tabs,\n      noTitleStyles,\n      body,\n      ...props\n    } = this.props;\n\n    // If Header is narrow, use align-items to center <Action>.\n    // Otherwise, use a fixed margin to prevent an odd alignment.\n    // This is needed as Actions could be a button or a dropdown.\n    const isNarrow = !subtitle;\n\n    return (\n      <div {...props}>\n        <TitleAndActions isNarrow={isNarrow}>\n          <TitleWrapper>\n            {icon && <Icon>{icon}</Icon>}\n            {title && (\n              <Title tabs={tabs} styled={noTitleStyles}>\n                <HeaderTitle>{title}</HeaderTitle>\n                {subtitle && <Subtitle>{subtitle}</Subtitle>}\n              </Title>\n            )}\n          </TitleWrapper>\n          {action && <Action isNarrow={isNarrow}>{action}</Action>}\n        </TitleAndActions>\n\n        {body && <BodyWrapper>{body}</BodyWrapper>}\n        {tabs && <TabsWrapper>{tabs}</TabsWrapper>}\n      </div>\n    );\n  }\n}\n\ntype TitleProps = {\n  styled?: boolean;\n  tabs?: React.ReactNode;\n};\n\nconst TitleAndActions = styled('div')<{isNarrow?: boolean}>`\n  display: flex;\n  align-items: ${p => (p.isNarrow ? 'center' : 'flex-start')};\n`;\nconst TitleWrapper = styled('div')`\n  flex: 1;\n`;\n\nconst Title = styled('div')<TitleProps & React.HTMLProps<HTMLDivElement>>`\n  ${p => !p.styled && `font-size: 20px; font-weight: 600;`};\n  margin: ${space(4)} ${space(2)} ${space(3)} 0;\n`;\nconst Subtitle = styled('div')`\n  color: ${p => p.theme.gray400};\n  font-weight: 400;\n  font-size: ${p => p.theme.fontSizeLarge};\n  padding: ${space(1.5)} 0 0;\n`;\n\nconst Icon = styled('div')`\n  margin-right: ${space(1)};\n`;\n\nconst Action = styled('div')<{isNarrow?: boolean}>`\n  margin-top: ${p => (p.isNarrow ? '0' : space(4))};\n`;\n\nconst SettingsPageHeader = styled(UnstyledSettingsPageHeader)<\n  Omit<React.HTMLProps<HTMLDivElement>, keyof Props> & Props\n>`\n  font-size: 14px;\n  margin-top: -${space(4)};\n`;\n\nconst BodyWrapper = styled('div')`\n  flex: 1;\n  margin: 0 0 ${space(3)};\n`;\nconst TabsWrapper = styled('div')`\n  flex: 1;\n  margin: 0; /* sentry/components/navTabs has added margin */\n`;\n\nexport default SettingsPageHeader;\n","function routeTitleGen(\n  routeName: string,\n  orgSlug: string,\n  withSentry: boolean = true,\n  projectSlug?: string\n): string {\n  const tmplBase = `${routeName} - ${orgSlug}`;\n  const tmpl = projectSlug ? `${tmplBase} - ${projectSlug}` : tmplBase;\n\n  return withSentry ? `${tmpl} - Sentry` : tmpl;\n}\n\nexport default routeTitleGen;\n","import React from 'react';\nimport {Link} from 'react-router';\n\nimport {Panel, PanelAlert, PanelBody, PanelHeader} from 'app/components/panels';\nimport {t, tct} from 'app/locale';\nimport {ProjectKey} from 'app/types';\nimport getDynamicText from 'app/utils/getDynamicText';\nimport Field from 'app/views/settings/components/forms/field';\nimport TextCopyInput from 'app/views/settings/components/forms/textCopyInput';\n\nconst DEFAULT_ENDPOINT = 'https://sentry.example.com/api/security-report/';\n\nexport function getSecurityDsn(keyList: ProjectKey[]) {\n  const endpoint = keyList.length ? keyList[0].dsn.security : DEFAULT_ENDPOINT;\n  return getDynamicText({\n    value: endpoint,\n    fixed: DEFAULT_ENDPOINT,\n  });\n}\n\ntype Props = {\n  keyList: ProjectKey[];\n  orgId: string;\n  projectId: string;\n};\n\nexport default function ReportUri({keyList, orgId, projectId}: Props) {\n  return (\n    <Panel>\n      <PanelHeader>{t('Report URI')}</PanelHeader>\n      <PanelBody>\n        <PanelAlert type=\"info\">\n          {tct(\n            \"We've automatically pulled these credentials from your available [link:Client Keys]\",\n            {\n              link: <Link to={`/settings/${orgId}/projects/${projectId}/keys/`} />,\n            }\n          )}\n        </PanelAlert>\n        <Field inline={false} flexibleControlStateSize>\n          <TextCopyInput>{getSecurityDsn(keyList)}</TextCopyInput>\n        </Field>\n      </PanelBody>\n    </Panel>\n  );\n}\n","import React from 'react';\n\nimport Alert from 'app/components/alert';\nimport {IconLab} from 'app/icons';\nimport {t} from 'app/locale';\n\ntype Props = {\n  type?: React.ComponentProps<typeof Alert>['type'];\n};\n\nconst PreviewFeature = ({type = 'info'}: Props) => (\n  <Alert type={type} icon={<IconLab size=\"sm\" />}>\n    {t(\n      'This feature is a preview and may change in the future. Thanks for being an early adopter!'\n    )}\n  </Alert>\n);\n\nexport default PreviewFeature;\n","// Export route to make these forms searchable by label/help\nimport {t} from 'app/locale';\nimport {JsonFormObject} from 'app/views/settings/components/forms/type';\n\nexport const route = '/settings/:orgId/projects/:projectId/csp/';\n\nconst formGroups: JsonFormObject[] = [\n  {\n    // Form \"section\"/\"panel\"\n    title: 'CSP Settings',\n    fields: [\n      {\n        name: 'sentry:csp_ignored_sources_defaults',\n        type: 'boolean',\n\n        label: t('Use default ignored sources'),\n        help: t(\n          'Our default list will attempt to ignore common issues and reduce noise.'\n        ),\n        getData: data => ({options: data}),\n      },\n\n      // XXX: Org details endpoints accept these multiline inputs as a list,\n      // where as it looks like project details accepts it as a string with newlines\n      {\n        name: 'sentry:csp_ignored_sources',\n        type: 'string',\n        multiline: true,\n        autosize: true,\n        rows: 4,\n        placeholder: 'e.g.\\nfile://*\\n*.example.com\\nexample.com',\n        label: t('Additional ignored sources'),\n        help: t(\n          'Discard reports about requests from the given sources. Separate multiple entries with a newline.'\n        ),\n        extraHelp: t('Separate multiple entries with a newline.'),\n        getData: data => ({options: data}),\n      },\n    ],\n  },\n];\n\nexport default formGroups;\n","import React from 'react';\nimport {RouteComponentProps} from 'react-router';\n\nimport Access from 'app/components/acl/access';\nimport ExternalLink from 'app/components/links/externalLink';\nimport {Panel, PanelBody, PanelHeader} from 'app/components/panels';\nimport PreviewFeature from 'app/components/previewFeature';\nimport formGroups from 'app/data/forms/cspReports';\nimport {t, tct} from 'app/locale';\nimport {Project, ProjectKey} from 'app/types';\nimport routeTitleGen from 'app/utils/routeTitle';\nimport AsyncView from 'app/views/asyncView';\nimport Form from 'app/views/settings/components/forms/form';\nimport JsonForm from 'app/views/settings/components/forms/jsonForm';\nimport SettingsPageHeader from 'app/views/settings/components/settingsPageHeader';\nimport ReportUri, {\n  getSecurityDsn,\n} from 'app/views/settings/projectSecurityHeaders/reportUri';\n\ntype Props = RouteComponentProps<{orgId: string; projectId: string}, {}>;\n\ntype State = {\n  keyList: null | ProjectKey[];\n  project: null | Project;\n} & AsyncView['state'];\n\nexport default class ProjectCspReports extends AsyncView<Props, State> {\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    const {orgId, projectId} = this.props.params;\n    return [\n      ['keyList', `/projects/${orgId}/${projectId}/keys/`],\n      ['project', `/projects/${orgId}/${projectId}/`],\n    ];\n  }\n\n  getTitle() {\n    const {projectId} = this.props.params;\n    return routeTitleGen(t('Content Security Policy (CSP)'), projectId, false);\n  }\n\n  getInstructions(keyList: ProjectKey[]) {\n    return (\n      'def middleware(request, response):\\n' +\n      \"    response['Content-Security-Policy'] = \\\\\\n\" +\n      '        \"default-src *; \" \\\\\\n' +\n      \"        \\\"script-src 'self' 'unsafe-eval' 'unsafe-inline' cdn.example.com cdn.ravenjs.com; \\\" \\\\\\n\" +\n      \"        \\\"style-src 'self' 'unsafe-inline' cdn.example.com; \\\" \\\\\\n\" +\n      '        \"img-src * data:; \" \\\\\\n' +\n      '        \"report-uri ' +\n      getSecurityDsn(keyList) +\n      '\"\\n' +\n      '    return response\\n'\n    );\n  }\n\n  getReportOnlyInstructions(keyList: ProjectKey[]) {\n    return (\n      'def middleware(request, response):\\n' +\n      \"    response['Content-Security-Policy-Report-Only'] = \\\\\\n\" +\n      '        \"default-src \\'self\\'; \" \\\\\\n' +\n      '        \"report-uri ' +\n      getSecurityDsn(keyList) +\n      '\"\\n' +\n      '    return response\\n'\n    );\n  }\n\n  renderBody() {\n    const {orgId, projectId} = this.props.params;\n    const {project, keyList} = this.state;\n    if (!keyList || !project) {\n      return null;\n    }\n\n    return (\n      <div>\n        <SettingsPageHeader title={t('Content Security Policy')} />\n\n        <PreviewFeature />\n\n        <ReportUri keyList={keyList} orgId={orgId} projectId={projectId} />\n\n        <Form\n          saveOnBlur\n          apiMethod=\"PUT\"\n          initialData={project.options}\n          apiEndpoint={`/projects/${orgId}/${projectId}/`}\n        >\n          <Access access={['project:write']}>\n            {({hasAccess}) => <JsonForm disabled={!hasAccess} forms={formGroups} />}\n          </Access>\n        </Form>\n\n        <Panel>\n          <PanelHeader>{t('About')}</PanelHeader>\n\n          <PanelBody withPadding>\n            <p>\n              {tct(\n                `[link:Content Security Policy]\n            (CSP) is a security standard which helps prevent cross-site scripting (XSS),\n            clickjacking and other code injection attacks resulting from execution of\n            malicious content in the trusted web page context. It's enforced by browser\n            vendors, and Sentry supports capturing CSP violations using the standard\n            reporting hooks.`,\n                {\n                  link: (\n                    <ExternalLink href=\"https://en.wikipedia.org/wiki/Content_Security_Policy\" />\n                  ),\n                }\n              )}\n            </p>\n\n            <p>\n              {tct(\n                `To configure [csp:CSP] reports\n              in Sentry, you'll need to send a header from your server describing your\n              policy, as well specifying the authenticated Sentry endpoint.`,\n                {\n                  csp: <abbr title=\"Content Security Policy\" />,\n                }\n              )}\n            </p>\n\n            <p>\n              {t(\n                'For example, in Python you might achieve this via a simple web middleware'\n              )}\n            </p>\n            <pre>{this.getInstructions(keyList)}</pre>\n\n            <p>\n              {t(`Alternatively you can setup CSP reports to simply send reports rather than\n              actually enforcing the policy`)}\n            </p>\n            <pre>{this.getReportOnlyInstructions(keyList)}</pre>\n\n            <p>\n              {tct(\n                `We recommend setting this up to only run on a percentage of requests, as\n              otherwise you may find that you've quickly exhausted your quota. For more\n              information, take a look at [link:the article on html5rocks.com].`,\n                {\n                  link: (\n                    <a href=\"http://www.html5rocks.com/en/tutorials/security/content-security-policy/\" />\n                  ),\n                }\n              )}\n            </p>\n          </PanelBody>\n        </Panel>\n      </div>\n    );\n  }\n}\n"],"sourceRoot":""}