(window.sntryWpJsonp=window.sntryWpJsonp||[]).push([[90],{2123:function(e,t,r){"use strict";var n=r(25),i=r.n(n).a.createActions(["fetch","showAllSimilarItems","toggleUnmerge","toggleMerge","unmerge","merge","toggleCollapseFingerprint","toggleCollapseFingerprints"]);t.a=i},2124:function(e,t,r){"use strict";var n=r(24),i=r.n(n),a=r(8),o=r.n(a),s=r(30),c=r.n(s),u=r(296),l=r.n(u),g=r(25),f=r.n(g),p=r(136),d=r(33),m=r(2123),h=r(56);function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){o()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var y={listenables:[m.a],api:new h.a,init:function(){var e=this,t=this.getInitialState();Object.entries(t).forEach((function(t){var r=c()(t,2),n=r[0],i=r[1];e[n]=i}))},getInitialState:function(){return{mergedItems:[],unmergeList:new Map,unmergeState:new Map,unmergeDisabled:!0,unmergeLastCollapsed:!1,enableFingerprintCompare:!1,similarItems:[],filteredSimilarItems:[],similarLinks:"",mergeState:new Map,mergeList:[],mergedLinks:"",mergeDisabled:!1,loading:!0,error:!1}},setStateForId:function(e,t,r){return(Array.isArray(t)?t:[t]).map((function(t){var n=v(v({},e.has(t)&&e.get(t)||{}),r);return e.set(t,n),n}))},isAllUnmergedSelected:function(){var e=Array.from(this.unmergeState.values()).filter((function(e){return e.busy}))||[];return this.unmergeList.size===this.mergedItems.filter((function(e){return!!e.latestEvent})).length-e.length},onFetch:function(e){var t=this,r=e||this.toFetchArray;this.init(),this.triggerFetchState();var n=r.map((function(e){var r=e.endpoint,n=e.queryParams,i=e.dataKey;return new Promise((function(e,a){t.api.request(r,{method:"GET",data:n,success:function(t,r,n){e({dataKey:i,data:t,links:n?n.getResponseHeader("Link"):null})},error:function(e){var t,r=(null===(t=e.responseJSON)||void 0===t?void 0:t.detail)||!0;a(r)}})}))})),i={merged:function(e){return t.setStateForId(t.unmergeState,e.id,{busy:"locked"===e.state}),e},similar:function(e){var t=c()(e,2),r=t[0],n=t[1],i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.keys(e);return!t.map((function(t){return e[t]})).find((function(e){return e>=.6}))}(n),a=Object.keys(n).map((function(e){return[e,n[e]]})).reduce((function(e,t){var r=c()(t,2),n=r[0],i=r[1],a=String(n).split(":"),o=c()(a,1)[0];return e[o]||(e[o]=[]),e[o].push([n,i]),e}),{}),o=Object.keys(a).map((function(e){return[e,a[e]]})).reduce((function(e,t){var r=c()(t,2),n=r[0],i=r[1].filter((function(e){return null!==c()(e,2)[1]})),a=i.reduce((function(e,t){return e+c()(t,2)[1]}),0)/i.length;return e[n]=a,e}),{});return{issue:r,score:n,scoresByInterface:a,aggregate:o,isBelowThreshold:i}}};return e&&(this.toFetchArray=e),Promise.all(n).then((function(e){e.forEach((function(e){var r=e.dataKey,n=e.data,a=e.links,o=n.map(i[r]);t["".concat(r,"Items")]=o,t["".concat(r,"Links")]=a})),t.loading=!1,t.error=!1,t.triggerFetchState()}),(function(){t.loading=!1,t.error=!0,t.triggerFetchState()}))},onToggleMerge:function(e){var t=!1,r=this.mergeState.has(e)?this.mergeState.get(e):void 0;!0!==(null==r?void 0:r.busy)&&(this.mergeList.includes(e)?this.mergeList=this.mergeList.filter((function(t){return t!==e})):(this.mergeList=[].concat(i()(this.mergeList),[e]),t=!0),this.setStateForId(this.mergeState,e,{checked:t}),this.triggerMergeState())},onToggleUnmerge:function(e){var t=c()(e,2),r=t[0],n=t[1],i=!1,a=this.unmergeState.get(r);!0!==(null==a?void 0:a.busy)&&(this.unmergeList.has(r)?this.unmergeList.delete(r):(this.unmergeList.set(r,n),i=!0),this.setStateForId(this.unmergeState,r,{checked:i}),this.unmergeDisabled=0===this.unmergeList.size||this.isAllUnmergedSelected(),this.enableFingerprintCompare=2===this.unmergeList.size,this.triggerUnmergeState())},onUnmerge:function(e){var t=this,r=e.groupId,n=e.loadingMessage,i=e.successMessage,a=e.errorMessage,o=Array.from(this.unmergeList.keys());return new Promise((function(e,s){t.isAllUnmergedSelected()?s(new Error("Not allowed to unmerge ALL events")):(t.unmergeDisabled=!0,t.setStateForId(t.unmergeState,o,{checked:!1,busy:!0}),t.triggerUnmergeState(),Object(d.b)(n),t.api.request("/issues/".concat(r,"/hashes/"),{method:"DELETE",query:{id:o},success:function(){Object(d.c)(i),t.setStateForId(t.unmergeState,o,{checked:!1,busy:!0}),t.unmergeList.clear()},error:function(){Object(d.a)(a),t.setStateForId(t.unmergeState,o,{checked:!0,busy:!1})},complete:function(){t.unmergeDisabled=!1,e(t.triggerUnmergeState())}}))}))},onMerge:function(e){var t=this,r=e.params,n=e.query,a=e.projectId;if(r){var o=this.mergeList;return this.mergeDisabled=!0,this.setStateForId(this.mergeState,o,{busy:!0}),this.triggerMergeState(),new Promise((function(e){var s=r.orgId,c=r.groupId;Object(p.h)(t.api,{orgId:s,projectId:a||r.projectId,itemIds:[].concat(i()(o),[c]),query:n},{success:function(e){var r;null!=e&&null!==(r=e.merge)&&void 0!==r&&r.parent&&t.trigger({mergedParent:e.merge.parent}),t.setStateForId(t.mergeState,o,{checked:!1,busy:!0}),t.mergeList=[]},error:function(){t.setStateForId(t.mergeState,o,{checked:!0,busy:!1})},complete:function(){t.mergeDisabled=!1,e(t.triggerMergeState())}})}))}},onToggleCollapseFingerprints:function(){this.setStateForId(this.unmergeState,this.mergedItems.map((function(e){return e.id})),{collapsed:!this.unmergeLastCollapsed}),this.unmergeLastCollapsed=!this.unmergeLastCollapsed,this.trigger({unmergeLastCollapsed:this.unmergeLastCollapsed,unmergeState:this.unmergeState})},onToggleCollapseFingerprint:function(e){var t=this.unmergeState.has(e)&&this.unmergeState.get(e).collapsed;this.setStateForId(this.unmergeState,e,{collapsed:!t}),this.trigger({unmergeState:this.unmergeState})},triggerFetchState:function(){var e=v({similarItems:this.similarItems.filter((function(e){return!e.isBelowThreshold})),filteredSimilarItems:this.similarItems.filter((function(e){return e.isBelowThreshold}))},l()(this,["mergedItems","mergedLinks","similarLinks","mergeState","unmergeState","loading","error"]));return this.trigger(e),e},triggerUnmergeState:function(){var e=l()(this,["unmergeDisabled","unmergeState","unmergeList","enableFingerprintCompare","unmergeLastCollapsed"]);return this.trigger(e),e},triggerMergeState:function(){var e=l()(this,["mergeDisabled","mergeState","mergeList"]);return this.trigger(e),e}},O=f.a.createStore(y);t.a=O},2891:function(e,t,r){"use strict";r.r(t),r.d(t,"GroupMergedView",(function(){return le}));var n=r(8),i=r.n(n),a=r(9),o=r.n(a),s=r(10),c=r.n(s),u=r(11),l=r.n(u),g=r(12),f=r.n(g),p=r(7),d=r.n(p),m=r(1),h=r.n(m),b=r(66),v=r(2123),y=r(70),O=r(131),j=r(44),S=r(2),w=r(2124),I=r(63),k=r(327),C=r(694),L=r(96),D=r(284),F=r(54),P=r(3),E=r(336),M=r(771),U=r(15),x=r(6),q=r(0);function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=d()(e);if(t){var i=d()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}var z=function(e){l()(r,e);var t=R(r);function r(){var e;o()(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={collapsed:!1,checked:!1,busy:!1},e.listener=w.a.listen((function(t){return e.onGroupChange(t)}),void 0),e.onGroupChange=function(t){var r=t.unmergeState;if(r){var n=e.props.fingerprint,a=r.has(n)?r.get(n):void 0;a&&Object.keys(a).forEach((function(t){a[t]!==e.state[t]&&e.setState((function(e){return A(A({},e),{},i()({},t,a[t]))}))}))}},e.handleToggleEvents=function(){var t=e.props.fingerprint;v.a.toggleCollapseFingerprint(t)},e.handleToggle=function(){var t=e.props,r=t.disabled,n=t.fingerprint,i=t.event;r||e.state.busy||v.a.toggleUnmerge([n,i.id])},e}return c()(r,[{key:"componentWillUnmount",value:function(){var e;null===(e=this.listener)||void 0===e||e.call(this)}},{key:"handleLabelClick",value:function(e){e.preventDefault()}},{key:"handleCheckClick",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.disabled,r=e.event,n=e.fingerprint,i=e.organization,a=this.state,o=a.collapsed,s=a.busy,c=a.checked,u=t||s;return Object(q.f)(G,{busy:s},Object(q.f)(N,{expanded:!o},Object(q.f)(B,{onClick:this.handleToggle},Object(q.f)(E.a,{id:n,value:n,checked:c,disabled:u,onChange:this.handleCheckClick}),Object(q.f)(W,{onClick:this.handleLabelClick,htmlFor:n},n)),Object(q.f)("div",null,Object(q.f)(K,{onClick:this.handleToggleEvents},Object(q.f)(U.j,{direction:o?"down":"up",size:"xs"})))),!o&&Object(q.f)(J,{className:"event-list"},r&&Object(q.f)(V,{className:"event-details"},Object(q.f)(M.a,{data:r,organization:i,hideIcons:!0,hideLevel:!0}))))}}]),r}(h.a.Component);z.displayName="MergedItem";var G=Object(P.a)("div",{target:"e1iw1xmr0",label:"MergedGroup"})((function(e){return e.busy&&"opacity: 0.2"}),";"),B=Object(P.a)("div",{target:"e1iw1xmr1",label:"ActionWrapper"})("display:grid;grid-auto-flow:column;align-items:center;gap:",Object(x.a)(1),";input[type='checkbox']{margin:0;}"),N=Object(P.a)("div",{target:"e1iw1xmr2",label:"Controls"})("display:flex;justify-content:space-between;border-top:1px solid ",(function(e){return e.theme.innerBorder}),";background-color:",(function(e){return e.theme.gray100}),";padding:",Object(x.a)(.5)," ",Object(x.a)(1),";",(function(e){return e.expanded&&"border-bottom: 1px solid ".concat(e.theme.innerBorder)}),";",G,"{&:first-child &{border-top:none;}&:last-child &{border-top:none;border-bottom:1px solid ",(function(e){return e.theme.innerBorder}),";}}"),W=Object(P.a)("label",{target:"e1iw1xmr3",label:"Fingerprint"})("font-family:",(function(e){return e.theme.text.familyMono}),";",N," &{font-weight:400;margin:0;}"),K=Object(P.a)("span",{target:"e1iw1xmr4",label:"Collapse"})({name:"4g6ai3",styles:"cursor:pointer;"}),J=Object(P.a)("div",{target:"e1iw1xmr5",label:"MergedEventList"})({name:"1qzh383",styles:"overflow:hidden;border:none;"}),V=Object(P.a)("div",{target:"e1iw1xmr6",label:"EventDetails"})("display:flex;justify-content:space-between;.event-list &{padding:",Object(x.a)(1),";}"),H=z,Q=r(30),X=r.n(Q),Y=r(296),Z=r.n(Y),$=r(65),_=r(27),ee=r(137);function te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=d()(e);if(t){var i=d()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}var re=function(e){l()(r,e);var t=te(r);function r(){var e;o()(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).state=e.getInitialState(),e.listener=w.a.listen((function(t){return e.onGroupChange(t)}),void 0),e.onGroupChange=function(t){e.setState(Z()(t,["unmergeLastCollapsed","unmergeDisabled","unmergeList","enableFingerprintCompare"]))},e.handleShowDiff=function(t){var r=e.props,n=r.groupId,i=r.project,a=r.orgId,o=e.state.unmergeList,s=o.entries();if(2===o.size){var c=Array.from(s).map((function(e){return X()(e,2)[1]})),u=X()(c,2),l=u[0],g=u[1];Object($.openDiffModal)({targetIssueId:n,project:i,baseIssueId:n,orgId:a,baseEventId:l,targetEventId:g}),t.stopPropagation()}},e}return c()(r,[{key:"getInitialState",value:function(){var e=w.a.unmergeList,t=w.a.unmergeLastCollapsed,r=w.a.unmergeDisabled;return{enableFingerprintCompare:w.a.enableFingerprintCompare,unmergeList:e,unmergeLastCollapsed:t,unmergeDisabled:r}}},{key:"componentWillUnmount",value:function(){var e;null===(e=this.listener)||void 0===e||e.call(this)}},{key:"render",value:function(){var e=this.props,t=e.onUnmerge,r=e.onToggleCollapse,n=this.state,i=n.unmergeList,a=n.unmergeLastCollapsed,o=n.unmergeDisabled,s=n.enableFingerprintCompare,c=i&&i.size||0;return Object(q.f)(L.e,{hasButtons:!0},Object(q.f)("div",null,Object(q.f)(ee.a,{disabled:o,onConfirm:t,message:Object(S.b)("These events will be unmerged and grouped into a new issue. Are you sure you want to unmerge these events?")},Object(q.f)(_.b,{size:"small",title:Object(S.b)("Unmerging ".concat(c," events"))},Object(S.b)("Unmerge")," (",c||0,")")),Object(q.f)(ie,{size:"small",disabled:!s,onClick:this.handleShowDiff},Object(S.b)("Compare"))),Object(q.f)(_.b,{size:"small",onClick:r},a?Object(S.b)("Expand All"):Object(S.b)("Collapse All")))}}]),r}(h.a.Component);re.displayName="MergedToolbar";var ne=re,ie=Object(P.a)(_.b,{target:"e26z3oq0",label:"CompareButton"})("margin-left:",Object(x.a)(1),";");function ae(e){var t=e.fingerprints,r=void 0===t?[]:t,n=e.pageLinks,i=e.onToggleCollapse,a=e.onUnmerge,o=e.organization,s=e.groupId,c=e.project,u=r.filter((function(e){return!!e.latestEvent}));return u.length>0?Object(q.f)(h.a.Fragment,null,Object(q.f)("h2",null,Object(q.f)("span",null,Object(S.b)("Merged fingerprints with latest event"))," ",Object(q.f)(D.a,{count:u.length})),Object(q.f)(L.a,null,Object(q.f)(ne,{onToggleCollapse:i,onUnmerge:a,orgId:o.slug,project:c,groupId:s}),Object(q.f)(L.c,null,u.map((function(e){var t=e.id,r=e.latestEvent;return Object(q.f)(H,{key:t,organization:o,disabled:1===u.length,event:r,fingerprint:t})})))),n&&Object(q.f)(C.a,{pageLinks:n})):Object(q.f)(L.a,null,Object(q.f)(k.a,null,Object(q.f)("p",null,Object(S.b)("There don't seem to be any hashes for this issue."))))}ae.displayName="MergedList";var oe=Object(F.a)(ae);function se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ce(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?se(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=d()(e);if(t){var i=d()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}var le=function(e){l()(r,e);var t=ue(r);function r(){var e;o()(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).state={mergedItems:[],loading:!0,error:!1,query:e.props.location.query.query||""},e.onGroupingChange=function(t){var r=t.mergedItems,n=t.mergedLinks,i=t.loading,a=t.error;r&&e.setState({mergedItems:r,mergedLinks:n,loading:void 0!==i&&i,error:void 0!==a&&a})},e.listener=w.a.listen(e.onGroupingChange,void 0),e.fetchData=function(){v.a.fetch([{endpoint:e.getEndpoint(),dataKey:"merged",queryParams:e.props.location.query}])},e.handleUnmerge=function(){v.a.unmerge({groupId:e.props.params.groupId,loadingMessage:Object(S.b)("Unmerging eventsâ€¦"),successMessage:Object(S.b)("Events successfully queued for unmerging."),errorMessage:Object(S.b)("Unable to queue events for unmerging.")})},e}return c()(r,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"componentWillReceiveProps",value:function(e){if(e.params.groupId!==this.props.params.groupId||e.location.search!==this.props.location.search){var t=e.location.query;this.setState({query:t.query},this.fetchData)}}},{key:"componentWillUnmount",value:function(){Object(I.a)(this.listener)}},{key:"getEndpoint",value:function(){var e=this.props.params.groupId,t=ce(ce({},this.props.location.query),{},{limit:50,query:this.state.query});return"/issues/".concat(e,"/hashes/?").concat(b.stringify(t))}},{key:"render",value:function(){var e=this.props,t=e.project,r=e.params.groupId,n=this.state,i=n.loading,a=n.error,o=n.mergedItems,s=n.mergedLinks,c=a&&!i,u=!c&&!i;return Object(q.f)(h.a.Fragment,null,Object(q.f)(y.b,{type:"warning"},Object(S.b)("This is an experimental feature. Data may not be immediately available while we process unmerges.")),i&&Object(q.f)(j.default,null),c&&Object(q.f)(O.a,{message:Object(S.b)("Unable to load merged events, please try again later"),onRetry:this.fetchData}),u&&Object(q.f)(oe,{project:t,fingerprints:o,pageLinks:s,groupId:r,onUnmerge:this.handleUnmerge,onToggleCollapse:v.a.toggleCollapseFingerprints}))}}]),r}(h.a.Component);le.displayName="GroupMergedView";t.default=le}}]);
//# sourceMappingURL=GroupMerged.js.map