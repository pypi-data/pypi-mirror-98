(window.sntryWpJsonp=window.sntryWpJsonp||[]).push([[18],{2437:function(e,t,n){"use strict";var a=n(9),r=n.n(a),i=n(10),l=n.n(i),o=n(11),c=n.n(o),s=n(12),u=n.n(s),p=n(7),d=n.n(p),f=n(3),h=n(1),b=n.n(h),g=n(1067),m=n.n(g),O=n(113),j=n(33),v=n(56),y=n(27),w=n(2),x=n(177),C=n(147),k=n(332),S=n(18),R=n(196),T=n(297),U=n(15),P=n(6),A=n(223),I=n(20),M=n.n(I),V=n(29),z=n.n(V),N=n(24),B=n.n(N),D=n(8),q=n.n(D),L=n(21),E=n.n(L),J=n(42),W=n.n(J),K=n(133),F=n.n(K),H=n(59),Y=n.n(H),_=n(450),G=n(467),Q=n(5),X=n.n(Q),Z=n(120),$=n(0),ee=b.a.forwardRef((function(e,t){return Object($.f)(Z.a,X()({forwardedRef:t},e,{multiple:!0}))})),te=n(189),ne=n(31),ae=n(227),re=n(47),ie=n(157);function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach((function(t){q()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ce(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}function se(e){var t=e.data,n=e.removeProps;return Object($.f)(me,{onClick:n.onClick},Object($.f)(G.a,{actor:t.actor,size:28}))}se.displayName="ValueComponent";var ue=function(e){return"".concat(e.email&&e.email.toLowerCase()," ").concat(e.name&&e.name.toLowerCase())},pe={name:"fs1hps-SelectOwners",styles:"width:200px;;label:SelectOwners;"},de=function(e){c()(a,e);var t,n=ce(a);function a(){var e;r()(this,a);for(var t=arguments.length,i=new Array(t),l=0;l<t;l++)i[l]=arguments[l];return(e=n.call.apply(n,[this].concat(i))).state={loading:!1,inputValue:""},e.selectRef=b.a.createRef(),e.renderUserBadge=function(e){return Object($.f)(te.a,{avatarSize:24,user:e,hideEmail:!0,useLink:!1})},e.createMentionableUser=function(t){return{value:Object(S.b)(t.id),label:e.renderUserBadge(t),searchKey:ue(t),actor:{type:"user",id:t.id,name:t.name}}},e.createUnmentionableUser=function(t){var n=t.user;return oe(oe({},e.createMentionableUser(n)),{},{disabled:!0,label:Object($.f)(be,null,Object($.f)(ne.a,{position:"left",title:Object(w.b)("%s is not a member of project",n.name||n.email)},e.renderUserBadge(n)))})},e.createMentionableTeam=function(e){return{value:Object(S.a)(e.id),label:Object($.f)(te.a,{team:e}),searchKey:"#".concat(e.slug),actor:{type:"team",id:e.id,name:e.slug}}},e.createUnmentionableTeam=function(t){var n=e.props.organization.access.includes("project:write");return oe(oe({},e.createMentionableTeam(t)),{},{disabled:!0,label:Object($.f)(he,null,Object($.f)(be,null,Object($.f)(ne.a,{position:"left",title:Object(w.b)("%s is not a member of project","#".concat(t.slug))},Object($.f)(te.a,{team:t}))),Object($.f)(ne.a,{title:n?Object(w.b)("Add %s to project","#".concat(t.slug)):Object(w.b)("You do not have permission to add team to project.")},Object($.f)(ge,{size:"zero",borderless:!0,disabled:!n,onClick:e.handleAddTeamToProject.bind(E()(e),t),icon:Object($.f)(U.b,{isCircled:!0})})))})},e.handleChange=function(t){e.props.onChange(t)},e.handleInputChange=function(t){e.setState({inputValue:t}),e.props.onInputChange&&e.props.onInputChange(t)},e.queryMembers=F()((function(t,n){var a=e.props,r=a.api,i=a.organization;return r?r.requestPromise("/organizations/".concat(i.slug,"/members/"),{query:{query:t}}).then((function(e){return n(null,e)}),(function(e){return n(e)})):null}),250),e.handleLoadOptions=function(){var t=e.getMentionableUsers(),n=e.getMentionableTeams(),a=e.getTeamsNotInProject(n),r=t.map((function(e){return e.actor.id}));return new Promise((function(t,n){e.queryMembers(e.state.inputValue,(function(e,a){e?n(e):t(a)}))})).then((function(t){return t?t.filter((function(e){var t=e.user;return t&&-1===r.indexOf(t.id)})).map(e.createUnmentionableUser):[]})).then((function(e){return[].concat(B()(t),B()(n),B()(a),B()(e))}))},e}return l()(a,[{key:"componentDidUpdate",value:function(e){Y()(this.props.projects,e.projects)||this.closeSelectMenu()}},{key:"getMentionableUsers",value:function(){return x.a.getAll().map(this.createMentionableUser)}},{key:"getMentionableTeams",value:function(){var e=this.props.project,t=C.a.getBySlug(e.slug);return t?t.teams.map(this.createMentionableTeam):[]}},{key:"getTeamsNotInProject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=ae.a.getAll()||[],n=e.map((function(e){return e.actor.id}));return t.filter((function(e){return-1===n.indexOf(e.id)})).map(this.createUnmentionableTeam)}},{key:"closeSelectMenu",value:function(){if(this.selectRef.current){var e=W.a.findDOMNode(this.selectRef.current),t=null==e?void 0:e.querySelector(".Select-input input");t&&t.blur()}}},{key:"handleAddTeamToProject",value:(t=z()(M.a.mark((function e(t){var n,a,r,i,l,o;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,a=n.api,r=n.organization,i=n.project,l=n.value,o=B()(l),this.props.onChange([].concat(B()(this.props.value),[this.createMentionableTeam(t)])),e.prev=3,e.next=6,Object(_.a)(a,r.slug,i.slug,t);case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(3),this.props.onChange(o),this.closeSelectMenu();case 12:case"end":return e.stop()}}),e,this,[[3,8]])}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){return Object($.f)(ee,{name:"owners",filterOption:function(e,t){return e.data.searchKey.indexOf(t)>-1},ref:this.selectRef,loadOptions:this.handleLoadOptions,defaultOptions:!0,async:!0,clearable:!0,disabled:this.props.disabled,cache:!1,placeholder:Object(w.b)("owners"),components:{MultiValue:se},onInputChange:this.handleInputChange,onChange:this.handleChange,value:this.props.value,css:pe})}}]),a}(b.a.Component);de.displayName="SelectOwners";var fe=Object(re.a)(Object(ie.a)(de)),he=Object(f.a)("div",{target:"ewupek00",label:"Container"})({name:"gg4vpm",styles:"display:flex;justify-content:space-between;"}),be=Object(f.a)("div",{target:"ewupek01",label:"DisabledLabel"})({name:"1bjwb34",styles:"opacity:0.5;overflow:hidden;"}),ge=Object(f.a)(y.b,{target:"ewupek02",label:"AddToProjectButton"})({name:"6su6fj",styles:"flex-shrink:0;"}),me=Object(f.a)("a",{target:"ewupek03",label:"ValueWrapper"})("margin-right:",Object(P.a)(.5),";");function Oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var je={text:"",tagName:"",type:"path",owners:[],isValid:!1};function ve(e){switch(e){case"path":return"src/example/*";case"url":return"https://example.com/settings/*";case"tag":return"tag-value";default:return""}}var ye=function(e){c()(n,e);var t=Oe(n);function n(){var e;r()(this,n);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return(e=t.call.apply(t,[this].concat(i))).state=je,e.checkIsValid=function(){e.setState((function(e){return{isValid:!!e.text&&e.owners&&!!e.owners.length}}))},e.handleTypeChange=function(t){e.setState({type:t}),e.checkIsValid()},e.handleTagNameChangeValue=function(t){e.setState({tagName:t.target.value},e.checkIsValid)},e.handleChangeValue=function(t){e.setState({text:t.target.value}),e.checkIsValid()},e.handleChangeOwners=function(t){e.setState({owners:t}),e.checkIsValid()},e.handleAddRule=function(){var t=e.state,n=t.type,a=t.text,r=t.tagName,i=t.owners;if(t.isValid){var l=i.map((function(e){var t;return"team"===e.actor.type?"#".concat(e.actor.name):null===(t=x.a.getById(e.actor.id))||void 0===t?void 0:t.email})).join(" "),o=a.match(/\s/)?'"'.concat(a,'"'):a,c="".concat("tag"===n?"tags.".concat(r):n,":").concat(o," ").concat(l);e.props.onAddRule(c),e.setState(je)}else Object(j.a)("A rule needs a type, a value, and one or more issue owners.")},e.handleSelectCandidate=function(t,n){e.setState({text:t,type:n}),e.checkIsValid()},e}return l()(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.urls,a=t.paths,r=t.disabled,i=t.project,l=t.organization,o=this.state,c=o.type,s=o.text,u=o.tagName,p=o.owners,d=o.isValid;return Object($.f)(b.a.Fragment,null,(a||n)&&Object($.f)(we,null,a&&a.map((function(t){return Object($.f)(ke,{key:t,onClick:function(){return e.handleSelectCandidate(t,"path")}},Object($.f)(Se,{isCircled:!0}),Object($.f)(Ce,null,t),Object($.f)(xe,null,"[PATH]"))})),n&&n.map((function(t){return Object($.f)(ke,{key:t,onClick:function(){return e.handleSelectCandidate(t,"url")}},Object($.f)(Se,{isCircled:!0}),Object($.f)(Ce,null,t),Object($.f)(xe,null,"[URL]"))}))),Object($.f)(Re,null,Object($.f)(Te,{name:"select-type",value:c,onChange:this.handleTypeChange,options:[{value:"path",label:Object(w.b)("Path")},{value:"tag",label:Object(w.b)("Tag")},{value:"url",label:Object(w.b)("URL")}],style:{width:140},clearable:!1,disabled:r}),"tag"===c&&Object($.f)(Pe,{value:u,onChange:this.handleTagNameChangeValue,disabled:r,placeholder:"tag-name"}),Object($.f)(Ue,{value:s,onChange:this.handleChangeValue,disabled:r,placeholder:ve(c)}),Object($.f)(Ae,{direction:"right"}),Object($.f)(Ie,null,Object($.f)(fe,{organization:l,project:i,value:p,onChange:this.handleChangeOwners,disabled:r})),Object($.f)(Me,{priority:"primary",disabled:!d,onClick:this.handleAddRule,icon:Object($.f)(U.b,{isCircled:!0}),size:"small"})))}}]),n}(b.a.Component);ye.displayName="RuleBuilder";var we=Object(f.a)("div",{target:"en2gln10",label:"Candidates"})({name:"1r2f04i",styles:"margin-bottom:10px;"}),xe=Object(f.a)("div",{target:"en2gln11",label:"TypeHint"})("color:",(function(e){return e.theme.border}),";"),Ce=Object(f.a)(T.a,{target:"en2gln12",label:"StyledTextOverflow"})({name:"1rr4qq7",styles:"flex:1;"}),ke=Object(f.a)("div",{target:"en2gln13",label:"RuleCandidate"})("font-family:",(function(e){return e.theme.text.familyMono}),";border:1px solid ",(function(e){return e.theme.border}),";background-color:#f8fafd;padding-left:5px;margin-bottom:3px;cursor:pointer;overflow:hidden;display:flex;align-items:center;"),Se=Object(f.a)(U.b,{target:"en2gln14",label:"StyledIconAdd"})("color:",(function(e){return e.theme.border}),";margin-right:5px;flex-shrink:0;"),Re=Object(f.a)("div",{target:"en2gln15",label:"BuilderBar"})("display:flex;height:40px;align-items:center;margin-bottom:",Object(P.a)(2),";"),Te=Object(f.a)(R.a,{target:"en2gln16",label:"BuilderSelect"})("margin-right:",Object(P.a)(1.5),";width:50px;flex-shrink:0;"),Ue=Object(f.a)(A.a,{target:"en2gln17",label:"BuilderInput"})("padding:",Object(P.a)(1),";line-height:19px;margin-right:",Object(P.a)(.5),";"),Pe=Object(f.a)(A.a,{target:"en2gln18",label:"BuilderTagNameInput"})("padding:",Object(P.a)(1),";line-height:19px;margin-right:",Object(P.a)(.5),";width:200px;"),Ae=Object(f.a)(U.j,{target:"en2gln19",label:"Divider"})("color:",(function(e){return e.theme.border}),";flex-shrink:0;margin-right:5px;"),Ie=Object(f.a)("div",{target:"en2gln110",label:"SelectOwnersWrapper"})("display:flex;align-items:center;margin-right:",Object(P.a)(1),";"),Me=Object(f.a)(y.b,{target:"en2gln111",label:"AddButton"})("padding:",Object(P.a)(.5),";"),Ve=ye;function ze(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Ne=function(e){c()(n,e);var t=ze(n);function n(){var e;r()(this,n);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return(e=t.call.apply(t,[this].concat(i))).state={hasChanges:!1,text:null,error:null},e.handleUpdateOwnership=function(){var t=e.props,n=t.organization,a=t.project,r=e.state.text;e.setState({error:null});var i=(new v.a).requestPromise("/projects/".concat(n.slug,"/").concat(a.slug,"/ownership/"),{method:"PUT",data:{raw:r||""}});return i.then((function(){Object(j.c)(Object(w.b)("Updated issue ownership rules")),e.setState({hasChanges:!1,text:r})})).catch((function(t){e.setState({error:t.responseJSON}),403===t.status?Object(j.a)(Object(w.b)("You don't have permission to modify issue ownership rules for this project")):400===t.status&&t.responseJSON.raw&&t.responseJSON.raw[0].startsWith("Invalid rule owners:")?Object(j.a)(Object(w.b)("Unable to save issue ownership rule changes: "+t.responseJSON.raw[0])):Object(j.a)(Object(w.b)("Unable to save issue ownership rule changes"))})),i},e.handleChange=function(t){e.setState({hasChanges:!0,text:t.target.value})},e.handleAddRule=function(t){var n=e.props.initialText;e.setState((function(e){return{text:(e.text||n)+"\n"+t}}),e.handleUpdateOwnership)},e}return l()(n,[{key:"parseError",value:function(e){var t,n,a,r=null==e||null===(t=e.raw)||void 0===t?void 0:t[0];return r?r.startsWith("Invalid rule owners:")?Object($.f)(Ee,null,r):Object($.f)(De,{line:parseInt(null!==(n=null===(a=r.match(/line (\d*),/))||void 0===a?void 0:a[1])&&void 0!==n?n:"",10)-1}):null}},{key:"mentionableUsers",value:function(){return x.a.getAll().map((function(e){return{id:e.id,display:e.email,email:e.email}}))}},{key:"mentionableTeams",value:function(){var e=this.props.project,t=C.a.getBySlug(e.slug);return t?t.teams.map((function(e){return{id:e.id,display:"#".concat(e.slug),email:e.id}})):[]}},{key:"render",value:function(){var e=this,t=this.props,n=t.theme,a=t.project,r=t.organization,i=t.disabled,l=t.urls,o=t.paths,c=t.initialText,s=this.state,u=s.hasChanges,p=s.text,d=s.error;return Object($.f)(b.a.Fragment,null,Object($.f)(Ve,{urls:l,paths:o,organization:r,project:a,onAddRule:this.handleAddRule.bind(this),disabled:i}),Object($.f)("div",{style:{position:"relative"},onKeyDown:function(t){t.metaKey&&"Enter"===t.key&&e.handleUpdateOwnership()}},Object($.f)(Le,{placeholder:"#example usage\npath:src/example/pipeline/* person@sentry.io #infra\nurl:http://example.com/settings/* #product\ntags.sku_class:enterprise #enterprise",onChange:this.handleChange,disabled:i,value:Object(S.d)(p)?p:c,spellCheck:"false",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",theme:n}),Object($.f)(Be,null,Object($.f)("div",null,this.parseError(d)),Object($.f)(qe,null,Object($.f)(y.b,{size:"small",priority:"primary",onClick:this.handleUpdateOwnership,disabled:i||!u},Object(w.b)("Save Changes"))))))}}]),n}(b.a.Component);Ne.displayName="OwnerInput",Ne.defaultProps={urls:[],paths:[],disabled:!1};var Be=Object(f.a)("div",{target:"e1v4gca20",label:"ActionBar"})({name:"1lekzkb",styles:"display:flex;align-items:center;justify-content:space-between;"}),De=Object(f.a)("div",{target:"e1v4gca21",label:"SyntaxOverlay"})(k.a,";width:100%;height:",24,"px;background-color:red;opacity:0.1;pointer-events:none;position:absolute;top:",(function(e){return 4+24*e.line}),"px;"),qe=Object(f.a)("div",{target:"e1v4gca22",label:"SaveButton"})({name:"1lifesv",styles:"text-align:end;padding-top:10px;"}),Le=Object(f.a)(m.a,{target:"e1v4gca23",label:"StyledTextArea"})(k.a,";min-height:140px;overflow:auto;outline:0;width:100%;resize:none;margin:0;font-family:",(function(e){return e.theme.text.familyMono}),";word-break:break-all;white-space:pre-wrap;padding-top:",4,"px;line-height:",24,"px;"),Ee=Object(f.a)("div",{target:"e1v4gca24",label:"InvalidOwners"})("color:",(function(e){return e.theme.error}),";font-weight:bold;margin-top:12px;");t.a=Object(O.b)(Ne)}}]);
//# sourceMappingURL=CreateOwnershipRuleModal~ProjectOwnership.js.map