{"version":3,"sources":["webpack:///./app/components/projectLabel.tsx","webpack:///./app/views/settings/components/settingsProjectItem.tsx","webpack:///./app/views/settings/organizationTeams/teamProjects.tsx"],"names":["ProjectLabel","this","props","project","className","slug","React","PureComponent","ProjectItem","state","isBookmarked","handleToggleBookmark","setState","organization","Wrapper","BookmarkLink","onToggle","to","Component","BookmarkStar","space","TeamProjects","error","loading","pageLinks","unlinkedProjects","linkedProjects","fetchAll","fetchTeamProjects","fetchUnlinkedProjects","handleLinkProject","action","params","orgId","teamId","api","request","method","success","resp","ProjectActions","updateSuccess","addSuccessMessage","t","addErrorMessage","handleProjectSelected","selection","find","p","id","value","handleQueryUpdate","evt","target","prevProps","location","requestPromise","query","cursor","includeAllArgs","then","jqXHR","getResponseHeader","projects","canWrite","Set","access","has","length","sortProjects","map","StyledPanelItem","key","disabled","title","size","icon","isCircled","onClick","onRetry","otherProjects","searchKey","label","ProjectListElement","Fragment","hasButtons","style","textTransform","items","onChange","onSelect","emptyMessage","alignMenu","isOpen","projectPanelContents","PanelItem","withApi","withOrganization"],"mappings":"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","file":"TeamProjects.js","sourcesContent":["import React from 'react';\n\nimport {Project} from 'app/types';\n\ntype Props = React.HTMLProps<HTMLSpanElement> & {\n  project: Project;\n};\n\nexport default class ProjectLabel extends React.PureComponent<Props> {\n  render() {\n    const {project, ...props} = this.props;\n\n    return (\n      <span className=\"project-label\" {...props}>\n        <span className=\"project-name\">{project.slug}</span>\n      </span>\n    );\n  }\n}\n","import React from 'react';\nimport styled from '@emotion/styled';\n\nimport Link from 'app/components/links/link';\nimport ProjectLabel from 'app/components/projectLabel';\nimport BookmarkStar from 'app/components/projects/bookmarkStar';\nimport space from 'app/styles/space';\nimport {Organization, Project} from 'app/types';\n\ntype Props = {\n  project: Project;\n  organization: Organization;\n};\n\ntype State = {\n  isBookmarked: boolean;\n};\n\nclass ProjectItem extends React.Component<Props, State> {\n  state = {\n    isBookmarked: this.props.project.isBookmarked,\n  };\n\n  handleToggleBookmark = (isBookmarked: State['isBookmarked']) => {\n    this.setState({isBookmarked});\n  };\n\n  render() {\n    const {project, organization} = this.props;\n\n    return (\n      <Wrapper>\n        <BookmarkLink\n          organization={organization}\n          project={project}\n          isBookmarked={this.state.isBookmarked}\n          onToggle={this.handleToggleBookmark}\n        />\n        <Link to={`/settings/${organization.slug}/projects/${project.slug}/`}>\n          <ProjectLabel project={project} />\n        </Link>\n      </Wrapper>\n    );\n  }\n}\n\nconst Wrapper = styled('div')`\n  display: flex;\n  align-items: center;\n`;\n\nconst BookmarkLink = styled(BookmarkStar)`\n  margin-right: ${space(1)};\n  margin-top: -${space(0.25)};\n`;\n\nexport default ProjectItem;\n","import React from 'react';\nimport {RouteComponentProps} from 'react-router';\nimport styled from '@emotion/styled';\n\nimport {addErrorMessage, addSuccessMessage} from 'app/actionCreators/indicator';\nimport ProjectActions from 'app/actions/projectActions';\nimport {Client} from 'app/api';\nimport Button from 'app/components/button';\nimport DropdownAutoComplete from 'app/components/dropdownAutoComplete';\nimport DropdownButton from 'app/components/dropdownButton';\nimport LoadingError from 'app/components/loadingError';\nimport LoadingIndicator from 'app/components/loadingIndicator';\nimport Pagination from 'app/components/pagination';\nimport {Panel, PanelBody, PanelHeader, PanelItem} from 'app/components/panels';\nimport Tooltip from 'app/components/tooltip';\nimport {IconFlag, IconSubtract} from 'app/icons';\nimport {t} from 'app/locale';\nimport space from 'app/styles/space';\nimport {Organization, Project} from 'app/types';\nimport {sortProjects} from 'app/utils';\nimport withApi from 'app/utils/withApi';\nimport withOrganization from 'app/utils/withOrganization';\nimport EmptyMessage from 'app/views/settings/components/emptyMessage';\nimport ProjectListItem from 'app/views/settings/components/settingsProjectItem';\n\ntype Props = {\n  api: Client;\n  organization: Organization;\n} & RouteComponentProps<{orgId: string; teamId: string}, {}>;\n\ntype State = {\n  error: boolean;\n  loading: boolean;\n  pageLinks: null | string;\n  unlinkedProjects: Project[];\n  linkedProjects: Project[];\n};\n\ntype DropdownAutoCompleteProps = React.ComponentProps<typeof DropdownAutoComplete>;\ntype Item = Parameters<NonNullable<DropdownAutoCompleteProps['onSelect']>>[0];\n\nclass TeamProjects extends React.Component<Props, State> {\n  state: State = {\n    error: false,\n    loading: true,\n    pageLinks: null,\n    unlinkedProjects: [],\n    linkedProjects: [],\n  };\n\n  componentDidMount() {\n    this.fetchAll();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (\n      prevProps.params.orgId !== this.props.params.orgId ||\n      prevProps.params.teamId !== this.props.params.teamId\n    ) {\n      this.fetchAll();\n    }\n\n    if (prevProps.location !== this.props.location) {\n      this.fetchTeamProjects();\n    }\n  }\n\n  fetchAll = () => {\n    this.fetchTeamProjects();\n    this.fetchUnlinkedProjects();\n  };\n\n  fetchTeamProjects() {\n    const {\n      location,\n      params: {orgId, teamId},\n    } = this.props;\n\n    this.setState({loading: true});\n\n    this.props.api\n      .requestPromise(`/organizations/${orgId}/projects/`, {\n        query: {\n          query: `team:${teamId}`,\n          cursor: location.query.cursor || '',\n        },\n        includeAllArgs: true,\n      })\n      .then(([linkedProjects, _, jqXHR]) => {\n        this.setState({\n          loading: false,\n          error: false,\n          linkedProjects,\n          pageLinks: jqXHR?.getResponseHeader('Link') ?? null,\n        });\n      })\n      .catch(() => {\n        this.setState({loading: false, error: true});\n      });\n  }\n\n  fetchUnlinkedProjects(query = '') {\n    const {\n      params: {orgId, teamId},\n    } = this.props;\n\n    this.props.api\n      .requestPromise(`/organizations/${orgId}/projects/`, {\n        query: {\n          query: query ? `!team:${teamId} ${query}` : `!team:${teamId}`,\n        },\n      })\n      .then(unlinkedProjects => {\n        this.setState({unlinkedProjects});\n      });\n  }\n\n  handleLinkProject = (project: Project, action: string) => {\n    const {orgId, teamId} = this.props.params;\n    this.props.api.request(`/projects/${orgId}/${project.slug}/teams/${teamId}/`, {\n      method: action === 'add' ? 'POST' : 'DELETE',\n      success: resp => {\n        this.fetchAll();\n        ProjectActions.updateSuccess(resp);\n        addSuccessMessage(\n          action === 'add'\n            ? t('Successfully added project to team.')\n            : t('Successfully removed project from team')\n        );\n      },\n      error: () => {\n        addErrorMessage(t(\"Wasn't able to change project association.\"));\n      },\n    });\n  };\n\n  handleProjectSelected = (selection: Item) => {\n    const project = this.state.unlinkedProjects.find(p => p.id === selection.value);\n    if (project) {\n      this.handleLinkProject(project, 'add');\n    }\n  };\n\n  handleQueryUpdate = (evt: React.ChangeEvent<HTMLInputElement>) => {\n    this.fetchUnlinkedProjects(evt.target.value);\n  };\n\n  projectPanelContents(projects: Project[]) {\n    const {organization} = this.props;\n    const access = new Set(organization.access);\n    const canWrite = access.has('org:write');\n\n    return projects.length ? (\n      sortProjects(projects).map(project => (\n        <StyledPanelItem key={project.id}>\n          <ProjectListItem project={project} organization={organization} />\n          <Tooltip\n            disabled={canWrite}\n            title={t('You do not have enough permission to change project association.')}\n          >\n            <Button\n              size=\"small\"\n              disabled={!canWrite}\n              icon={<IconSubtract isCircled size=\"xs\" />}\n              onClick={() => {\n                this.handleLinkProject(project, 'remove');\n              }}\n            >\n              {t('Remove')}\n            </Button>\n          </Tooltip>\n        </StyledPanelItem>\n      ))\n    ) : (\n      <EmptyMessage size=\"large\" icon={<IconFlag size=\"xl\" />}>\n        {t(\"This team doesn't have access to any projects.\")}\n      </EmptyMessage>\n    );\n  }\n\n  render() {\n    const {linkedProjects, unlinkedProjects, error, loading} = this.state;\n\n    if (error) {\n      return <LoadingError onRetry={() => this.fetchAll()} />;\n    }\n\n    if (loading) {\n      return <LoadingIndicator />;\n    }\n\n    const access = new Set(this.props.organization.access);\n\n    const otherProjects = unlinkedProjects.map(p => ({\n      value: p.id,\n      searchKey: p.slug,\n      label: <ProjectListElement>{p.slug}</ProjectListElement>,\n    }));\n\n    return (\n      <React.Fragment>\n        <Panel>\n          <PanelHeader hasButtons>\n            <div>{t('Projects')}</div>\n            <div style={{textTransform: 'none'}}>\n              {!access.has('org:write') ? (\n                <DropdownButton\n                  disabled\n                  title={t('You do not have enough permission to associate a project.')}\n                  size=\"xsmall\"\n                >\n                  {t('Add Project')}\n                </DropdownButton>\n              ) : (\n                <DropdownAutoComplete\n                  items={otherProjects}\n                  onChange={this.handleQueryUpdate}\n                  onSelect={this.handleProjectSelected}\n                  emptyMessage={t('No projects')}\n                  alignMenu=\"right\"\n                >\n                  {({isOpen}) => (\n                    <DropdownButton isOpen={isOpen} size=\"xsmall\">\n                      {t('Add Project')}\n                    </DropdownButton>\n                  )}\n                </DropdownAutoComplete>\n              )}\n            </div>\n          </PanelHeader>\n          <PanelBody>{this.projectPanelContents(linkedProjects)}</PanelBody>\n        </Panel>\n        <Pagination pageLinks={this.state.pageLinks} {...this.props} />\n      </React.Fragment>\n    );\n  }\n}\n\nconst StyledPanelItem = styled(PanelItem)`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: ${space(2)};\n`;\n\nconst ProjectListElement = styled('div')`\n  padding: ${space(0.25)} 0;\n`;\n\nexport {TeamProjects};\n\nexport default withApi(withOrganization(TeamProjects));\n"],"sourceRoot":""}