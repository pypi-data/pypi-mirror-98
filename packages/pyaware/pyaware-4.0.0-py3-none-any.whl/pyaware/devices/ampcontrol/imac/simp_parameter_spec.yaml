# Triggers available
# state: null
# value: value that needs to change by in order to trigger
# time: seconds since last trigger
# [always]
default_cos: &default_cos
  [state]

daily_sync: &daily_sync
  [time, 86400]

parameters:
  dev-id:
    source: roll
    triggers:
      process:
        store:
          - [always]
        send:
          - *daily_sync
          - *default_cos
  address-single:
    source: block
    form:
      type: ParamMask
      address: 1038
      idx: address-single
      block: 0
      mask: 0xFF
    triggers:
      process:
        send:
          - [always]
      write:
        validators:
          - trig_type: range
            min: 0
            max: 255
  modbus-slave-address:
    source: block
    form:
      type: Param
      address: 0x40F
      idx: modbus-slave-address
      block: 0
    triggers:
      collect:
        read:
          - [deadline, 3600]
      process:
        send:
          - [always]
      write:
        validators:
          - trig_type: range
            min: 0
            max: 255
  modbus-start-address:
    source: block
    form:
      type: Param
      address: 0x410
      idx: modbus-start-address
      block: 0
    triggers:
      collect:
        read:
          - [deadline, 3600]
      process:
        send:
          - [always]
      write:
        validators:
          - trig_type: range
            min: 0
            max: 65535
  modbus-register-count:
    source: block
    form:
      type: Param
      address: 0x411
      idx: modbus-register-count
      block: 0
    triggers:
      collect:
        read:
          - [deadline, 3600]
      process:
        send:
          - [always]
      write:
        validators:
          - trig_type: range
            min: 1
            max: 16
  comms-error:
    source: poll
    form:
      type: ParamMaskBool
      address: {type: ref_param, param: address-single, null_ref: 0}
      idx: comms-error
      mask: 0x8000
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *daily_sync
          - *default_cos
          - [time, 120]
  comms-error-count:
    source: poll
    form:
      type: ParamMask
      address: {type: ref_param, param: address-single, null_ref: 0}
      idx: comms-error-count
      mask: 0x7FFF
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *daily_sync
          - *default_cos
          - [time, 120]
  raw-word-0:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *daily_sync
          - *default_cos
          - [time, 120]
  raw-word-1:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *default_cos
          - [time, 120]
  raw-word-2:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *default_cos
          - [time, 120]
  raw-word-3:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *default_cos
          - [time, 120]
  raw-word-4:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *default_cos
          - [time, 120]
  raw-word-5:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *default_cos
          - [time, 120]
  raw-word-6:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *default_cos
          - [time, 120]
  raw-word-7:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *default_cos
          - [time, 120]
  raw-word-8:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *default_cos
          - [time, 120]
  raw-word-9:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *default_cos
          - [time, 120]
  raw-word-10:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *default_cos
          - [time, 120]
  raw-word-11:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *default_cos
          - [time, 120]
  raw-word-12:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *default_cos
          - [time, 120]
  raw-word-13:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *default_cos
          - [time, 120]
  raw-word-14:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *default_cos
          - [time, 120]
  raw-word-15:
    source: poll
    triggers:
      process:
        store:
          - [time, 60]
        send:
          - *default_cos
          - [time, 120]
