!function(e){"function"==typeof define&&define.amd?define(["jquery","jquery-ui-dist"],e):e(jQuery)}(function(h){h.extend(h.ui,{multiDatesPicker:{version:"1.6.4"}}),h.fn.multiDatesPicker=function(r){var s=arguments,c=this,a=(new Date,new Date(0),{});function o(e,t){t=t||"picked",e=d.call(this,e);for(var i=0;i<this.multiDatesPicker.dates[t].length;i++)if(!u.compareDates(this.multiDatesPicker.dates[t][i],e))return this.multiDatesPicker.dates[t].splice(i,1).pop()}function l(e,t){return t=t||"picked",this.multiDatesPicker.dates[t].splice(e,1).pop()}function n(e,t,i){t=t||"picked",(e=d.call(this,e)).setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),!1===u.gotDate.call(this,e,t)&&(this.multiDatesPicker.dates[t].push(e),i||this.multiDatesPicker.dates[t].sort(u.compareDates))}function d(e,t,i){return t=t||"object",u.dateConvert.call(this,e,t,i)}var u={init:function(e){var t=h(this);this.multiDatesPicker.changed=!1;var i={beforeShow:function(e,t){this.multiDatesPicker.changed=!1,this.multiDatesPicker.originalBeforeShow&&this.multiDatesPicker.originalBeforeShow.call(this,e,t)},onSelect:function(e,t){var i=h(this);if(this.multiDatesPicker.changed=!0,e&&(i.multiDatesPicker("toggleDate",e),this.multiDatesPicker.changed=!0),"normal"==this.multiDatesPicker.mode&&this.multiDatesPicker.pickableRange)if(0<this.multiDatesPicker.dates.picked.length){var a=this.multiDatesPicker.dates.picked[0],r=new Date(a.getTime());if(u.sumDays(r,this.multiDatesPicker.pickableRange-1),this.multiDatesPicker.adjustRangeToDisabled){var s,c=this.multiDatesPicker.dates.disabled.slice(0);do{for(var o=s=0;o<c.length;o++)c[o].getTime()<=r.getTime()&&(a.getTime()<=c[o].getTime()&&c[o].getTime()<=r.getTime()&&s++,c.splice(o,1),o--);r.setDate(r.getDate()+s)}while(0!=s)}this.multiDatesPicker.maxDate&&r>this.multiDatesPicker.maxDate&&(r=this.multiDatesPicker.maxDate),i.datepicker("option","minDate",a).datepicker("option","maxDate",r)}else i.datepicker("option","minDate",this.multiDatesPicker.minDate).datepicker("option","maxDate",this.multiDatesPicker.maxDate);this.multiDatesPicker.originalOnSelect&&e&&this.multiDatesPicker.originalOnSelect.call(this,e,t)},beforeShowDay:function(e){var t=h(this),i=!1!==t.multiDatesPicker("gotDate",e),a=t.datepicker("option","disabled"),r=!1!==t.multiDatesPicker("gotDate",e,"disabled"),s=this.multiDatesPicker.maxPicks<=this.multiDatesPicker.dates.picked.length,c=[!0,"",null];return this.multiDatesPicker.originalBeforeShowDay&&(c=this.multiDatesPicker.originalBeforeShowDay.call(this,e)),c[1]=i?"ui-state-highlight "+c[1]:c[1],c[0]=c[0]&&!(a||r||s&&!c[1]),c}};if(t.val())var a=t.val();e?(e.separator&&(this.multiDatesPicker.separator=e.separator),this.multiDatesPicker.separator||(this.multiDatesPicker.separator=", "),this.multiDatesPicker.originalBeforeShow=e.beforeShow,this.multiDatesPicker.originalOnSelect=e.onSelect,this.multiDatesPicker.originalBeforeShowDay=e.beforeShowDay,this.multiDatesPicker.originalOnClose=e.onClose,t.datepicker(e),this.multiDatesPicker.minDate=h.datepicker._determineDate(this,e.minDate,null),this.multiDatesPicker.maxDate=h.datepicker._determineDate(this,e.maxDate,null),e.addDates&&u.addDates.call(this,e.addDates),e.addDisabledDates&&u.addDates.call(this,e.addDisabledDates,"disabled"),u.setMode.call(this,e)):t.datepicker(),t.datepicker("option",i),a&&t.multiDatesPicker("value",a);var r=t.multiDatesPicker("value");t.val(r);var s=t.datepicker("option","altField");s&&h(s).val(r),t.datepicker("refresh")},compareDates:function(e,t){e=d.call(this,e),t=d.call(this,t);var i=e.getFullYear()-t.getFullYear();return i=i||((i=e.getMonth()-t.getMonth())||e.getDate()-t.getDate())},sumDays:function(e,t){var i=typeof e;return obj_date=d.call(this,e),obj_date.setDate(obj_date.getDate()+t),d.call(this,obj_date,i)},dateConvert:function(e,t,i){var a=typeof e,r=h(this);if(a==t){if("object"==a)try{e.getTime()}catch(e){return h.error("Received date is in a non supported format!"),!1}return e}if(void 0===e&&(e=new Date(0)),"string"!=t&&"object"!=t&&"number"!=t&&h.error('Date format "'+t+'" not supported!'),!i){var s=r.datepicker("option","dateFormat");i=s||h.datepicker._defaults.dateFormat}switch(a){case"object":break;case"string":e=h.datepicker.parseDate(i,e);break;case"number":e=new Date(e);break;default:h.error('Conversion from "'+t+'" format not allowed on jQuery.multiDatesPicker')}switch(t){case"object":return e;case"string":return h.datepicker.formatDate(i,e);case"number":return e.getTime();default:h.error('Conversion to "'+t+'" format not allowed on jQuery.multiDatesPicker')}return!1},gotDate:function(e,t){t=t||"picked";for(var i=0;i<this.multiDatesPicker.dates[t].length;i++)if(0===u.compareDates.call(this,this.multiDatesPicker.dates[t][i],e))return i;return!1},value:function(e){if(!e||"string"!=typeof e){var t=u.getDates.call(this,"string");return t.length?t.join(this.multiDatesPicker.separator):""}u.addDates.call(this,e.split(this.multiDatesPicker.separator))},getDates:function(e,t){switch(t=t||"picked",e=e||"string"){case"object":return this.multiDatesPicker.dates[t];case"string":case"number":var i=new Array;for(var a in this.multiDatesPicker.dates[t])i.push(d.call(this,this.multiDatesPicker.dates[t][a],e));return i;default:h.error('Format "'+e+'" not supported!')}},addDates:function(e,t){if(0<e.length)switch(t=t||"picked",typeof e){case"object":case"array":if(e.length){for(var i=0;i<e.length;i++)n.call(this,e[i],t,!0);(function(e){e=e||"picked",this.multiDatesPicker.dates[e].sort(u.compareDates)}).call(this,t);break}case"string":case"number":n.call(this,e,t);break;default:h.error('Date format "'+typeof e+'" not allowed on jQuery.multiDatesPicker')}else h.error("Empty array of dates received.")},removeDates:function(e,t){t=t||"picked";var i=[];if("[object Array]"===Object.prototype.toString.call(e))for(var a in e.sort(function(e,t){return t-e}))i.push(o.call(this,e[a],t));else i.push(o.call(this,e,t));return i},removeIndexes:function(e,t){t=t||"picked";var i=[];if("[object Array]"===Object.prototype.toString.call(e))for(var a in e.sort(function(e,t){return t-e}))i.push(l.call(this,e[a],t));else i.push(l.call(this,e,t));return i},resetDates:function(e){e=e||"picked",this.multiDatesPicker.dates[e]=[]},toggleDate:function(e,t){switch(t=t||"picked",this.multiDatesPicker.mode){case"daysRange":this.multiDatesPicker.dates[t]=[];var i=this.multiDatesPicker.autoselectRange[1],a=this.multiDatesPicker.autoselectRange[0];i<a&&(i=this.multiDatesPicker.autoselectRange[0],a=this.multiDatesPicker.autoselectRange[1]);for(var r=a;r<i;r++)u.addDates.call(this,u.sumDays.call(this,e,r),t);break;default:!1===u.gotDate.call(this,e)?u.addDates.call(this,e,t):u.removeDates.call(this,e,t)}},setMode:function(e){h(this);switch(e.mode&&(this.multiDatesPicker.mode=e.mode),this.multiDatesPicker.mode){case"normal":for(var t in e)switch(t){case"maxPicks":case"minPicks":case"pickableRange":case"adjustRangeToDisabled":this.multiDatesPicker[t]=e[t]}break;case"daysRange":case"weeksRange":var i=1;for(t in e)switch(t){case"autoselectRange":i--;case"pickableRange":case"adjustRangeToDisabled":this.multiDatesPicker[t]=e[t]}0<i&&h.error("Some mandatory options not specified!")}a.onSelect&&a.onSelect()},destroy:function(){this.multiDatesPicker=null,h(this).datepicker("destroy")}};return this.each(function(){var e=h(this);if(this.multiDatesPicker||(this.multiDatesPicker={dates:{picked:[],disabled:[]},mode:"normal",adjustRangeToDisabled:!0}),u[r]){var t=u[r].apply(this,Array.prototype.slice.call(s,1));switch(r){case"removeDates":case"removeIndexes":case"resetDates":case"toggleDate":case"addDates":var i=e.datepicker("option","altField"),a=u.value.call(this);void 0!==i&&""!=i&&h(i).val(a),e.val(a),h.datepicker._refreshDatepicker(this)}switch(r){case"removeDates":case"getDates":case"gotDate":case"sumDays":case"compareDates":case"dateConvert":case"value":c=t}return t}return"object"!=typeof r&&r?(h.error("Method "+r+" does not exist on jQuery.multiDatesPicker"),!1):u.init.apply(this,s)}),c};var e=(new Date).getTime();h.multiDatesPicker={version:!1},h.multiDatesPicker.initialized=!1,h.multiDatesPicker.uuid=(new Date).getTime(),h.multiDatesPicker.version=h.ui.multiDatesPicker.version,h.multiDatesPicker._hideDatepicker=h.datepicker._hideDatepicker,h.datepicker._hideDatepicker=function(){var e=this._curInst.input[0],t=e.multiDatesPicker;return!t||!1===this._curInst.inline&&!t.changed?h.multiDatesPicker._hideDatepicker.apply(this,arguments):(t.changed=!1,void h.datepicker._refreshDatepicker(e))},window["DP_jQuery_"+e]=h}),$(function(){var i=[];$.each(($("#id_delivery_dates").val()||"").split("|"),function(e,t){t&&i.push(t)});var a=[];$.each(($("#delivery_dates").data("orderedDates")||"").split("|"),function(e,t){t&&a.push(t)});var r=$("#delivery_dates").data("orderedDateTooltip"),s=$.datepicker._updateDatepicker;$.datepicker._updateDatepicker=function(e){var t=s.apply(this,arguments);if(this._get(e,"disableTodayHighlight")){var i=e.dpDiv.find(".ui-datepicker-today");if(i)i.find("a").removeClass("ui-state-highlight ui-state-active ui-state-hover")}return t};var e={dateFormat:"yy-mm-dd",separator:"|",minDate:0,numberOfMonths:2,disableTodayHighlight:!0,maxPicks:18,altField:"#id_delivery_dates",onSelect:function(e,t){$("#form_create_batch #id_is_submit").val("0"),$("#form_create_batch").submit()},beforeShowDay:function(e){var t=$.datepicker.formatDate("yy-mm-dd",e);return-1!==a.indexOf(t)?[!0,"ordered-date",r]:[!0,"",null]}};$.isArray(i)&&0<i.length&&(e.addDates=i),$("#delivery_dates").multiDatesPicker(e),$(".ui.accordion.meals").show(),$("#form_create_batch .accordion[id^='date-']").each(function(e,t){try{var i=$(t).data("client-meals-default")}catch(e){return}var a=$(t).attr("id").slice(5),r=!0;$.each(i,function(e,t){!(t=$("#id_"+e+"_"+a+"_quantity").val())&&0!==t||(r=!1)});var s="#id_size_"+a;$(s).dropdown("get value")[0]&&(r=!1),r&&($.each(i,function(e,t){$("#id_"+e+"_"+a+"_quantity").val(t||0)}),i.hasOwnProperty("size")&&$(s).dropdown("set selected",i.size))}),$("#form_create_batch #id_client .ui.dropdown").dropdown("setting","onChange",function(e,t,i){$("#form_create_batch #id_is_submit").val("0"),$("#form_create_batch").submit()}),$("#form_create_batch").on("submit",function(){var a=[];$("#form_create_batch #order_create_batch_items .accordion").has(".content:not(.active)").each(function(e,t){var i=$(t).attr("id").slice(5);a.push(i)}),$("#form_create_batch #id_accordions_active").val(a.join("|"))})});