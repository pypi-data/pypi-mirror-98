{% extends 'djmicrosip_clasificadores/base.html' %}
{% load humanize %}
{% block title %}
Pedidos Web
{% endblock %}
{% block style_css %}
<style type="text/css"> 
.input-group {
    position: relative;
    display: flex;
    border-collapse: separate;
}
.btn_{
	padding: 0;
	float: right;
	color: #c1c1c1;
}
.modal-dialog {
    width: 25vw;
    margin: 35vh auto;
}
.modal-dialog.compatibilidad {
    width: 70vw;
    margin: 35vh auto;
}
.secundario2{
	text-align: right;
}
.secundario3{
	text-align: right;
}
.table>tbody>tr>td{
	padding: 0px;
}
.fullscreen-modal .modal-dialog {
  margin: 0;
  margin-right: auto;
  margin-left: auto;
  width: 100%;
}


@media screen and (max-width: 600px) {
    table.table-responsive thead {
        display: none;
    }

    table.table-responsive tr {
        padding: 5px;
        display: block;
        margin: .5rem 0 1rem;
        background-color: #fff;
        border-radius: 2px;
        box-shadow: 0 2px 5px 0 rgba(0,0,0,.16),0 2px 10px 0 rgba(0,0,0,.12);
    }

    table.table-responsive td {
        display: block;
        text-align: right;
        border-bottom: 1px dotted #ccc;
    }

    table.table-responsive td:last-child {
        border-bottom: 0;
    }

    table.table-responsive td:before {
        content: attr(data-label);
        float: left;
        font-weight: bold;
    }
	label {
	    display: inline-block;
	    max-width: 100%;
	    margin-bottom: 5px;
	    font-weight: 700;
	}
}
@media (min-width: 768px) {
  .fullscreen-modal .modal-dialog {
    width: 750px;
  }
}
</style>
{% endblock %}
{% block js_code %}
<script src='{{STATIC_URL}}djmicrosip_clasificadores/js/bootstrap-input-spinner.js?v=1.0.1'></script>

<script>

	$("input[type='number']").inputSpinner();
	$(document).ready(function(){

		$('input[name="clasificador_val"]').click(function(){
			list_ids();
		});
		function list_ids() {
			var lista_id = [];
			$( 'input[name="clasificador_val"]' ).each(function() {
				var id= parseInt($(this).attr("id"));
				var clase=$(this).attr("class");
				if($(this).prop("checked") == true){
					lista_id.push(id);
				}

			});
			if (lista_id != [])
			{

				location.href = "?{%if articulos.has_previous %}page={{ articulos.previous_page_number }}&{%endif%}{%if clasificador_padre_valor %}clasificador_padre_valor={{ clasificador_padre_valor }}&{%endif%}clas_val="+JSON.stringify(lista_id)+"";
				console.log(lista_id)
			}
		}

			$( "[id*='id_imagen_art']" ).each(function() {
			
			var number=$(this).parent().attr("id");
			var valor=$(this).attr("id")
			document.getElementById(valor).id = valor+number

			});

			$( "[id*='id_pedm_art']" ).each(function() {
			
			var number=$(this).parent().attr("id");
			var valor=$(this).attr("id")
			document.getElementById(valor).id = valor+number

			});
	});
	function ready(callback){
	    // in case the document is already rendered
	    if (document.readyState!='loading') callback();
	    // modern browsers
	    else if (document.addEventListener) document.addEventListener('DOMContentLoaded', callback);
	    // IE <= 8
	    else document.attachEvent('onreadystatechange', function(){
	        if (document.readyState=='complete') callback();
	    });
	}

	ready(function(){

		$( '.lista-clasificadores' ).each(function() {
			var id=$(this).attr("id");
			// var content=document.getElementById(id);
		  	let arry =$(this).children();
		  	console.log(arry.length)
		  	if(arry.length <= 0)
		  	{
		  		$('li#'+id+'.contenedor-clasificador').addClass("hidden");
			}
		});
	});
	function printImg(url) {
	  var win = window.open('');
	  win.document.write('<img src="' + url + '" onload="window.print();window.close()" />');
	  win.focus();
	}
	function handleClick(myRadio) {

		location.href = "?{%if articulos.has_previous %}page={{ articulos.previous_page_number }}&{%endif%}clasificador_padre_valor="+ myRadio.id+"";

	}
	$( ".clasificador" ).click(function() {
		var id=$(this).attr("id");
		console.log(id)
		if($("ul#"+id).hasClass( "hidden" ))
		{
			$("ul#"+id).removeClass("hidden");
			$("a#"+id+" i").removeClass("glyphicon-plus");
			$("a#"+id+" i").addClass("glyphicon-minus");
		}
		else
		{
			$("ul#"+id).addClass("hidden");
			$("a#"+id+" i").removeClass("glyphicon-minus");
			$("a#"+id+" i").addClass("glyphicon-plus");
		}

	});
	$(document).on('click','.input-group-append',function(){
	  get_cantidad();

	});
	$(document).on('touchstart','.input-group-append',function(){
	  get_cantidad();

	});
	$(document).on('click','.input-group-prepend',function(){
	  get_cantidad();

	});
	$(document).on('touchstart','.input-group-prepend',function(){
	  get_cantidad();

	});

	function get_cantidad() {        	
		var lista_articulos=[];
		var pedido_id=$("#pedido_id").val();
		$( 'input[type="number"]' ).each(function() {
			var id= parseInt($(this).attr("id"));
			console.log(id)
			var obj = new Object();
			var val=parseInt($(this).val());
			var precio=parseFloat(($('#'+id+'.precio_unitario').text()).replace(/,/g, ''));
			var clave=$('#'+id+'.clave_articulo').text();
			if(val > 0)
			{
				obj.id = id;
				obj.cantidad  = val;
				obj.precio=precio
				obj.clave=clave
				lista_articulos.push(obj);
			}

		});
		console.log(JSON.stringify(lista_articulos));
		$.ajax({
			url: '/pedidos_web/crear_pedido_temporal/',
			type: 'get',
			data: {
				'lista_articulos': JSON.stringify(lista_articulos),
				'pedido_id':pedido_id,
			},
			success: function (data) {

			}
		});
	}

	$( ".det_progreso" ).click(function() {
		var id_articulo=$(this).attr("id");

		$.ajax({
			url: '/pedidos_web/get_todos_almacenes/',
			type: 'get',
			data: {
				'id_articulo': id_articulo,
			},
			success: function (data) {
				var contenedor = document.getElementById("tableExistencia"+id_articulo+"");
				var child = contenedor.lastElementChild;  
				while (child) { 
					contenedor.removeChild(child); 
					child = contenedor.lastElementChild; 
				} 
				for (var i = 0; i < data.length; i++) {
					var principal = document.createElement("div"); 
					var secundario1 = document.createElement("div");
					var secundario2 = document.createElement("div");
					principal.className="col-md-12";
					secundario1.className="col-md-6 secundario1"
					secundario1.innerHTML=data[i]["almacen"];
					secundario2.innerHTML=data[i]["existencia"];
					secundario2.className="col-md-6 secundario2"
					principal.appendChild(secundario1)
					principal.appendChild(secundario2)
					contenedor.appendChild(principal)
					console.log("tableExistencia"+id_articulo+"");
				}

			}
		});
	});
    $("[id*='id_imagen_art']").change(function() {
        var length = this.files.length;
        console.log(length)
        if (!length) {
            return false;
        }
        useImage(this,"#imagen_art");
    });
    $("[id*='id_pedm_art']").change(function() {
        var length = this.files.length;
        console.log(length)
        if (!length) {
            return false;
        }
        useImage(this,"#pedm_art");
    });
	function useImage(img,txt) {

	        var file = img.files[0];
	        
	        var imagefile = file.type;
	        var match = ["image/jpeg", "image/png", "image/jpg"];
	        if (!((imagefile == match[0]) || (imagefile == match[1]) || (imagefile == match[2]))) {
	            alert("Invalid File Extension");
	        } else {
	        	console.log("OK")
	            var reader = new FileReader();
	            reader.onload = imageIsLoaded;
	            reader.readAsDataURL(img.files[0]);
	        }

	        function imageIsLoaded(e) {
	        	console.log("img")
	        	console.log(e.target.result)
	        	$(""+txt+img.parentNode.id+"").text(e.target.result);
	            

	        }
	    }
	$( "[id*='guardarImg']" ).click(function() {
		debugger
		var child=this;
		var articulo_id=child.parentNode.id;
		var img_art_data= $("#imagen_art"+articulo_id+"").text();
		var pedm_art_data= $("#pedm_art"+articulo_id+"").text();
		var img_art= $("#id_imagen_art"+articulo_id+"").val();
		var pedm_art= $("#id_pedm_art"+articulo_id+"").val();


		img_art=img_art.replace("C:\\fakepath\\","")
		pedm_art=pedm_art.replace("C:\\fakepath\\","")
		console.log(img_art_data)
		console.log(pedm_art_data)
		$.ajax({
			url: '/pedidos_web/save_img/',
			type: 'get',
			data: {
				'img_art': img_art,
				'articulo_id': articulo_id,
				'pedm_art': pedm_art,
				'pedm_art_data':pedm_art_data,
				'img_art_data':img_art_data,
			},
			success: function (data) {
					alert(data.mensaje);
			}
		});
	});
	$( ".compatibilidades" ).click(function() {
		var id_articulo=$(this).attr("id");
		
		var id_pedido=$("#pedido_id").val();
		$.ajax({
			url: '/pedidos_web/compatibilidad_articulo/',
			type: 'get',
			data: {
				'id_articulo': id_articulo,
				'id_pedido': id_pedido,
			},
			success: function (data) {
				var contenedor = document.getElementById("tableCompatibilidad"+id_articulo+"");
				var child = contenedor.lastElementChild;  
				while (child) { 
					contenedor.removeChild(child); 
					child = contenedor.lastElementChild; 
				} 
				for (var i = 0; i < data.length; i++) {
					var principal = document.createElement("div"); 
					var secundario0 = document.createElement("div");
					var secundario1 = document.createElement("div");
					var secundario2 = document.createElement("div");
					var secundario3 = document.createElement("div");
					var secundario4 = document.createElement("div");
					principal.className="col-md-12";
					secundario0.className="col-md-2 secundario0"
					secundario0.innerHTML=data[i]["clave"];
					secundario1.className="col-md-4 secundario1"
					secundario1.innerHTML=data[i]["articulo"];
					secundario2.innerHTML=data[i]["existencia"];
					secundario2.className="col-md-2 secundario2"
					secundario3.innerHTML=data[i]["precio"];
					secundario3.className="col-md-2 secundario3";
					secundario4.innerHTML='<input type="number" value="'+data[i]["cantidad"]+'" min="0" id="'+data[i]["id"]+'" max="'+data[i]["existencia"]+'" class="cantidad '+data[i]["id"]+'">'
					secundario4.className="col-md-2 secundario4";
					$(secundario4.children[0]).inputSpinner();
					principal.appendChild(secundario0);
					principal.appendChild(secundario1);
					principal.appendChild(secundario2);
					principal.appendChild(secundario3);
					principal.appendChild(secundario4);
					contenedor.appendChild(principal);
				}
				
			}
		});
	});
	$('#id_sin_existencia').change(function() {
	$('.form').submit();
});
</script>
{% endblock %}
{% block content %}

<div class="row">
	<div class="row">
		<div class="col-md-2"></div>
		<div class="col-md-8" align="center">
			<div class="pagination">
			    <span class="step-links">
			        {% if articulos.has_previous %}
			        	
			            <a href="?page={{ articulos.previous_page_number }}{%if clasificadores%}&clas_val={{clasificadores}}{%endif%}{%if busqueda%}&busqueda={{busqueda}}{%endif%}{%if clasificador_padre_valor %}&clasificador_padre_valor={{clasificador_padre_valor}}{%endif%}&existencia={{existencia}}" class="glyphicon glyphicon-triangle-left"></a>
			        	
			        {% endif %}

			        <span class="current">
			            Page {{ articulos.number }} of {{ articulos.paginator.num_pages }}.
			        </span>

			        {% if articulos.has_next %}
			            <a href="?page={{ articulos.next_page_number }}{%if clasificadores%}&clas_val={{clasificadores}}{%endif%}{%if busqueda%}&busqueda={{busqueda}}{%endif%}{%if clasificador_padre_valor %}&clasificador_padre_valor={{clasificador_padre_valor}}{%endif%}&existencia={{existencia}}" class="glyphicon glyphicon-triangle-right"></a>
			        {% endif %}
			    </span>
			</div>

		</div>
		<div class="col-md-2">
			{%if venta%}
			<a style="font-size: 14px; color:#000;" href="/pedidos_web/view_pedido/{{pedido.id}}/" class="glyphicon glyphicon-shopping-cart">({{cantidad_pedido}})</a>
			{%endif%}
		</div>
	</div>
	<div class="col-md-12">
		<div class="col-md-2">
			<input type="text" class="hidden" id="pedido_id" value="{{pedido.folio}}" name="">
			{% if not venta %}
			<ul style="list-style: none; padding: 0;">
				<li style="list-style: none; background: #ff00004d; padding: 0;">Facturado</li>
				<li style="list-style: none; background: #ffa50070; padding: 0;">Remisionado</li>
				<li style="list-style: none; background: #ffff004d; padding: 0;">Pedido</li>
				<li style="list-style: none; background: #0080004d; padding: 0;">En existencia</li>
			</ul>
			{%endif%}
			<form method="post" class="form" action="" id="myForm"  enctype='multipart/form-data'>
				{% csrf_token %}
				  {{form_busqueda}}

				  <li style="list-style: none;">
				  	<label ><span>{{clasificador_padre}}</span></label>
			      	<ul style="list-style: none; padding: 0 10px;" id="{{clasificador_padre}}">
					    <fieldset id="group1">
				        {% for clas_val in clasificadores_padre %}
					      		<li>
									<label ><input class="clasificador_valor_padre" id="{{clas_val.valor_clasif_id}}" onclick="handleClick(this);"  type="radio" value="{{clas_val}}" {%if clas_val.valor_clasif_id == clasificador_padre_valor %}checked{%endif%} name="group1"> 
										{{clas_val}}
									</label>
					      		</li>
						{% endfor %}
						</fieldset>
					</ul>
				  </li> 
				  <div class="{%if not clasificador_padre_valor %}hidden{%endif%}" id="otros_clasificadores">
			      {% for clas in clas_all %}
			      <li style="list-style: none;" id="{{clas}}" class="contenedor-clasificador">
			      	<label ><span>{{clas}}</span> <a class="btn_ btn btn-light clasificador" id="{{clas}}"><i class="glyphicon glyphicon-plus"></i></a></label>
			      	<ul style="list-style: none; padding: 0 10px;" id="{{clas}}" class="{% if not clas.clasificador_id in valores %}hidden{% endif %} lista-clasificadores">
			        {% for clas_val in clas_val_all %}
				      	{% if clas == clas_val.clasificador %}
				      		<li>
								<label ><input class="clasificador_valor" id="{{clas_val.valor_clasif_id}}" name="clasificador_val"  type="checkbox" value="{{clas_val}}" {%if clas_val.valor_clasif_id in clasificadores %}checked{%endif%} > 
									{{clas_val}}
								</label>
				      		</li>
						{% endif %}
					{% endfor %}
					</ul>
				  </li>
			      {% endfor %}
			      </div>
					
					<input type="submit" class="btn btn-success hidden" value="Buscar"  id="guardar" />
			</form>		
		</div>

		<div class="col-md-10" >
			<table id="report_#REGION_STATIC_ID#" class="table table-responsive" #REPORT_ATTRIBUTES#>
				<thead>
					<th>No.</th>
					<th>Nombre</th>
					<th style="text-align: right;">Existencia </th>
					{% if not venta %}
					<th style="text-align: right;">No. Serie</th>
					<th style="text-align: right;">Fecha Compra</th>
					<th style="text-align: right;">Costo</th>
					<th style="text-align: right;">Refaccion</th>
					{%endif%}					
					<th style="text-align: right;">Precio</th>
				</thead>
				<tbody>
					{% for item in articulos%}
					{% if existencia == 'True' %}

					<tr style="background: {{item.color}};">
						<td headers="#COLUMN_HEADER_NAME#" data-label="No" id="{{item.articulo.id}}" class="clave_articulo" #ALIGNMENT#>{{item.clave}}</td>
						<td headers="#COLUMN_HEADER_NAME#" data-label="Nombre" #ALIGNMENT#>
							<a id="{{item.articulo.id}}" class="hidden-print det_progreso" href="#" data-toggle="modal" data-target="#myModal{{item.articulo.id}}">{{item.articulo.nombre}}</a>
							{% if compatible%}
							<sup style="border: 1px solid #000; border-radius: 20px; background-color: #000;"><a id="{{item.articulo.id}}" class="hidden-print compatibilidades" href="#" data-toggle="modal" data-target="#Modal{{item.articulo.id}}" style="color: #fff;">Compatibile</a></sup>
							{%endif%}
							{%if request.user.is_staff %}<sup style="border: 1px solid #000; border-radius: 20px; background-color: #000;"><a id="{{item.articulo.id}}" class="hidden-print compatibilidades" href="#" data-toggle="modal" data-target="#ModalImg{{item.articulo.id}}" style="color: #fff;">Img</a></sup>{%endif%}
						    
						    <div class="modal fade {{item.articulo.id}} fullscreen-modal" id="Modal{{item.articulo.id}}" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
						      <div class="modal-dialog compatibilidad">
						        <div class="modal-content">
						          <div class="modal-header">
						            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						            <h4 class="modal-title" id="ModalLabel">Articulos Compatibles</h4>
						          </div>
						          <div class="modal-body  ">						         	
									<div>
										<div class="row" id="header">
											<div class="col-md-12">
												<div class="col-md-2"><strong>Clave</strong></div>
												<div class="col-md-4"><strong>Articulo</strong></div>
												<div class="col-md-2" style="text-align: right;"><strong>Existencias</strong></div>

												<div class="col-md-2" style="text-align: right;"><strong>Precio</strong></div>
												<div class="col-md-2" ><strong></strong></div>
											</div>
										</div>
										<div class="row" id="tableCompatibilidad{{item.articulo.id}}">
											
										</div>
									</div>
						          </div>
						          <div class="modal-footer">
						            <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
						            <!-- <button type="button" class="btn btn-primary">OK</button> -->
						          </div> 
						        </div>
						     </div>
						    </div>

						    <div class="modal fade {{item.articulo.id}} fullscreen-modal" id="ModalImg{{item.articulo.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
								      <div class="modal-dialog">
								        <div class="modal-content">
								          <div class="modal-header">
								            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
								            <h4 class="modal-title" id="myModalLabel">{{item.articulo.nombre}}</h4>
								          </div>
								          <div class="modal-body  ">						         	
											<div class="row">
												
													 <div class="col-md-12" id="{{item.articulo.id}}">
														<label>Imagen articulo {{item.articulo.img}}</label>	
														{{form.imagen_art}}
														<input type="text" class="hidden" name="" id="imagen_art{{item.articulo.id}}" value="">
														<div id="carousel1" class="carousel slide" data-ride="carousel">
														  <!– Indicatodores –>
														  <ol class="carousel-indicators">
														  	{% for img in item.img %}
														  	{%if forloop.counter == 1 %}
														    <li data-target="#carousel1" data-slide-to="{{forloop.counter}}" class="active"></li>
														    {%else%}
														    <li data-target="#carousel1" data-slide-to="{{forloop.counter}}"></li>
														    {%endif%}
														    {% endfor %}
														  </ol>

														  <div class="carousel-inner" role="listbox">
																{% for img in item.img %}
																	{%if forloop.counter == 1 %}
																	    <div class="item active">
																	    	<img id="firma_image" src="{{MEDIA_URL}}{{img.imagen_art}}" alt="No Imagen" style="width: 100%; height:auto">																			
																	     	<div class="carousel-caption"> <button type="button" class="btn btn-default" id="{{item.articulo.id}}" onclick="printImg('{{MEDIA_URL}}{{img.imagen_art}}')">Print</button> </div>
																	    </div>															
																	{%else%}
																	    <div class="item">
																	    	<img id="firma_image" src="{{MEDIA_URL}}{{img.imagen_art}}" alt="No Imagen" style="width: 100%; height:auto">																			
																	     	<div class="carousel-caption"> <button type="button" class="btn btn-default" id="{{item.articulo.id}}" onclick="printImg('{{MEDIA_URL}}{{img.imagen_art}}')">Print</button> </div>
																	    </div>
																	{%endif%}
																{% endfor %}
														  </div>

														  
														  <a class="left carousel-control" href="#carousel1" role="button" data-slide="prev">
														    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
														    <span class="sr-only">Anterior</span>
														  </a>
														  <a class="right carousel-control" href="#carousel1" role="button" data-slide="next">
														    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
														    <span class="sr-only">Siguiente</span>
														  </a>

														</div>


														
													 </div>
													 <div class="col-md-12 " id="{{item.articulo.id}}">
														<label>Imagen pedimento</label>	
														{{form.pedm_art}}
														<input type="text" class="hidden" name="" id="pedm_art{{item.articulo.id}}" value="">
														<div id="carousel2" class="carousel slide" data-ride="carousel">
														  <!– Indicatodores –>
														  <ol class="carousel-indicators">
														  	{% for img in item.pedm %}
															  	{%if forloop.counter == 1 %}
															    <li data-target="#carousel1" data-slide-to="{{forloop.counter}}" class="active"></li>
															    {%else%}
															    <li data-target="#carousel1" data-slide-to="{{forloop.counter}}"></li>
															    {%endif%}
														    {% endfor %}
														  </ol>

														  <div class="carousel-inner" role="listbox">
																{% for img in item.pedm %}
																	{%if forloop.counter == 1 %}
																	    <div class="item active">
																	    	<img id="firma_image" src="{{MEDIA_URL}}{{img.pedm_art}}" alt="No Imagen" style="width: 100%; height:auto">																			
																	     	<div class="carousel-caption"> <button type="button" class="btn btn-default" id="{{item.articulo.id}}" onclick="printImg('{{MEDIA_URL}}{{img.pedm_art}}')">Print</button> </div>
																	    </div>															
																	{%else%}
																	    <div class="item">
																	    	<img id="firma_image" src="{{MEDIA_URL}}{{img.pedm_art}}" alt="No Imagen" style="width: 100%; height:auto">																			
																	     	<div class="carousel-caption"> <button type="button" class="btn btn-default" id="{{item.articulo.id}}" onclick="printImg('{{MEDIA_URL}}{{img.pedm_art}}')">Print</button> </div>
																	    </div>
																	{%endif%}
																{% endfor %}
														  </div>

														  
														  <a class="left carousel-control" href="#carousel2" role="button" data-slide="prev">
														    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
														    <span class="sr-only">Anterior</span>
														  </a>
														  <a class="right carousel-control" href="#carousel2" role="button" data-slide="next">
														    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
														    <span class="sr-only">Siguiente</span>
														  </a>

														</div>
														

													 </div>
											 	
											</div>
												
								          </div>
								          <div class="modal-footer" id="{{item.articulo.id}}">
								            <button type="button" class="btn btn-default" id="guardarImg">Guardar</button>
								            <!-- <button type="button" class="btn btn-primary">OK</button> -->
								          </div>
								        </div>
								     </div>
								    </div>	

						    <div class="modal fade {{item.articulo.id}} fullscreen-modal" id="myModal{{item.articulo.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
						      <div class="modal-dialog">
						        <div class="modal-content">
						          <div class="modal-header">
						            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						            <h4 class="modal-title" id="myModalLabel">{{item.articulo.nombre}}</h4>
						          </div>
						          <div class="modal-body  ">						         	
									<div>
										<div class="row" id="header">
											<div class="col-md-12">
												<div class="col-md-6"><strong>Almacen</strong></div>
												<div class="col-md-6" style="text-align: right;"><strong>Existencias</strong></div>
											</div>
										</div>
										<div class="row" id="tableExistencia{{item.articulo.id}}">
											
										</div>
									</div>
						          </div>
						          <div class="modal-footer">
						            <button type="button" class="btn btn-default" data-dismiss="modal">Ok</button>
						            <!-- <button type="button" class="btn btn-primary">OK</button> -->
						          </div>
						        </div>
						     </div>
						    </div>
						</td>
						<td headers="#COLUMN_HEADER_NAME#" data-label="Existencia" style="text-align: right;" #ALIGNMENT#><label>{{item.existencia}}</label></td>
						{% if not venta %}							
						<td headers="#COLUMN_HEADER_NAME#" data-label="No. Serie" style="text-align: right;" #ALIGNMENT#><label>{{item.no_serie}}</label></td>
						<td headers="#COLUMN_HEADER_NAME#" data-label="Fecha Compra" style="text-align: right;" #ALIGNMENT#><label>{{item.fecha_compra|date:"d/M/Y"}}</label></td>
						<td headers="#COLUMN_HEADER_NAME#" data-label="Costo" style="text-align: right;" #ALIGNMENT#><label>{{item.costo|floatformat:2|intcomma}}</label></td>
						<td headers="#COLUMN_HEADER_NAME#" data-label="Refaccion" style="text-align: right;" #ALIGNMENT#><label>{{item.refaccion|floatformat:2|intcomma}}</label></td>
						{%endif%}
						<td headers="#COLUMN_HEADER_NAME#" data-label="Precio" style="text-align: right;" #ALIGNMENT#><label id="{{item.articulo.id}}" class="precio_unitario">{{item.precio|floatformat:2|intcomma}}</label></td>
						{%if venta%}<td headers="#COLUMN_HEADER_NAME#" data-label="" #ALIGNMENT#><input type="number" value="{%if item.cantidad %}{{item.cantidad}}{%else%}0{%endif%}" min="0" id="{{item.articulo.id}}" max="{%if limite_existencia == 'True' %}{{item.existencia}}{%else%}10000{%endif%}" class="cantidad {{item.articulo.id}}"></td>{%endif%}
					</tr>
					{%else%}
						{% if item.existencia > 0 %}
							<tr style="background: {{item.color}};">
								<td headers="#COLUMN_HEADER_NAME#" data-label="No" id="{{item.articulo.id}}" class="clave_articulo" #ALIGNMENT#>{{item.clave}}</td>
								<td headers="#COLUMN_HEADER_NAME#" data-label="Nombre "#ALIGNMENT#>
									<a id="{{item.articulo.id}}" class="hidden-print det_progreso" href="#" data-toggle="modal" data-target="#myModal{{item.articulo.id}}">{{item.articulo.nombre}}</a>
									{%if compatible%}<sup style="border: 1px solid #000; border-radius: 20px; background-color: #000;"><a id="{{item.articulo.id}}" class="hidden-print compatibilidades" href="#" data-toggle="modal" data-target="#Modal{{item.articulo.id}}" style="color: #fff;">Compatibile</a></sup>{%endif%}
									{%if request.user.is_staff %}<sup style="border: 1px solid #000; border-radius: 20px; background-color: #000;"><a id="{{item.articulo.id}}" class="hidden-print compatibilidades" href="#" data-toggle="modal" data-target="#ModalImg{{item.articulo.id}}" style="color: #fff;">Img</a></sup>{%endif%}

								</td>
									<div class="modal fade {{item.articulo.id}} fullscreen-modal" id="ModalImg{{item.articulo.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
								      <div class="modal-dialog">
								        <div class="modal-content">
								          <div class="modal-header">
								            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
								            <h4 class="modal-title" id="myModalLabel">{{item.articulo.nombre}}</h4>
								          </div>
								          <div class="modal-body  ">						         	
											<div class="row">
												
													 <div class="col-md-12" id="{{item.articulo.id}}">
														<label>Imagen articulo {{item.articulo.img}}</label>	
														{{form.imagen_art}}
														<input type="text" class="hidden" name="" id="imagen_art{{item.articulo.id}}" value="">
														<div id="carousel1" class="carousel slide" data-ride="carousel">
														  <!– Indicatodores –>
														  <ol class="carousel-indicators">
														  	{% for img in item.img %}
														  	{%if forloop.counter == 1 %}
														    <li data-target="#carousel1" data-slide-to="{{forloop.counter}}" class="active"></li>
														    {%else%}
														    <li data-target="#carousel1" data-slide-to="{{forloop.counter}}"></li>
														    {%endif%}
														    {% endfor %}
														  </ol>

														  <div class="carousel-inner" role="listbox">
																{% for img in item.img %}
																	{%if forloop.counter == 1 %}
																	    <div class="item active">
																	    	<img id="firma_image" src="{{MEDIA_URL}}{{img.imagen_art}}" alt="No Imagen" style="width: 100%; height:auto">																			
																	     	<div class="carousel-caption"> <button type="button" class="btn btn-default" id="{{item.articulo.id}}" onclick="printImg('{{MEDIA_URL}}{{img.imagen_art}}')">Print</button> </div>
																	    </div>															
																	{%else%}
																	    <div class="item">
																	    	<img id="firma_image" src="{{MEDIA_URL}}{{img.imagen_art}}" alt="No Imagen" style="width: 100%; height:auto">																			
																	     	<div class="carousel-caption"> <button type="button" class="btn btn-default" id="{{item.articulo.id}}" onclick="printImg('{{MEDIA_URL}}{{img.imagen_art}}')">Print</button> </div>
																	    </div>
																	{%endif%}
																{% endfor %}
														  </div>

														  
														  <a class="left carousel-control" href="#carousel1" role="button" data-slide="prev">
														    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
														    <span class="sr-only">Anterior</span>
														  </a>
														  <a class="right carousel-control" href="#carousel1" role="button" data-slide="next">
														    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
														    <span class="sr-only">Siguiente</span>
														  </a>

														</div>


														
													 </div>
													 <div class="col-md-12 " id="{{item.articulo.id}}">
														<label>Imagen pedimento</label>	
														{{form.pedm_art}}
														<input type="text" class="hidden" name="" id="pedm_art{{item.articulo.id}}" value="">
														<div id="carousel2" class="carousel slide" data-ride="carousel">
														  <!– Indicatodores –>
														  <ol class="carousel-indicators">
														  	{% for img in item.pedm %}
															  	{%if forloop.counter == 1 %}
															    <li data-target="#carousel1" data-slide-to="{{forloop.counter}}" class="active"></li>
															    {%else%}
															    <li data-target="#carousel1" data-slide-to="{{forloop.counter}}"></li>
															    {%endif%}
														    {% endfor %}
														  </ol>

														  <div class="carousel-inner" role="listbox">
																{% for img in item.pedm %}
																	{%if forloop.counter == 1 %}
																	    <div class="item active">
																	    	<img id="firma_image" src="{{MEDIA_URL}}{{img.pedm_art}}" alt="No Imagen" style="width: 100%; height:auto">																			
																	     	<div class="carousel-caption"> <button type="button" class="btn btn-default" id="{{item.articulo.id}}" onclick="printImg('{{MEDIA_URL}}{{img.pedm_art}}')">Print</button> </div>
																	    </div>															
																	{%else%}
																	    <div class="item">
																	    	<img id="firma_image" src="{{MEDIA_URL}}{{img.pedm_art}}" alt="No Imagen" style="width: 100%; height:auto">																			
																	     	<div class="carousel-caption"> <button type="button" class="btn btn-default" id="{{item.articulo.id}}" onclick="printImg('{{MEDIA_URL}}{{img.pedm_art}}')">Print</button> </div>
																	    </div>
																	{%endif%}
																{% endfor %}
														  </div>

														  
														  <a class="left carousel-control" href="#carousel2" role="button" data-slide="prev">
														    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
														    <span class="sr-only">Anterior</span>
														  </a>
														  <a class="right carousel-control" href="#carousel2" role="button" data-slide="next">
														    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
														    <span class="sr-only">Siguiente</span>
														  </a>

														</div>
														

													 </div>
											 	
											</div>
												
				  								
											
								          </div>
								          <div class="modal-footer" id="{{item.articulo.id}}">													 <button type="success"  id="guardarImg{{item.articulo.id}}" class="btn btn-default" >Guardar</button>
								            
								            <!-- <button type="button" class="btn btn-primary">OK</button> -->
								          </div>
								        </div>
								     </div>
								    </div>	
								    <div class="modal fade {{item.articulo.id}} fullscreen-modal" id="Modal{{item.articulo.id}}" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
								      <div class="modal-dialog compatibilidad">
								        <div class="modal-content">
								          <div class="modal-header">
								            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
								            <h4 class="modal-title" id="ModalLabel">Articulos Compatibles</h4>
								          </div>
								          <div class="modal-body  ">						         	
											<div>
												<div class="row" id="header">
													<div class="col-md-12">
														<div class="col-md-2"><strong>Clave</strong></div>
														<div class="col-md-4"><strong>Articulo</strong></div>
														<div class="col-md-2" style="text-align: right;"><strong>Existencias</strong></div>
														<div class="col-md-2" style="text-align: right;"><strong>Precio</strong></div>
														<div class="col-md-2" ><strong></strong></div>
													</div>
												</div>
												<div class="row" id="tableCompatibilidad{{item.articulo.id}}">
													
												</div>
											</div>
								          </div>
								          <div class="modal-footer">
								            <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
								            <!-- <button type="button" class="btn btn-primary">OK</button> -->
								          </div> 
								        </div>
								     </div>
								    </div>

								
								    <div class="modal fade {{item.articulo.id}} fullscreen-modal" id="myModal{{item.articulo.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
								      <div class="modal-dialog">
								        <div class="modal-content">
								          <div class="modal-header">
								            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
								            <h4 class="modal-title" id="myModalLabel">{{item.articulo.nombre}}</h4>
								          </div>
								          <div class="modal-body  ">						         	
											<div>
												<div class="row" id="header">
													<div class="col-md-12">
														<div class="col-md-6"><strong>Almacen</strong></div>
														<div class="col-md-6" style="text-align: right;"><strong>Existencias</strong></div>
													</div>
												</div>
												<div class="row" id="tableExistencia{{item.articulo.id}}">
													
												</div>
											</div>
								          </div>
								          <div class="modal-footer">
								            <button type="button"  class="btn btn-default" data-dismiss="modal" >Ok</button>
								            <!-- <button type="button" class="btn btn-primary">OK</button> -->
								          </div>
								        </div>
								     </div>
								    </div>
								    							    
								<td headers="#COLUMN_HEADER_NAME#" data-label="Existencia" style="text-align: right;" #ALIGNMENT#><label>{{item.existencia}}</label></td>
								{% if not venta %}
								<td headers="#COLUMN_HEADER_NAME#" data-label="No. Serie" style="text-align: right;" #ALIGNMENT#><label>{{item.no_serie}}</label></td>
								<td headers="#COLUMN_HEADER_NAME#" data-label="Fecha Compra" style="text-align: right;" #ALIGNMENT#><label>{{item.fecha_compra|date:"d/M/Y"}}</label></td>
								<td headers="#COLUMN_HEADER_NAME#" data-label="Costo" style="text-align: right;" #ALIGNMENT#><label>{{item.costo|floatformat:2|intcomma}}</label></td>
								<td headers="#COLUMN_HEADER_NAME#" data-label="Refaccion" style="text-align: right;" #ALIGNMENT#><label>{{item.refaccion|floatformat:2|intcomma}}</label></td>
								{%endif%}									
								<td headers="#COLUMN_HEADER_NAME#" data-label="Precio" style="text-align: right;" #ALIGNMENT#><label id="{{item.articulo.id}}" class="precio_unitario">{{item.precio|floatformat:2|intcomma}}</label></td>
								{%if venta%}
								<td headers="#COLUMN_HEADER_NAME#" data-label="" #ALIGNMENT#><input type="number" value="{%if item.cantidad %}{{item.cantidad}}{%else%}0{%endif%}" min="0" id="{{item.articulo.id}}" max="{%if limite_existencia == 'True' %}{{item.existencia}}{%else%}10000{%endif%}" class="cantidad {{item.articulo.id}}"></td>{%endif%}
							</tr>
						{% endif %}
					{% endif %}
					{% endfor %}
				</tbody>
			</table>
			
			
		</div>
	</div>
</div>
{% endblock %}