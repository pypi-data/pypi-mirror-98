"use strict";var $=MyAMS.$,zodbbrowser={filterAll:function(){$(".filter").attr("checked",!0),zodbbrowser.filterHistory(!0)},filterNone:()=>{$(".filter").attr("checked",!1),zodbbrowser.filterHistory()},filterHistory:o=>{for(var r=$("div.transaction"),e=$(".filter"),t=Array(),a=0;a<e.length;a++){var i=e[a];i.checked&&(t["map"+i.name]=i.checked)}for(a=0;a<r.length;a++){for(var n=r[a],d=$(n).children("div.diff").children("div.diffitem"),s=0,c=0;c<d.length;c++){"map"+$($(d[c]).children()[0]).text()in t||o?$(d[c]).show():($(d[c]).hide(),s+=1)}var l=null;1===s?l="1 item hidden":s&&(l=s+" items hidden"),$(n).children(".filtered").remove(),l&&$(n).append('<div class="filtered">'+l+"</div>")}},collapseOrExpand:function(){var o=$(this).next(),r=$(this).children("img");o.is(":hidden")?($(r).attr("src",$("#collapseImg").attr("src")),o.slideDown()):($(r).attr("src",$("#expandImg").attr("src")),o.slideUp())},hideItemsIfTooMany:function(){$(".items").each((function(){var o=$(this).children(".expander")[0],r=$(this).children(".collapsible")[0];if(r.childNodes.length>100&&!$(r).is(":hidden")){var e=$(o).children("img");$(e).attr("src",$("#expandImg").attr("src")),$(r).hide()}}))},showGoTo:function(){$("#path").hide(),$("#goto").show(),$("#gotoInput").focus()},hideGoTo:function(){$("#goto").hide(),$("#path").show(),setTimeout((function(){$("#pathError").slideUp()}),50)},ajaxErrorHandler:function(o,r,e){var t="";t='<span class="error"> '+(t="parsererror"===r?"Server returned malformed data":"error"===r?"Unknown error (maybe server is offline?)":"timeout"===r?"Server timeout":"notmodified"===r?"Server error (says resource not modified)":"Unknown error")+"</strong>",$("#pathError").html(t)},ajaxSuccessHandler:function(o,r){o.url?(window.location=o.url,$("#pathError").text("Found.").slideDown().slideUp()):o.error?($("#pathError").text(o.error).show(),o.partial_url&&$("#pathError").append(', would you like to <a href="'+o.partial_url+'">go to '+o.partial_path+"</a> instead?")):$("#pathError").text(r).show()},activateGoTo:function(){var o=$("#gotoInput").val();$("#pathError").text("Loading...").slideDown(),$.ajax({url:"zodbbrowser_path_to_oid",dataType:"json",data:"path="+o,timeout:7e3,success:zodbbrowser.ajaxSuccessHandler,error:zodbbrowser.ajaxErrorHandler})},cancelRollback:function(o){$("#confirmation").remove(),$("div.transaction").removeClass("focus"),$("input.rollbackbtn").show()},pressRollback:function(o){o.preventDefault(),zodbbrowser.cancelRollback(),$(o.target).hide();var r=$(o.target).closest("div.transaction");r.addClass("focus"),$('<div id="confirmation"><form action="" method="post"><div class="message">This is a dangerous operation that may break data integrity. Are you really sure you want to do this?</div><input type="BUTTON" value="Really revert to this state" onclick="zodbbrowser.doRollback()"><input type="BUTTON" value="Cancel" onclick="zodbbrowser.cancelRollback()"></form></div>').appendTo(r)},doRollback:function(){var o=$("#confirmation").closest("div.transaction").find("form.rollback");o.find('input[name="confirmed"]').val("1"),o.submit()},init:function(o){zodbbrowser.hideItemsIfTooMany(),$("#path a",o).click((function(o){o.stopPropagation()})),$("#path",o).click(zodbbrowser.showGoTo),$("#gotoInput",o).blur(zodbbrowser.hideGoTo),$("#gotoInput",o).keypress((function(o){13===o.which&&zodbbrowser.activateGoTo()})),$("#gotoInput",o).keydown((function(o){27===o.keyCode&&zodbbrowser.hideGoTo()})),$(document).keypress((function(r){103===r.which&&$("#goto",o).is(":hidden")&&(zodbbrowser.showGoTo(),r.preventDefault())})),$("input.rollbackbtn",o).click(zodbbrowser.pressRollback),$("span.truncated",o).click((function(o){o.preventDefault();var r=$(this),e=r.attr("id");$.ajax({url:"zodbbrowser_truncated",data:"id="+e,success:function(o,e){r.replaceWith(o)}})}))}};window.MyAMS&&(MyAMS.config.modules.push("zodbbrowser"),MyAMS.zodbbrowser=zodbbrowser,console.debug("MyAMS: zodbbrowser module loaded..."));
